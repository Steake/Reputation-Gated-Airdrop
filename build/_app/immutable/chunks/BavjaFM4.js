const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DlJ5nIaU.js","./C5PuhdNm.js","./CkpMGzDD.js","./D7JtYkVa.js","./C_t4NNnx.js","./DSf5CCKz.js","./DVzSPLFO.js","./CKhFwjwF.js"])))=>i.map(i=>d[i]);
import{_ as wh}from"./C_t4NNnx.js";import{a as Ea,g as mh,c as Pt}from"./DSf5CCKz.js";import{bY as Gp}from"./C5PuhdNm.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"b1e593ae5130a8a866939fcd32d632e0f276c846"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="564f03b4-b8d8-48f7-b40f-21c92f06538c",t._sentryDebugIdIdentifier="sentry-dbid-564f03b4-b8d8-48f7-b40f-21c92f06538c")})()}catch{}var _a={exports:{}},ni=typeof Reflect=="object"?Reflect:null,dc=ni&&typeof ni.apply=="function"?ni.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},Bs;ni&&typeof ni.ownKeys=="function"?Bs=ni.ownKeys:Object.getOwnPropertySymbols?Bs=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Bs=function(e){return Object.getOwnPropertyNames(e)};function Yp(t){console&&console.warn&&console.warn(t)}var bh=Number.isNaN||function(e){return e!==e};function oe(){oe.init.call(this)}_a.exports=oe;_a.exports.once=Qp;oe.EventEmitter=oe;oe.prototype._events=void 0;oe.prototype._eventsCount=0;oe.prototype._maxListeners=void 0;var pc=10;function ln(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(oe,"defaultMaxListeners",{enumerable:!0,get:function(){return pc},set:function(t){if(typeof t!="number"||t<0||bh(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");pc=t}});oe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};oe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||bh(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function vh(t){return t._maxListeners===void 0?oe.defaultMaxListeners:t._maxListeners}oe.prototype.getMaxListeners=function(){return vh(this)};oe.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var s=e==="error",n=this._events;if(n!==void 0)s=s&&n.error===void 0;else if(!s)return!1;if(s){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=n[e];if(c===void 0)return!1;if(typeof c=="function")dc(c,this,r);else for(var l=c.length,u=Sh(c,l),i=0;i<l;++i)dc(u[i],this,r);return!0};function Eh(t,e,r,i){var s,n,o;if(ln(r),n=t._events,n===void 0?(n=t._events=Object.create(null),t._eventsCount=0):(n.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),n=t._events),o=n[e]),o===void 0)o=n[e]=r,++t._eventsCount;else if(typeof o=="function"?o=n[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),s=vh(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Yp(a)}return t}oe.prototype.addListener=function(e,r){return Eh(this,e,r,!1)};oe.prototype.on=oe.prototype.addListener;oe.prototype.prependListener=function(e,r){return Eh(this,e,r,!0)};function Zp(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _h(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},s=Zp.bind(i);return s.listener=r,i.wrapFn=s,s}oe.prototype.once=function(e,r){return ln(r),this.on(e,_h(this,e,r)),this};oe.prototype.prependOnceListener=function(e,r){return ln(r),this.prependListener(e,_h(this,e,r)),this};oe.prototype.removeListener=function(e,r){var i,s,n,o,a;if(ln(r),s=this._events,s===void 0)return this;if(i=s[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(n=-1,o=i.length-1;o>=0;o--)if(i[o]===r||i[o].listener===r){a=i[o].listener,n=o;break}if(n<0)return this;n===0?i.shift():Jp(i,n),i.length===1&&(s[e]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};oe.prototype.off=oe.prototype.removeListener;oe.prototype.removeAllListeners=function(e){var r,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var n=Object.keys(i),o;for(s=0;s<n.length;++s)o=n[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(s=r.length-1;s>=0;s--)this.removeListener(e,r[s]);return this};function xh(t,e,r){var i=t._events;if(i===void 0)return[];var s=i[e];return s===void 0?[]:typeof s=="function"?r?[s.listener||s]:[s]:r?Xp(s):Sh(s,s.length)}oe.prototype.listeners=function(e){return xh(this,e,!0)};oe.prototype.rawListeners=function(e){return xh(this,e,!1)};oe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ih.call(t,e)};oe.prototype.listenerCount=Ih;function Ih(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}oe.prototype.eventNames=function(){return this._eventsCount>0?Bs(this._events):[]};function Sh(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function Jp(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Xp(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Qp(t,e){return new Promise(function(r,i){function s(o){t.removeListener(e,n),i(o)}function n(){typeof t.removeListener=="function"&&t.removeListener("error",s),r([].slice.call(arguments))}$h(t,e,n,{once:!0}),e!=="error"&&eg(t,s,{once:!0})})}function eg(t,e,r){typeof t.on=="function"&&$h(t,"error",e,r)}function $h(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(n){i.once&&t.removeEventListener(e,s),r(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var nt=_a.exports;const xa=Ea(nt);var gc=function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},tg=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),rg=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),ig=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),sg=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),ng=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),og=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,ag=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,yc=3,cg=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",og]],wc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function lg(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ng:typeof navigator<"u"?hg(navigator.userAgent):dg()}function ug(t){return t!==""&&cg.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var n=s.exec(t);return!!n&&[i,n]},!1)}function hg(t){var e=ug(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new sg;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<yc&&(s=gc(gc([],s,!0),pg(yc-s.length),!0)):s=[];var n=s.join("."),o=fg(t),a=ag.exec(t);return a&&a[1]?new ig(r,n,o,a[1]):new tg(r,n,o)}function fg(t){for(var e=0,r=wc.length;e<r;e++){var i=wc[e],s=i[0],n=i[1],o=n.exec(t);if(o)return s}return null}function dg(){var t=typeof process<"u"&&process.version;return t?new rg(process.version.slice(1)):null}function pg(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var F={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var xo=function(t,e){return xo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},xo(t,e)};function gg(t,e){xo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Io=function(){return Io=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Io.apply(this,arguments)};function yg(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function wg(t,e,r,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(s<3?o(n):s>3?o(e,r,n):o(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n}function mg(t,e){return function(r,i){e(r,i,t)}}function bg(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function vg(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?n(u.value):s(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Eg(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=l[0]&2?s.return:l[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,l[1])).done)return n;switch(s=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){r.label=l[1];break}if(l[0]===6&&r.label<n[1]){r.label=n[1],n=l;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(l);break}n[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],s=0}finally{i=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function _g(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function xg(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function So(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Dh(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return n}function Ig(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Dh(arguments[e]));return t}function Sg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Hi(t){return this instanceof Hi?(this.v=t,this):new Hi(t)}function $g(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){i[f]&&(s[f]=function(d){return new Promise(function(p,y){n.push([f,d,p,y])>1||a(f,d)})})}function a(f,d){try{c(i[f](d))}catch(p){h(n[0][3],p)}}function c(f){f.value instanceof Hi?Promise.resolve(f.value.v).then(l,u):h(n[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),n.shift(),n.length&&a(n[0][0],n[0][1])}}function Dg(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=t[s]?function(o){return(r=!r)?{value:Hi(t[s](o)),done:s==="return"}:n?n(o):o}:n}}function Og(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof So=="function"?So(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(n){r[n]=t[n]&&function(o){return new Promise(function(a,c){o=t[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(l){n({value:l,done:a})},o)}}function Ag(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Pg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Cg(t){return t&&t.__esModule?t:{default:t}}function Tg(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Rg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Bg=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Io},__asyncDelegator:Dg,__asyncGenerator:$g,__asyncValues:Og,__await:Hi,__awaiter:vg,__classPrivateFieldGet:Tg,__classPrivateFieldSet:Rg,__createBinding:_g,__decorate:wg,__exportStar:xg,__extends:gg,__generator:Eg,__importDefault:Cg,__importStar:Pg,__makeTemplateObject:Ag,__metadata:bg,__param:mg,__read:Dh,__rest:yg,__spread:Ig,__spreadArrays:Sg,__values:So},Symbol.toStringTag,{value:"Module"})),un=mh(Bg);var Tn={},mi={},mc;function Ng(){if(mc)return mi;mc=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return mi.delay=t,mi}var vr={},Rn={},Er={},bc;function Ug(){return bc||(bc=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.ONE_THOUSAND=Er.ONE_HUNDRED=void 0,Er.ONE_HUNDRED=100,Er.ONE_THOUSAND=1e3),Er}var Bn={},vc;function jg(){return vc||(vc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Bn)),Bn}var Ec;function Oh(){return Ec||(Ec=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=un;e.__exportStar(Ug(),t),e.__exportStar(jg(),t)}(Rn)),Rn}var _c;function Fg(){if(_c)return vr;_c=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.fromMiliseconds=vr.toMiliseconds=void 0;const t=Oh();function e(i){return i*t.ONE_THOUSAND}vr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return vr.fromMiliseconds=r,vr}var xc;function kg(){return xc||(xc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=un;e.__exportStar(Ng(),t),e.__exportStar(Fg(),t)}(Tn)),Tn}var Kr={},Ic;function Lg(){if(Ic)return Kr;Ic=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Kr.Watch=t,Kr.default=t,Kr}var Nn={},bi={},Sc;function Mg(){if(Sc)return bi;Sc=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.IWatch=void 0;class t{}return bi.IWatch=t,bi}var $c;function qg(){return $c||($c=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),un.__exportStar(Mg(),t)}(Nn)),Nn}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=un;e.__exportStar(kg(),t),e.__exportStar(Lg(),t),e.__exportStar(qg(),t),e.__exportStar(Oh(),t)})(F);var le={};Object.defineProperty(le,"__esModule",{value:!0});le.getLocalStorage=le.getLocalStorageOrThrow=le.getCrypto=le.getCryptoOrThrow=Ah=le.getLocation=le.getLocationOrThrow=Ia=le.getNavigator=le.getNavigatorOrThrow=Rr=le.getDocument=le.getDocumentOrThrow=le.getFromWindowOrThrow=le.getFromWindow=void 0;function Fr(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}le.getFromWindow=Fr;function fi(t){const e=Fr(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}le.getFromWindowOrThrow=fi;function zg(){return fi("document")}le.getDocumentOrThrow=zg;function Kg(){return Fr("document")}var Rr=le.getDocument=Kg;function Vg(){return fi("navigator")}le.getNavigatorOrThrow=Vg;function Hg(){return Fr("navigator")}var Ia=le.getNavigator=Hg;function Wg(){return fi("location")}le.getLocationOrThrow=Wg;function Gg(){return Fr("location")}var Ah=le.getLocation=Gg;function Yg(){return fi("crypto")}le.getCryptoOrThrow=Yg;function Zg(){return Fr("crypto")}le.getCrypto=Zg;function Jg(){return fi("localStorage")}le.getLocalStorageOrThrow=Jg;function Xg(){return Fr("localStorage")}le.getLocalStorage=Xg;var Sa={};Object.defineProperty(Sa,"__esModule",{value:!0});var Ph=Sa.getWindowMetadata=void 0;const Dc=le;function Qg(){let t,e;try{t=Dc.getDocumentOrThrow(),e=Dc.getLocationOrThrow()}catch{return null}function r(){const h=t.getElementsByTagName("link"),f=[];for(let d=0;d<h.length;d++){const p=h[d],y=p.getAttribute("rel");if(y&&y.toLowerCase().indexOf("icon")>-1){const m=p.getAttribute("href");if(m)if(m.toLowerCase().indexOf("https:")===-1&&m.toLowerCase().indexOf("http:")===-1&&m.indexOf("//")!==0){let x=e.protocol+"//"+e.host;if(m.indexOf("/")===0)x+=m;else{const D=e.pathname.split("/");D.pop();const b=D.join("/");x+=b+"/"+m}f.push(x)}else if(m.indexOf("//")===0){const x=e.protocol+m;f.push(x)}else f.push(m)}}return f}function i(...h){const f=t.getElementsByTagName("meta");for(let d=0;d<f.length;d++){const p=f[d],y=["itemprop","property","name"].map(m=>p.getAttribute(m)).filter(m=>m?h.includes(m):!1);if(y.length&&y){const m=p.getAttribute("content");if(m)return m}}return""}function s(){let h=i("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function n(){return i("description","og:description","twitter:description","keywords")}const o=s(),a=n(),c=e.origin,l=r();return{description:a,url:c,icons:l,name:o}}Ph=Sa.getWindowMetadata=Qg;function Wi(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function $o(t){return Wi(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Ch="2.36.0";let vi={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${Ch}`};class Br extends Error{constructor(e,r={}){var a;const i=(()=>{var c;return r.cause instanceof Br?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),s=r.cause instanceof Br&&r.cause.docsPath||r.docsPath,n=(a=vi.getDocsUrl)==null?void 0:a.call(vi,{...r,docsPath:s}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...i?[`Details: ${i}`]:[],...vi.version?[`Version: ${vi.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=Ch}walk(e){return Th(this,e)}}function Th(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Th(t.cause,e):e?null:t}class Rh extends Br{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function di(t,{dir:e,size:r=32}={}){return typeof t=="string"?ey(t,{dir:e,size:r}):ty(t,{dir:e,size:r})}function ey(t,{dir:e,size:r=32}={}){if(r===null)return t;const i=t.replace("0x","");if(i.length>r*2)throw new Rh({size:Math.ceil(i.length/2),targetSize:r,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function ty(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Rh({size:t.length,targetSize:r,type:"bytes"});const i=new Uint8Array(r);for(let s=0;s<r;s++){const n=e==="right";i[n?s:r-s-1]=t[n?s:t.length-s-1]}return i}class ry extends Br{constructor({max:e,min:r,signed:i,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}class iy extends Br{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function pi(t,{size:e}){if($o(t)>e)throw new iy({givenSize:$o(t),maxSize:e})}function Do(t,e={}){const{signed:r}=e;e.size&&pi(t,{size:e.size});const i=BigInt(t);if(!r)return i;const s=(t.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function sy(t,e={}){return Number(Do(t,e))}const ny=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Oo(t,e={}){return typeof t=="number"||typeof t=="bigint"?Nh(t,e):typeof t=="string"?cy(t,e):typeof t=="boolean"?oy(t,e):Bh(t,e)}function oy(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(pi(r,{size:e.size}),di(r,{size:e.size})):r}function Bh(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=ny[t[s]];const i=`0x${r}`;return typeof e.size=="number"?(pi(i,{size:e.size}),di(i,{dir:"right",size:e.size})):i}function Nh(t,e={}){const{signed:r,size:i}=e,s=BigInt(t);let n;i?r?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&r?-n-1n:0;if(n&&s>n||s<o){const c=typeof t=="bigint"?"n":"";throw new ry({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:r,size:i,value:`${t}${c}`})}const a=`0x${(r&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?di(a,{size:i}):a}const ay=new TextEncoder;function cy(t,e={}){const r=ay.encode(t);return Bh(r,e)}const ly=new TextEncoder;function uy(t,e={}){return typeof t=="number"||typeof t=="bigint"?fy(t,e):typeof t=="boolean"?hy(t,e):Wi(t)?Uh(t,e):jh(t,e)}function hy(t,e={}){const r=new Uint8Array(1);return r[0]=Number(t),typeof e.size=="number"?(pi(r,{size:e.size}),di(r,{size:e.size})):r}const Ft={zero:48,nine:57,A:65,F:70,a:97,f:102};function Oc(t){if(t>=Ft.zero&&t<=Ft.nine)return t-Ft.zero;if(t>=Ft.A&&t<=Ft.F)return t-(Ft.A-10);if(t>=Ft.a&&t<=Ft.f)return t-(Ft.a-10)}function Uh(t,e={}){let r=t;e.size&&(pi(r,{size:e.size}),r=di(r,{dir:"right",size:e.size}));let i=r.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,n=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=Oc(i.charCodeAt(a++)),l=Oc(i.charCodeAt(a++));if(c===void 0||l===void 0)throw new Br(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);n[o]=c*16+l}return n}function fy(t,e){const r=Nh(t,e);return Uh(r)}function jh(t,e={}){const r=ly.encode(t);return typeof e.size=="number"?(pi(r,{size:e.size}),di(r,{dir:"right",size:e.size})):r}function Fh(t,e){const r=e||"hex",i=Gp(Wi(t,{strict:!1})?uy(t):t);return r==="bytes"?i:Oo(i)}class dy extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Un=new dy(8192);function py(t,e){if(Un.has(`${t}.${e}`))return Un.get(`${t}.${e}`);const r=t.substring(2).toLowerCase(),i=Fh(jh(r),"bytes"),s=r.split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(i[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const n=`0x${s.join("")}`;return Un.set(`${t}.${e}`,n),n}function gy(t){const e=Fh(`0x${t.substring(4)}`).substring(26);return py(`0x${e}`)}async function yy({hash:t,signature:e}){const r=Wi(t)?t:Oo(t),{secp256k1:i}=await wh(async()=>{const{secp256k1:o}=await import("./DlJ5nIaU.js");return{secp256k1:o}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:u,v:h,yParity:f}=e,d=Number(f??h),p=Ac(d);return new i.Signature(Do(l),Do(u)).addRecoveryBit(p)}const o=Wi(e)?e:Oo(e);if($o(o)!==65)throw new Error("invalid signature length");const a=sy(`0x${o.slice(130)}`),c=Ac(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function Ac(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function wy({hash:t,signature:e}){return gy(await yy({hash:t,signature:e}))}function my(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const r=t.length,i=t.charAt(0),s=Math.log(r)/Math.log(256),n=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,f=0;const d=l.length;for(;f!==d&&l[f]===0;)f++,u++;const p=(d-f)*n+1>>>0,y=new Uint8Array(p);for(;f!==d;){let D=l[f],b=0;for(let A=p-1;(D!==0||b<h)&&A!==-1;A--,b++)D+=256*y[A]>>>0,y[A]=D%r>>>0,D=D/r>>>0;if(D!==0)throw new Error("Non-zero carry");h=b,f++}let m=p-h;for(;m!==p&&y[m]===0;)m++;let x=i.repeat(u);for(;m<p;++m)x+=t.charAt(y[m]);return x}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,f=0;for(;l[u]===i;)h++,u++;const d=(l.length-u)*s+1>>>0,p=new Uint8Array(d);for(;u<l.length;){const D=l.charCodeAt(u);if(D>255)return;let b=e[D];if(b===255)return;let A=0;for(let C=d-1;(b!==0||A<f)&&C!==-1;C--,A++)b+=r*p[C]>>>0,p[C]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=A,u++}let y=d-f;for(;y!==d&&p[y]===0;)y++;const m=new Uint8Array(h+(d-y));let x=h;for(;y!==d;)m[x++]=p[y++];return m}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var by="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const ts=my(by);function vy(t){const e=t.length;let r=0,i=0;for(;i<e;){let s=t.charCodeAt(i++);if(s&4294967168)if(!(s&4294965248))r+=2;else{if(s>=55296&&s<=56319&&i<e){const n=t.charCodeAt(i);(n&64512)===56320&&(++i,s=((s&1023)<<10)+(n&1023)+65536)}s&4294901760?r+=4:r+=3}else{r++;continue}}return r}function Ey(t,e,r){const i=t.length;let s=r,n=0;for(;n<i;){let o=t.charCodeAt(n++);if(o&4294967168)if(!(o&4294965248))e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<i){const a=t.charCodeAt(n);(a&64512)===56320&&(++n,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128):(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128)}else{e[s++]=o;continue}e[s++]=o&63|128}}const _y=new TextEncoder,xy=50;function Iy(t,e,r){_y.encodeInto(t,e.subarray(r))}function Sy(t,e,r){t.length>xy?Iy(t,e,r):Ey(t,e,r)}const $y=4096;function kh(t,e,r){let i=e;const s=i+r,n=[];let o="";for(;i<s;){const a=t[i++];if(!(a&128))n.push(a);else if((a&224)===192){const c=t[i++]&63;n.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,l=t[i++]&63;n.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[i++]&63,l=t[i++]&63,u=t[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|h&1023),n.push(h)}else n.push(a);n.length>=$y&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const Dy=new TextDecoder,Oy=200;function Ay(t,e,r){const i=t.subarray(e,e+r);return Dy.decode(i)}function Py(t,e,r){return r>Oy?Ay(t,e,r):kh(t,e,r)}class ds{constructor(e,r){this.type=e,this.data=r}}class rt extends Error{constructor(e){super(e);const r=Object.create(rt.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:rt.name})}}const Ei=4294967295;function Cy(t,e,r){const i=r/4294967296,s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function Lh(t,e,r){const i=Math.floor(r/4294967296),s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function Mh(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function Ty(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const Ry=-1,By=4294967296-1,Ny=17179869184-1;function Uy({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=Ny)if(e===0&&t<=By){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,e<<2|r&3),n.setUint32(4,i),s}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),Lh(i,4,t),r}}function jy(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,s=Math.floor(i/1e9);return{sec:r+s,nsec:i-s*1e9}}function Fy(t){if(t instanceof Date){const e=jy(t);return Uy(e)}else return null}function ky(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),s=(r&3)*4294967296+i,n=r>>>2;return{sec:s,nsec:n}}case 12:{const r=Mh(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new rt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function Ly(t){const e=ky(t);return new Date(e.sec*1e3+e.nsec/1e6)}const My={type:Ry,encode:Fy,decode:Ly};class zs{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(My)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const s=this.builtInEncoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=-1-i;return new ds(o,n)}}}for(let i=0;i<this.encoders.length;i++){const s=this.encoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=i;return new ds(o,n)}}}return e instanceof ds?e:null}decode(e,r,i){const s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,i):new ds(r,e)}}zs.defaultCodec=new zs;function qy(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Ao(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):qy(t)?new Uint8Array(t):Uint8Array.from(t)}const zy=100,Ky=2048;let Vy=class qh{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??zs.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??zy,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??Ky,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new qh({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),s=new DataView(r);i.set(this.bytes),this.view=s,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=vy(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),Sy(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=Ao(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let i=0;for(const s of r)e[s]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const n of i){const o=e[n];this.ignoreUndefined&&o===void 0||(this.encodeString(n),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),s=i.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Cy(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Lh(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Hy(t,e){return new Vy(e).encodeSharedRef(t)}function jn(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Wy=16,Gy=16;class Yy{constructor(e=Wy,r=Gy){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const s=this.caches[i-1];e:for(const n of s){const o=n.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return n.str}return null}store(e,r){const i=this.caches[e.length-1],s={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=s:i.push(s)}decode(e,r,i){const s=this.find(e,r,i);if(s!=null)return this.hit++,s;this.miss++;const n=kh(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,n),n}}const Po="array",Li="map_key",zh="map_value",Zy=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new rt("The type of key must be string or number but "+typeof t)};class Jy{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=Po,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Li,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Po){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Li||e.type===zh){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const _i=-1,$a=new DataView(new ArrayBuffer(0)),Xy=new Uint8Array($a.buffer);try{$a.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Pc=new RangeError("Insufficient data"),Qy=new Yy;let ew=class Kh{constructor(e){this.totalPos=0,this.pos=0,this.view=$a,this.bytes=Xy,this.headByte=_i,this.stack=new Jy,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??zs.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??Ei,this.maxBinLength=(e==null?void 0:e.maxBinLength)??Ei,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??Ei,this.maxMapLength=(e==null?void 0:e.maxMapLength)??Ei,this.maxExtLength=(e==null?void 0:e.maxExtLength)??Ei,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:Qy,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??Zy}clone(){return new Kh({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=_i,this.stack.reset()}setBuffer(e){const r=Ao(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===_i&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=Ao(e),s=new Uint8Array(r.length+i.length);s.set(r),s.set(i,r.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:s,pos:n,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${jn(s)} at ${o} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,s=-1;for await(const n of e){if(r&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(s=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else{const s=e-160;r=this.decodeString(s,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const s=this.lookU8();r=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();r=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();r=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===196){const s=this.lookU8();r=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();r=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();r=this.decodeBinary(s,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();r=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();r=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();r=this.decodeExtension(s,4)}else throw new rt(`Unrecognized type byte: ${jn(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const s=i.top();if(s.type===Po)if(s.array[s.position]=r,s.position++,s.position===s.size)r=s.array,i.release(s);else continue e;else if(s.type===Li){if(r==="__proto__")throw new rt("The key __proto__ is not allowed");s.key=this.mapKeyConverter(r),s.type=zh;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)r=s.map,i.release(s);else{s.key=null,s.type=Li;continue e}}return r}}readHeadByte(){return this.headByte===_i&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=_i}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new rt(`Unrecognized array type byte: ${jn(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new rt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new rt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){var n;if(e>this.maxStrLength)throw new rt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw Pc;const i=this.pos+r;let s;return this.stateIsMapKey()&&((n=this.keyDecoder)!=null&&n.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,i,e):s=Py(this.bytes,i,e),this.pos+=r+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Li:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new rt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw Pc;const i=this.pos+r,s=this.bytes.subarray(i,i+e);return this.pos+=r+e,s}decodeExtension(e,r){if(e>this.maxExtLength)throw new rt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),s=this.decodeBinary(e,r+1);return this.extensionCodec.decode(s,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=Ty(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Mh(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function tw(t,e){return new ew(e).decode(t)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function rw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Vh(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Ks(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Da(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Co(t){if(!Array.isArray(t))throw new Error("array expected")}function Vs(t,e){if(!Vh(!0,e))throw new Error(`${t}: array of strings expected`)}function iw(t,e){if(!Vh(!1,e))throw new Error(`${t}: array of numbers expected`)}function sw(...t){const e=n=>n,r=(n,o)=>a=>n(o(a)),i=t.map(n=>n.encode).reduceRight(r,e),s=t.map(n=>n.decode).reduce(r,e);return{encode:i,decode:s}}function nw(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Vs("alphabet",e);const i=new Map(e.map((s,n)=>[s,n]));return{encode:s=>(Co(s),s.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${t}`);return e[n]})),decode:s=>(Co(s),s.map(n=>{Ks("alphabet.decode",n);const o=i.get(n);if(o===void 0)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return o}))}}function ow(t=""){return Ks("join",t),{encode:e=>(Vs("join.decode",e),e.join(t)),decode:e=>(Ks("join.decode",e),e.split(t))}}function aw(t,e="="){return Da(t),Ks("padding",e),{encode(r){for(Vs("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Vs("padding.decode",r);let i=r.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&r[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,i)}}}const Hh=(t,e)=>e===0?t:Hh(e,t%e),Hs=(t,e)=>t+(e-Hh(t,e)),Fn=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function Cc(t,e,r,i){if(Co(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Hs(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Hs(e,r)}`);let s=0,n=0;const o=Fn[e],a=Fn[r]-1,c=[];for(const l of t){if(Da(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,n+e>32)throw new Error(`convertRadix2: carry overflow pos=${n} from=${e}`);for(n+=e;n>=r;n-=r)c.push((s>>n-r&a)>>>0);const u=Fn[n];if(u===void 0)throw new Error("invalid carry");s&=u-1}if(s=s<<r-n&a,!i&&n>=e)throw new Error("Excess padding");if(!i&&s>0)throw new Error(`Non-zero padding: ${s}`);return i&&n>0&&c.push(s>>>0),c}function cw(t,e=!1){if(Da(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Hs(8,t)>32||Hs(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!rw(r))throw new Error("radix2.encode input should be Uint8Array");return Cc(Array.from(r),8,t,!e)},decode:r=>(iw("radix2.decode",r),Uint8Array.from(Cc(r,t,8,e)))}}const lw=sw(cw(5),nw("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),aw(5),ow("")),uw=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),hw=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function Nr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return hw(t)}catch{return t}}function Zt(t){return typeof t=="string"?t:uw(t)||""}function fw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Wh(t,...e){if(!fw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Tc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function dw(t,e){Wh(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Vr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const kn=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function pw(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Gh(t){return typeof t=="string"&&(t=pw(t)),Wh(t),t}let gw=class{clone(){return this._cloneInto()}};function yw(t){const e=i=>t().update(Gh(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Yh(t=32){if(Vr&&typeof Vr.getRandomValues=="function")return Vr.getRandomValues(new Uint8Array(t));if(Vr&&typeof Vr.randomBytes=="function")return Vr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function ww(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}let mw=class extends gw{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=kn(this.buffer)}update(e){Tc(this);const{view:r,buffer:i,blockLen:s}=this;e=Gh(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=kn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Tc(this),dw(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;ww(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=kn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%r&&e.buffer.set(i),e}};const ps=BigInt(2**32-1),To=BigInt(32);function Zh(t,e=!1){return e?{h:Number(t&ps),l:Number(t>>To&ps)}:{h:Number(t>>To&ps)|0,l:Number(t&ps)|0}}function bw(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=Zh(t[s],e);[r[s],i[s]]=[n,o]}return[r,i]}const vw=(t,e)=>BigInt(t>>>0)<<To|BigInt(e>>>0),Ew=(t,e,r)=>t>>>r,_w=(t,e,r)=>t<<32-r|e>>>r,xw=(t,e,r)=>t>>>r|e<<32-r,Iw=(t,e,r)=>t<<32-r|e>>>r,Sw=(t,e,r)=>t<<64-r|e>>>r-32,$w=(t,e,r)=>t>>>r-32|e<<64-r,Dw=(t,e)=>e,Ow=(t,e)=>t,Aw=(t,e,r)=>t<<r|e>>>32-r,Pw=(t,e,r)=>e<<r|t>>>32-r,Cw=(t,e,r)=>e<<r-32|t>>>64-r,Tw=(t,e,r)=>t<<r-32|e>>>64-r;function Rw(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Bw=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Nw=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,Uw=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),jw=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,Fw=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),kw=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,Z={fromBig:Zh,split:bw,toBig:vw,shrSH:Ew,shrSL:_w,rotrSH:xw,rotrSL:Iw,rotrBH:Sw,rotrBL:$w,rotr32H:Dw,rotr32L:Ow,rotlSH:Aw,rotlSL:Pw,rotlBH:Cw,rotlBL:Tw,add:Rw,add3L:Bw,add3H:Nw,add4L:Uw,add4H:jw,add5H:kw,add5L:Fw},[Lw,Mw]=Z.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Xt=new Uint32Array(80),Qt=new Uint32Array(80);let qw=class extends mw{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:p,Hh:y,Hl:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,d,p,y,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,d,p,y,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=y|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)Xt[b]=e.getUint32(r),Qt[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const A=Xt[b-15]|0,C=Qt[b-15]|0,T=Z.rotrSH(A,C,1)^Z.rotrSH(A,C,8)^Z.shrSH(A,C,7),j=Z.rotrSL(A,C,1)^Z.rotrSL(A,C,8)^Z.shrSL(A,C,7),U=Xt[b-2]|0,O=Qt[b-2]|0,K=Z.rotrSH(U,O,19)^Z.rotrBH(U,O,61)^Z.shrSH(U,O,6),V=Z.rotrSL(U,O,19)^Z.rotrBL(U,O,61)^Z.shrSL(U,O,6),P=Z.add4L(j,V,Qt[b-7],Qt[b-16]),S=Z.add4H(P,T,K,Xt[b-7],Xt[b-16]);Xt[b]=S|0,Qt[b]=P|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:p,Gh:y,Gl:m,Hh:x,Hl:D}=this;for(let b=0;b<80;b++){const A=Z.rotrSH(h,f,14)^Z.rotrSH(h,f,18)^Z.rotrBH(h,f,41),C=Z.rotrSL(h,f,14)^Z.rotrSL(h,f,18)^Z.rotrBL(h,f,41),T=h&d^~h&y,j=f&p^~f&m,U=Z.add5L(D,C,j,Mw[b],Qt[b]),O=Z.add5H(U,x,A,T,Lw[b],Xt[b]),K=U|0,V=Z.rotrSH(i,s,28)^Z.rotrBH(i,s,34)^Z.rotrBH(i,s,39),P=Z.rotrSL(i,s,28)^Z.rotrBL(i,s,34)^Z.rotrBL(i,s,39),S=i&n^i&a^n&a,$=s&o^s&c^o&c;x=y|0,D=m|0,y=d|0,m=p|0,d=h|0,p=f|0,{h,l:f}=Z.add(l|0,u|0,O|0,K|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const g=Z.add3L(K,P,$);i=Z.add3H(g,O,V,S),s=g|0}({h:i,l:s}=Z.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=Z.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=Z.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Z.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Z.add(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=Z.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:y,l:m}=Z.add(this.Gh|0,this.Gl|0,y|0,m|0),{h:x,l:D}=Z.add(this.Hh|0,this.Hl|0,x|0,D|0),this.set(i,s,n,o,a,c,l,u,h,f,d,p,y,m,x,D)}roundClean(){Xt.fill(0),Qt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const zw=yw(()=>new qw);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Oa=BigInt(0),Jh=BigInt(1),Kw=BigInt(2);function Aa(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pa(t){if(!Aa(t))throw new Error("Uint8Array expected")}function Ln(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Vw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ca(t){Pa(t);let e="";for(let r=0;r<t.length;r++)e+=Vw[t[r]];return e}function Xh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Oa:BigInt("0x"+t)}const kt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Rc(t){if(t>=kt._0&&t<=kt._9)return t-kt._0;if(t>=kt.A&&t<=kt.F)return t-(kt.A-10);if(t>=kt.a&&t<=kt.f)return t-(kt.a-10)}function Qh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Rc(t.charCodeAt(n)),a=Rc(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Hw(t){return Xh(Ca(t))}function Ns(t){return Pa(t),Xh(Ca(Uint8Array.from(t).reverse()))}function ef(t,e){return Qh(t.toString(16).padStart(e*2,"0"))}function Ro(t,e){return ef(t,e).reverse()}function Lt(t,e,r){let i;if(typeof e=="string")try{i=Qh(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Aa(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function Bc(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];Pa(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const Mn=t=>typeof t=="bigint"&&Oa<=t;function Ww(t,e,r){return Mn(t)&&Mn(e)&&Mn(r)&&e<=t&&t<r}function xi(t,e,r,i){if(!Ww(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Gw(t){let e;for(e=0;t>Oa;t>>=Jh,e+=1);return e}const Yw=t=>(Kw<<BigInt(t-1))-Jh,Zw={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Aa(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ta(t,e,r={}){const i=(s,n,o)=>{const a=Zw[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function Nc(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const xe=BigInt(0),de=BigInt(1),$r=BigInt(2),Jw=BigInt(3),Bo=BigInt(4),Uc=BigInt(5),jc=BigInt(8);function be(t,e){const r=t%e;return r>=xe?r:e+r}function Xw(t,e,r){if(e<xe)throw new Error("invalid exponent, negatives unsupported");if(r<=xe)throw new Error("invalid modulus");if(r===de)return xe;let i=de;for(;e>xe;)e&de&&(i=i*t%r),t=t*t%r,e>>=de;return i}function xt(t,e,r){let i=t;for(;e-- >xe;)i*=i,i%=r;return i}function Fc(t,e){if(t===xe)throw new Error("invert: expected non-zero number");if(e<=xe)throw new Error("invert: expected positive modulus, got "+e);let r=be(t,e),i=e,s=xe,n=de;for(;r!==xe;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==de)throw new Error("invert: does not exist");return be(s,e)}function Qw(t){const e=(t-de)/$r;let r,i,s;for(r=t-de,i=0;r%$r===xe;r/=$r,i++);for(s=$r;s<t&&Xw(s,e,t)!==t-de;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+de)/Bo;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(r+de)/$r;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,s),r),u=o.pow(a,n),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let p=o.sqr(h);f<c&&!o.eql(p,o.ONE);f++)p=o.sqr(p);const d=o.pow(l,de<<BigInt(c-f-1));l=o.sqr(d),u=o.mul(u,d),h=o.mul(h,l),c=f}return u}}function e0(t){if(t%Bo===Jw){const e=(t+de)/Bo;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%jc===Uc){const e=(t-Uc)/jc;return function(r,i){const s=r.mul(i,$r),n=r.pow(s,e),o=r.mul(i,n),a=r.mul(r.mul(o,$r),n),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return Qw(t)}const t0=(t,e)=>(be(t,e)&de)===de,r0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function i0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=r0.reduce((i,s)=>(i[s]="function",i),e);return Ta(t,r)}function s0(t,e,r){if(r<xe)throw new Error("invalid exponent, negatives unsupported");if(r===xe)return t.ONE;if(r===de)return e;let i=t.ONE,s=e;for(;r>xe;)r&de&&(i=t.mul(i,s)),s=t.sqr(s),r>>=de;return i}function n0(t,e){const r=new Array(e.length),i=e.reduce((n,o,a)=>t.is0(o)?n:(r[a]=n,t.mul(n,o)),t.ONE),s=t.inv(i);return e.reduceRight((n,o,a)=>t.is0(o)?n:(r[a]=t.mul(n,r[a]),t.mul(n,o)),s),r}function tf(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function rf(t,e,r=!1,i={}){if(t<=xe)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=tf(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:Yw(s),ZERO:xe,ONE:de,create:c=>be(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return xe<=c&&c<t},is0:c=>c===xe,isOdd:c=>(c&de)===de,neg:c=>be(-c,t),eql:(c,l)=>c===l,sqr:c=>be(c*c,t),add:(c,l)=>be(c+l,t),sub:(c,l)=>be(c-l,t),mul:(c,l)=>be(c*l,t),pow:(c,l)=>s0(a,c,l),div:(c,l)=>be(c*Fc(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Fc(c,t),sqrt:i.sqrt||(c=>(o||(o=e0(t)),o(a,c))),invertBatch:c=>n0(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?Ro(c,n):ef(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?Ns(c):Hw(c)}});return Object.freeze(a)}const kc=BigInt(0),gs=BigInt(1);function qn(t,e){const r=e.negate();return t?r:e}function sf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function zn(t,e){sf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function o0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function a0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Kn=new WeakMap,nf=new WeakMap;function Vn(t){return nf.get(t)||1}function c0(t,e){return{constTimeNegate:qn,hasPrecomputes(r){return Vn(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>kc;)i&gs&&(s=s.add(n)),n=n.double(),i>>=gs;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=zn(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){const{windows:n,windowSize:o}=zn(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let f=0;f<n;f++){const d=f*o;let p=Number(s&l);s>>=h,p>o&&(p-=u,s+=gs);const y=d,m=d+Math.abs(p)-1,x=f%2!==0,D=p<0;p===0?c=c.add(qn(x,i[y])):a=a.add(qn(D,i[m]))}return{p:a,f:c}},wNAFUnsafe(r,i,s,n=t.ZERO){const{windows:o,windowSize:a}=zn(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(s===kc)break;let d=Number(s&c);if(s>>=u,d>a&&(d-=l,s+=gs),d===0)continue;let p=i[f+Math.abs(d)-1];d<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(r,i,s){let n=Kn.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&Kn.set(i,s(n))),n},wNAFCached(r,i,s){const n=Vn(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=Vn(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){sf(i,e),nf.set(r,i),Kn.delete(r)}}}function l0(t,e,r,i){if(o0(r,t),a0(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=Gw(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let d=0;d<i.length;d++){const p=i[d],y=Number(p>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[d])}let f=s;for(let d=c.length-1,p=s;d>0;d--)p=p.add(c[d]),f=f.add(p);if(u=u.add(f),h!==0)for(let d=0;d<o;d++)u=u.double()}return u}function u0(t){return i0(t.Fp),Ta(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...tf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const gt=BigInt(0),ze=BigInt(1),ys=BigInt(2),h0=BigInt(8),f0={zip215:!0};function d0(t){const e=u0(t);return Ta(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function p0(t){const e=d0(t),{Fp:r,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,l=ys<<BigInt(a*8)-ze,u=r.create,h=rf(e.n,e.nBitLength),f=e.uvRatio||((g,w)=>{try{return{isValid:!0,value:r.sqrt(g*r.inv(w))}}catch{return{isValid:!1,value:gt}}}),d=e.adjustScalarBytes||(g=>g),p=e.domain||((g,w,E)=>{if(Ln("phflag",E),w.length||E)throw new Error("Contexts/pre-hash are not supported");return g});function y(g,w){xi("coordinate "+g,w,gt,l)}function m(g){if(!(g instanceof b))throw new Error("ExtendedPoint expected")}const x=Nc((g,w)=>{const{ex:E,ey:I,ez:v}=g,_=g.is0();w==null&&(w=_?h0:r.inv(v));const R=u(E*w),N=u(I*w),z=u(v*w);if(_)return{x:gt,y:ze};if(z!==ze)throw new Error("invZ was invalid");return{x:R,y:N}}),D=Nc(g=>{const{a:w,d:E}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:I,ey:v,ez:_,et:R}=g,N=u(I*I),z=u(v*v),k=u(_*_),M=u(k*k),H=u(N*w),G=u(k*u(H+z)),J=u(M+u(E*u(N*z)));if(G!==J)throw new Error("bad point: equation left != right (1)");const W=u(I*v),ie=u(_*R);if(W!==ie)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(w,E,I,v){this.ex=w,this.ey=E,this.ez=I,this.et=v,y("x",w),y("y",E),y("z",I),y("t",v),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof b)throw new Error("extended point not allowed");const{x:E,y:I}=w||{};return y("x",E),y("y",I),new b(E,I,ze,u(E*I))}static normalizeZ(w){const E=r.invertBatch(w.map(I=>I.ez));return w.map((I,v)=>I.toAffine(E[v])).map(b.fromAffine)}static msm(w,E){return l0(b,h,w,E)}_setWindowSize(w){T.setWindowSize(this,w)}assertValidity(){D(this)}equals(w){m(w);const{ex:E,ey:I,ez:v}=this,{ex:_,ey:R,ez:N}=w,z=u(E*N),k=u(_*v),M=u(I*N),H=u(R*v);return z===k&&M===H}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:w}=e,{ex:E,ey:I,ez:v}=this,_=u(E*E),R=u(I*I),N=u(ys*u(v*v)),z=u(w*_),k=E+I,M=u(u(k*k)-_-R),H=z+R,G=H-N,J=z-R,W=u(M*G),ie=u(H*J),we=u(M*J),Xe=u(G*H);return new b(W,ie,Xe,we)}add(w){m(w);const{a:E,d:I}=e,{ex:v,ey:_,ez:R,et:N}=this,{ex:z,ey:k,ez:M,et:H}=w;if(E===BigInt(-1)){const oc=u((_-v)*(k+z)),ac=u((_+v)*(k-z)),Cn=u(ac-oc);if(Cn===gt)return this.double();const cc=u(R*ys*H),lc=u(N*ys*M),uc=lc+cc,hc=ac+oc,fc=lc-cc,Kp=u(uc*Cn),Vp=u(hc*fc),Hp=u(uc*fc),Wp=u(Cn*hc);return new b(Kp,Vp,Wp,Hp)}const G=u(v*z),J=u(_*k),W=u(N*I*H),ie=u(R*M),we=u((v+_)*(z+k)-G-J),Xe=ie-W,_t=ie+W,jt=u(J-E*G),Pn=u(we*Xe),Mp=u(_t*jt),qp=u(we*jt),zp=u(Xe*_t);return new b(Pn,Mp,zp,qp)}subtract(w){return this.add(w.negate())}wNAF(w){return T.wNAFCached(this,w,b.normalizeZ)}multiply(w){const E=w;xi("scalar",E,ze,i);const{p:I,f:v}=this.wNAF(E);return b.normalizeZ([I,v])[0]}multiplyUnsafe(w,E=b.ZERO){const I=w;return xi("scalar",I,gt,i),I===gt?C:this.is0()||I===ze?this:T.wNAFCachedUnsafe(this,I,b.normalizeZ,E)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return T.unsafeLadder(this,i).is0()}toAffine(w){return x(this,w)}clearCofactor(){const{h:w}=e;return w===ze?this:this.multiplyUnsafe(w)}static fromHex(w,E=!1){const{d:I,a:v}=e,_=r.BYTES;w=Lt("pointHex",w,_),Ln("zip215",E);const R=w.slice(),N=w[_-1];R[_-1]=N&-129;const z=Ns(R),k=E?l:r.ORDER;xi("pointHex.y",z,gt,k);const M=u(z*z),H=u(M-ze),G=u(I*M-v);let{isValid:J,value:W}=f(H,G);if(!J)throw new Error("Point.fromHex: invalid y coordinate");const ie=(W&ze)===ze,we=(N&128)!==0;if(!E&&W===gt&&we)throw new Error("Point.fromHex: x=0 and x_0=1");return we!==ie&&(W=u(-W)),b.fromAffine({x:W,y:z})}static fromPrivateKey(w){return O(w).point}toRawBytes(){const{x:w,y:E}=this.toAffine(),I=Ro(E,r.BYTES);return I[I.length-1]|=w&ze?128:0,I}toHex(){return Ca(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,ze,u(e.Gx*e.Gy)),b.ZERO=new b(gt,ze,ze,gt);const{BASE:A,ZERO:C}=b,T=c0(b,a*8);function j(g){return be(g,i)}function U(g){return j(Ns(g))}function O(g){const w=r.BYTES;g=Lt("private key",g,w);const E=Lt("hashed private key",n(g),2*w),I=d(E.slice(0,w)),v=E.slice(w,2*w),_=U(I),R=A.multiply(_),N=R.toRawBytes();return{head:I,prefix:v,scalar:_,point:R,pointBytes:N}}function K(g){return O(g).pointBytes}function V(g=new Uint8Array,...w){const E=Bc(...w);return U(n(p(E,Lt("context",g),!!s)))}function P(g,w,E={}){g=Lt("message",g),s&&(g=s(g));const{prefix:I,scalar:v,pointBytes:_}=O(w),R=V(E.context,I,g),N=A.multiply(R).toRawBytes(),z=V(E.context,N,_,g),k=j(R+z*v);xi("signature.s",k,gt,i);const M=Bc(N,Ro(k,r.BYTES));return Lt("result",M,r.BYTES*2)}const S=f0;function $(g,w,E,I=S){const{context:v,zip215:_}=I,R=r.BYTES;g=Lt("signature",g,2*R),w=Lt("message",w),E=Lt("publicKey",E,R),_!==void 0&&Ln("zip215",_),s&&(w=s(w));const N=Ns(g.slice(R,2*R));let z,k,M;try{z=b.fromHex(E,_),k=b.fromHex(g.slice(0,R),_),M=A.multiplyUnsafe(N)}catch{return!1}if(!_&&z.isSmallOrder())return!1;const H=V(v,k.toRawBytes(),z.toRawBytes(),w);return k.add(z.multiplyUnsafe(H)).subtract(M).clearCofactor().equals(b.ZERO)}return A._setWindowSize(8),{CURVE:e,getPublicKey:K,sign:P,verify:$,ExtendedPoint:b,utils:{getExtendedPublicKey:O,randomPrivateKey:()=>o(r.BYTES),precompute(g=8,w=b.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const Ra=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Lc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const g0=BigInt(1),Mc=BigInt(2);BigInt(3);const y0=BigInt(5),w0=BigInt(8);function m0(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=Ra,o=t*t%n*t%n,a=xt(o,Mc,n)*o%n,c=xt(a,g0,n)*t%n,l=xt(c,y0,n)*c%n,u=xt(l,e,n)*l%n,h=xt(u,r,n)*u%n,f=xt(h,i,n)*h%n,d=xt(f,s,n)*f%n,p=xt(d,s,n)*f%n,y=xt(p,e,n)*l%n;return{pow_p_5_8:xt(y,Mc,n)*t%n,b2:o}}function b0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function v0(t,e){const r=Ra,i=be(e*e*e,r),s=be(i*i*e,r),n=m0(t*s).pow_p_5_8;let o=be(t*i*n,r);const a=be(e*o*o,r),c=o,l=be(o*Lc,r),u=a===t,h=a===be(-t,r),f=a===be(-t*Lc,r);return u&&(o=c),(h||f)&&(o=l),t0(o,r)&&(o=be(-o,r)),{isValid:u||h,value:o}}const E0=rf(Ra,void 0,!0),_0={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:E0,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:w0,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:zw,randomBytes:Yh,adjustScalarBytes:b0,uvRatio:v0},of=p0(_0),x0="EdDSA",I0="JWT",Ws=".",hn="base64url",af="utf8",cf="utf8",S0=":",$0="did",D0="key",qc="base58btc",O0="z",A0="K36",P0=32;function Ba(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function lf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ba(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function uf(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=lf(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Ba(r)}function C0(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,m=0,x=0,D=p.length;x!==D&&p[x]===0;)x++,y++;for(var b=(D-x)*u+1>>>0,A=new Uint8Array(b);x!==D;){for(var C=p[x],T=0,j=b-1;(C!==0||T<m)&&j!==-1;j--,T++)C+=256*A[j]>>>0,A[j]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");m=T,x++}for(var U=b-m;U!==b&&A[U]===0;)U++;for(var O=c.repeat(y);U<b;++U)O+=t.charAt(A[U]);return O}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var m=0,x=0;p[y]===c;)m++,y++;for(var D=(p.length-y)*l+1>>>0,b=new Uint8Array(D);p[y];){var A=r[p.charCodeAt(y)];if(A===255)return;for(var C=0,T=D-1;(A!==0||C<x)&&T!==-1;T--,C++)A+=a*b[T]>>>0,b[T]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");x=C,y++}if(p[y]!==" "){for(var j=D-x;j!==D&&b[j]===0;)j++;for(var U=new Uint8Array(m+(D-j)),O=m;j!==D;)U[O++]=b[j++];return U}}}function d(p){var y=f(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var T0=C0,R0=T0;const hf=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},B0=t=>new TextEncoder().encode(t),N0=t=>new TextDecoder().decode(t);let U0=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},j0=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ff(this,e)}},F0=class{constructor(e){this.decoders=e}or(e){return ff(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ff=(t,e)=>new F0({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let k0=class{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new U0(e,r,i),this.decoder=new j0(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const fn=({name:t,prefix:e,encode:r,decode:i})=>new k0(t,e,r,i),rs=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=R0(r,e);return fn({prefix:t,name:e,encode:i,decode:n=>hf(s(n))})},L0=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},M0=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Ae=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>fn({prefix:e,name:t,encode(s){return M0(s,i,r)},decode(s){return L0(s,i,r,t)}}),q0=fn({prefix:"\0",name:"identity",encode:t=>N0(t),decode:t=>B0(t)});var z0=Object.freeze({__proto__:null,identity:q0});const K0=Ae({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var V0=Object.freeze({__proto__:null,base2:K0});const H0=Ae({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var W0=Object.freeze({__proto__:null,base8:H0});const G0=rs({prefix:"9",name:"base10",alphabet:"0123456789"});var Y0=Object.freeze({__proto__:null,base10:G0});const Z0=Ae({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),J0=Ae({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var X0=Object.freeze({__proto__:null,base16:Z0,base16upper:J0});const Q0=Ae({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),em=Ae({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),tm=Ae({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rm=Ae({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),im=Ae({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sm=Ae({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),nm=Ae({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),om=Ae({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),am=Ae({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var cm=Object.freeze({__proto__:null,base32:Q0,base32upper:em,base32pad:tm,base32padupper:rm,base32hex:im,base32hexupper:sm,base32hexpad:nm,base32hexpadupper:om,base32z:am});const lm=rs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),um=rs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var hm=Object.freeze({__proto__:null,base36:lm,base36upper:um});const fm=rs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dm=rs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var pm=Object.freeze({__proto__:null,base58btc:fm,base58flickr:dm});const gm=Ae({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ym=Ae({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wm=Ae({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mm=Ae({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var bm=Object.freeze({__proto__:null,base64:gm,base64pad:ym,base64url:wm,base64urlpad:mm});const df=Array.from(""),vm=df.reduce((t,e,r)=>(t[r]=e,t),[]),Em=df.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function _m(t){return t.reduce((e,r)=>(e+=vm[r],e),"")}function xm(t){const e=[];for(const r of t){const i=Em[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Im=fn({prefix:"",name:"base256emoji",encode:_m,decode:xm});var Sm=Object.freeze({__proto__:null,base256emoji:Im}),$m=pf,zc=128,Dm=-128,Om=Math.pow(2,31);function pf(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Om;)e[r++]=t&255|zc,t/=128;for(;t&Dm;)e[r++]=t&255|zc,t>>>=7;return e[r]=t|0,pf.bytes=r-i+1,e}var Am=No,Pm=128,Kc=127;function No(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw No.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&Kc)<<s:(o&Kc)*Math.pow(2,s),s+=7}while(o>=Pm);return No.bytes=n-i,r}var Cm=Math.pow(2,7),Tm=Math.pow(2,14),Rm=Math.pow(2,21),Bm=Math.pow(2,28),Nm=Math.pow(2,35),Um=Math.pow(2,42),jm=Math.pow(2,49),Fm=Math.pow(2,56),km=Math.pow(2,63),Lm=function(t){return t<Cm?1:t<Tm?2:t<Rm?3:t<Bm?4:t<Nm?5:t<Um?6:t<jm?7:t<Fm?8:t<km?9:10},Mm={encode:$m,decode:Am,encodingLength:Lm},gf=Mm;const Vc=(t,e,r=0)=>(gf.encode(t,e,r),e),Hc=t=>gf.encodingLength(t),Uo=(t,e)=>{const r=e.byteLength,i=Hc(t),s=i+Hc(r),n=new Uint8Array(s+r);return Vc(t,n,0),Vc(r,n,i),n.set(e,s),new qm(t,r,e,n)};let qm=class{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}};const yf=({name:t,code:e,encode:r})=>new zm(t,e,r);let zm=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Uo(this.code,r):r.then(i=>Uo(this.code,i))}else throw Error("Unknown type, must be binary type")}};const wf=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Km=yf({name:"sha2-256",code:18,encode:wf("SHA-256")}),Vm=yf({name:"sha2-512",code:19,encode:wf("SHA-512")});var Hm=Object.freeze({__proto__:null,sha256:Km,sha512:Vm});const mf=0,Wm="identity",bf=hf,Gm=t=>Uo(mf,bf(t)),Ym={code:mf,name:Wm,encode:bf,digest:Gm};var Zm=Object.freeze({__proto__:null,identity:Ym});new TextEncoder,new TextDecoder;const Wc={...z0,...V0,...W0,...Y0,...X0,...cm,...hm,...pm,...bm,...Sm};({...Hm,...Zm});function vf(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Gc=vf("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Hn=vf("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=lf(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ef={utf8:Gc,"utf-8":Gc,hex:Wc.base16,latin1:Hn,ascii:Hn,binary:Hn,...Wc};function dn(t,e="utf8"){const r=Ef[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function gi(t,e="utf8"){const r=Ef[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ba(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Yc(t){return Nr(dn(gi(t,hn),af))}function Gs(t){return dn(gi(Zt(t),af),hn)}function _f(t){const e=gi(A0,qc),r=O0+dn(uf([e,t]),qc);return[$0,D0,r].join(S0)}function Jm(t){return dn(t,hn)}function Xm(t){return gi(t,hn)}function Qm(t){return gi([Gs(t.header),Gs(t.payload)].join(Ws),cf)}function eb(t){return[Gs(t.header),Gs(t.payload),Jm(t.signature)].join(Ws)}function jo(t){const e=t.split(Ws),r=Yc(e[0]),i=Yc(e[1]),s=Xm(e[2]),n=gi(e.slice(0,2).join(Ws),cf);return{header:r,payload:i,signature:s,data:n}}function Zc(t=Yh(P0)){const e=of.getPublicKey(t);return{secretKey:uf([t,e]),publicKey:e}}async function tb(t,e,r,i,s=F.fromMiliseconds(Date.now())){const n={alg:x0,typ:I0},o=_f(i.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},l=Qm({header:n,payload:c}),u=of.sign(l,i.secretKey.slice(0,32));return eb({header:n,payload:c,signature:u})}function Na(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function xf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Na(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Mi(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=xf(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Na(r)}function rb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,m=0,x=0,D=p.length;x!==D&&p[x]===0;)x++,y++;for(var b=(D-x)*u+1>>>0,A=new Uint8Array(b);x!==D;){for(var C=p[x],T=0,j=b-1;(C!==0||T<m)&&j!==-1;j--,T++)C+=256*A[j]>>>0,A[j]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");m=T,x++}for(var U=b-m;U!==b&&A[U]===0;)U++;for(var O=c.repeat(y);U<b;++U)O+=t.charAt(A[U]);return O}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var m=0,x=0;p[y]===c;)m++,y++;for(var D=(p.length-y)*l+1>>>0,b=new Uint8Array(D);p[y];){var A=r[p.charCodeAt(y)];if(A===255)return;for(var C=0,T=D-1;(A!==0||C<x)&&T!==-1;T--,C++)A+=a*b[T]>>>0,b[T]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");x=C,y++}if(p[y]!==" "){for(var j=D-x;j!==D&&b[j]===0;)j++;for(var U=new Uint8Array(m+(D-j)),O=m;j!==D;)U[O++]=b[j++];return U}}}function d(p){var y=f(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var ib=rb,sb=ib;const nb=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},ob=t=>new TextEncoder().encode(t),ab=t=>new TextDecoder().decode(t);class cb{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class lb{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return If(this,e)}}class ub{constructor(e){this.decoders=e}or(e){return If(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const If=(t,e)=>new ub({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class hb{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new cb(e,r,i),this.decoder=new lb(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const pn=({name:t,prefix:e,encode:r,decode:i})=>new hb(t,e,r,i),is=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=sb(r,e);return pn({prefix:t,name:e,encode:i,decode:n=>nb(s(n))})},fb=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},db=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Pe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>pn({prefix:e,name:t,encode(s){return db(s,i,r)},decode(s){return fb(s,i,r,t)}}),pb=pn({prefix:"\0",name:"identity",encode:t=>ab(t),decode:t=>ob(t)}),gb=Object.freeze(Object.defineProperty({__proto__:null,identity:pb},Symbol.toStringTag,{value:"Module"})),yb=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),wb=Object.freeze(Object.defineProperty({__proto__:null,base2:yb},Symbol.toStringTag,{value:"Module"})),mb=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),bb=Object.freeze(Object.defineProperty({__proto__:null,base8:mb},Symbol.toStringTag,{value:"Module"})),vb=is({prefix:"9",name:"base10",alphabet:"0123456789"}),Eb=Object.freeze(Object.defineProperty({__proto__:null,base10:vb},Symbol.toStringTag,{value:"Module"})),_b=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xb=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ib=Object.freeze(Object.defineProperty({__proto__:null,base16:_b,base16upper:xb},Symbol.toStringTag,{value:"Module"})),Sb=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),$b=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Db=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ob=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ab=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Pb=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Cb=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Tb=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Rb=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Bb=Object.freeze(Object.defineProperty({__proto__:null,base32:Sb,base32hex:Ab,base32hexpad:Cb,base32hexpadupper:Tb,base32hexupper:Pb,base32pad:Db,base32padupper:Ob,base32upper:$b,base32z:Rb},Symbol.toStringTag,{value:"Module"})),Nb=is({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ub=is({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),jb=Object.freeze(Object.defineProperty({__proto__:null,base36:Nb,base36upper:Ub},Symbol.toStringTag,{value:"Module"})),Fb=is({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kb=is({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Lb=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Fb,base58flickr:kb},Symbol.toStringTag,{value:"Module"})),Mb=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),qb=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zb=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Kb=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Vb=Object.freeze(Object.defineProperty({__proto__:null,base64:Mb,base64pad:qb,base64url:zb,base64urlpad:Kb},Symbol.toStringTag,{value:"Module"})),Sf=Array.from(""),Hb=Sf.reduce((t,e,r)=>(t[r]=e,t),[]),Wb=Sf.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Gb(t){return t.reduce((e,r)=>(e+=Hb[r],e),"")}function Yb(t){const e=[];for(const r of t){const i=Wb[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Zb=pn({prefix:"",name:"base256emoji",encode:Gb,decode:Yb}),Jb=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Zb},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Jc={...gb,...wb,...bb,...Eb,...Ib,...Bb,...jb,...Lb,...Vb,...Jb};function $f(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Xc=$f("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Wn=$f("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=xf(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Df={utf8:Xc,"utf-8":Xc,hex:Jc.base16,latin1:Wn,ascii:Wn,binary:Wn,...Jc};function ft(t,e="utf8"){const r=Df[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Na(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Ze(t,e="utf8"){const r=Df[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const Xb={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},Qb="Input must be an string, Buffer or Uint8Array";function e1(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(Qb);return e}function t1(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function ws(t){return(4294967296+t).toString(16).substring(1)}function r1(t,e,r){let i=`
`+t+" = ";for(let s=0;s<e.length;s+=2){if(r===32)i+=ws(e[s]).toUpperCase(),i+=" ",i+=ws(e[s+1]).toUpperCase();else if(r===64)i+=ws(e[s+1]).toUpperCase(),i+=ws(e[s]).toUpperCase();else throw new Error("Invalid size "+r);s%6===4?i+=`
`+new Array(t.length+4).join(" "):s<e.length-2&&(i+=" ")}console.log(i)}function i1(t,e,r){let i=new Date().getTime();const s=new Uint8Array(e);for(let o=0;o<e;o++)s[o]=o%256;const n=new Date().getTime();console.log("Generated random input in "+(n-i)+"ms"),i=n;for(let o=0;o<r;o++){const a=t(s),c=new Date().getTime(),l=c-i;i=c,console.log("Hashed in "+l+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(l/1e3)*100)/100+" MB PER SECOND")}}var Of={normalizeInput:e1,toHex:t1,debugPrint:r1,testSpeed:i1};const Us=Of;function ms(t,e,r){const i=t[e]+t[r];let s=t[e+1]+t[r+1];i>=4294967296&&s++,t[e]=i,t[e+1]=s}function Qc(t,e,r,i){let s=t[e]+r;r<0&&(s+=4294967296);let n=t[e+1]+i;s>=4294967296&&n++,t[e]=s,t[e+1]=n}function Af(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function er(t,e,r,i,s,n){const o=Ui[s],a=Ui[s+1],c=Ui[n],l=Ui[n+1];ms(Y,t,e),Qc(Y,t,o,a);let u=Y[i]^Y[t],h=Y[i+1]^Y[t+1];Y[i]=h,Y[i+1]=u,ms(Y,r,i),u=Y[e]^Y[r],h=Y[e+1]^Y[r+1],Y[e]=u>>>24^h<<8,Y[e+1]=h>>>24^u<<8,ms(Y,t,e),Qc(Y,t,c,l),u=Y[i]^Y[t],h=Y[i+1]^Y[t+1],Y[i]=u>>>16^h<<16,Y[i+1]=h>>>16^u<<16,ms(Y,r,i),u=Y[e]^Y[r],h=Y[e+1]^Y[r+1],Y[e]=h>>>31^u<<1,Y[e+1]=u>>>31^h<<1}const Pf=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),s1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],Te=new Uint8Array(s1.map(function(t){return t*2})),Y=new Uint32Array(32),Ui=new Uint32Array(32);function Cf(t,e){let r=0;for(r=0;r<16;r++)Y[r]=t.h[r],Y[r+16]=Pf[r];for(Y[24]=Y[24]^t.t,Y[25]=Y[25]^t.t/4294967296,e&&(Y[28]=~Y[28],Y[29]=~Y[29]),r=0;r<32;r++)Ui[r]=Af(t.b,4*r);for(r=0;r<12;r++)er(0,8,16,24,Te[r*16+0],Te[r*16+1]),er(2,10,18,26,Te[r*16+2],Te[r*16+3]),er(4,12,20,28,Te[r*16+4],Te[r*16+5]),er(6,14,22,30,Te[r*16+6],Te[r*16+7]),er(0,10,20,30,Te[r*16+8],Te[r*16+9]),er(2,12,22,24,Te[r*16+10],Te[r*16+11]),er(4,14,16,26,Te[r*16+12],Te[r*16+13]),er(6,8,18,28,Te[r*16+14],Te[r*16+15]);for(r=0;r<16;r++)t.h[r]=t.h[r]^Y[r]^Y[r+16]}const tr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Tf(t,e,r,i){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(r&&r.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(i&&i.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const s={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};tr.fill(0),tr[0]=t,e&&(tr[1]=e.length),tr[2]=1,tr[3]=1,r&&tr.set(r,32),i&&tr.set(i,48);for(let n=0;n<16;n++)s.h[n]=Pf[n]^Af(tr,n*4);return e&&(Ua(s,e),s.c=128),s}function Ua(t,e){for(let r=0;r<e.length;r++)t.c===128&&(t.t+=t.c,Cf(t,!1),t.c=0),t.b[t.c++]=e[r]}function Rf(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;Cf(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3);return e}function Bf(t,e,r,i,s){r=r||64,t=Us.normalizeInput(t),i&&(i=Us.normalizeInput(i)),s&&(s=Us.normalizeInput(s));const n=Tf(r,e,i,s);return Ua(n,t),Rf(n)}function n1(t,e,r,i,s){const n=Bf(t,e,r,i,s);return Us.toHex(n)}var o1={blake2b:Bf,blake2bHex:n1,blake2bInit:Tf,blake2bUpdate:Ua,blake2bFinal:Rf};const Nf=Of;function a1(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function rr(t,e,r,i,s,n){re[t]=re[t]+re[e]+s,re[i]=bs(re[i]^re[t],16),re[r]=re[r]+re[i],re[e]=bs(re[e]^re[r],12),re[t]=re[t]+re[e]+n,re[i]=bs(re[i]^re[t],8),re[r]=re[r]+re[i],re[e]=bs(re[e]^re[r],7)}function bs(t,e){return t>>>e^t<<32-e}const Uf=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Re=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),re=new Uint32Array(16),Ie=new Uint32Array(16);function jf(t,e){let r=0;for(r=0;r<8;r++)re[r]=t.h[r],re[r+8]=Uf[r];for(re[12]^=t.t,re[13]^=t.t/4294967296,e&&(re[14]=~re[14]),r=0;r<16;r++)Ie[r]=a1(t.b,4*r);for(r=0;r<10;r++)rr(0,4,8,12,Ie[Re[r*16+0]],Ie[Re[r*16+1]]),rr(1,5,9,13,Ie[Re[r*16+2]],Ie[Re[r*16+3]]),rr(2,6,10,14,Ie[Re[r*16+4]],Ie[Re[r*16+5]]),rr(3,7,11,15,Ie[Re[r*16+6]],Ie[Re[r*16+7]]),rr(0,5,10,15,Ie[Re[r*16+8]],Ie[Re[r*16+9]]),rr(1,6,11,12,Ie[Re[r*16+10]],Ie[Re[r*16+11]]),rr(2,7,8,13,Ie[Re[r*16+12]],Ie[Re[r*16+13]]),rr(3,4,9,14,Ie[Re[r*16+14]],Ie[Re[r*16+15]]);for(r=0;r<8;r++)t.h[r]^=re[r]^re[r+8]}function Ff(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const r=e?e.length:0;if(e&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");const i={h:new Uint32Array(Uf),b:new Uint8Array(64),c:0,t:0,outlen:t};return i.h[0]^=16842752^r<<8^t,r>0&&(ja(i,e),i.c=64),i}function ja(t,e){for(let r=0;r<e.length;r++)t.c===64&&(t.t+=t.c,jf(t,!1),t.c=0),t.b[t.c++]=e[r]}function kf(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;jf(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3)&255;return e}function Lf(t,e,r){r=r||32,t=Nf.normalizeInput(t);const i=Ff(r,e);return ja(i,t),kf(i)}function c1(t,e,r){const i=Lf(t,e,r);return Nf.toHex(i)}var l1={blake2s:Lf,blake2sHex:c1,blake2sInit:Ff,blake2sUpdate:ja,blake2sFinal:kf};const Ii=o1,Si=l1;var u1={blake2b:Ii.blake2b,blake2bHex:Ii.blake2bHex,blake2bInit:Ii.blake2bInit,blake2bUpdate:Ii.blake2bUpdate,blake2bFinal:Ii.blake2bFinal,blake2s:Si.blake2s,blake2sHex:Si.blake2sHex,blake2sInit:Si.blake2sInit,blake2sUpdate:Si.blake2sUpdate,blake2sFinal:Si.blake2sFinal},h1={};const f1=":";function Gt(t){const[e,r]=t.split(f1);return{namespace:e,reference:r}}function el(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const s=t[i];r.push(...s.accounts)}),r}function Mf(t,e){return t.includes(":")?[t]:e.chains||[]}var d1=Object.defineProperty,p1=Object.defineProperties,g1=Object.getOwnPropertyDescriptors,tl=Object.getOwnPropertySymbols,y1=Object.prototype.hasOwnProperty,w1=Object.prototype.propertyIsEnumerable,Fo=(t,e,r)=>e in t?d1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rl=(t,e)=>{for(var r in e||(e={}))y1.call(e,r)&&Fo(t,r,e[r]);if(tl)for(var r of tl(e))w1.call(e,r)&&Fo(t,r,e[r]);return t},m1=(t,e)=>p1(t,g1(e)),il=(t,e,r)=>Fo(t,typeof e!="symbol"?e+"":e,r);const b1="ReactNative",st={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},v1="js";function Ys(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function mr(){return!Rr()&&!!Ia()&&navigator.product===b1}function E1(){return mr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function _1(){return mr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function yi(){return!Ys()&&!!Ia()&&!!Rr()}function ss(){return mr()?st.reactNative:Ys()?st.node:yi()?st.browser:st.unknown}function sl(){var t;try{return mr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function x1(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!=null&&r.set(i,String(s))}),r.toString()}function I1(t){var e,r;const i=qf();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),m1(rl(rl({},i),t),{url:(t==null?void 0:t.url)||i.url,name:(t==null?void 0:t.name)||i.name,description:(t==null?void 0:t.description)||i.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),t||i}}function qf(){return Ph()||{name:"",description:"",url:"",icons:[""]}}function S1(){if(ss()===st.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=lg();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function $1(){var t;const e=ss();return e===st.browser?[e,((t=Ah())==null?void 0:t.host)||"unknown"].join(":"):e}function zf(t,e,r){const i=S1(),s=$1();return[[t,e].join("-"),[v1,r].join("-"),i,s].join("/")}function D1({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=zf(t,e,i),h={auth:s,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=x1(l[1]||"",h);return l[0]+"?"+f}function Ar(t,e){return t.filter(r=>e.includes(r)).length===t.length}function ko(t){return Object.fromEntries(t.entries())}function Lo(t){return new Map(Object.entries(t))}function Ir(t=F.FIVE_MINUTES,e){const r=F.toMiliseconds(t||F.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),i=a,s=c})}}function Tt(t,e,r){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(r)),e);try{const o=await t;i(o)}catch(o){s(o)}clearTimeout(n)})}function Kf(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function O1(t){return Kf("topic",t)}function A1(t){return Kf("id",t)}function Vf(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function ge(t,e){return F.fromMiliseconds(Date.now()+F.toMiliseconds(t))}function Ct(t){return Date.now()>=F.toMiliseconds(t)}function se(t,e){return`${t}${e?`:${e}`:""}`}function Rt(t=[],e=[]){return[...new Set([...t,...e])]}async function P1({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,n=s==null?void 0:s.href;if(typeof n!="string")return;const o=C1(n,t,e),a=ss();if(a===st.browser){if(!((i=Rr())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}T1(o)}else a===st.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function C1(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${U1(i,!0)}`}else s=`${s}/wc?${i}`;return s}function T1(t){let e="_self";N1()?e="_top":(B1()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function R1(t,e){let r="";try{if(yi()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function nl(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function ol(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Fa(){return typeof process<"u"&&h1.IS_VITEST==="true"}function B1(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function N1(){try{return window.self!==window.top}catch{return!1}}function U1(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Hf(t){return Buffer.from(t,"base64").toString("utf-8")}function j1(t){return new Promise(e=>setTimeout(e,t))}let F1=class{constructor({limit:e}){il(this,"limit"),il(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const vs=BigInt(2**32-1),al=BigInt(32);function Wf(t,e=!1){return e?{h:Number(t&vs),l:Number(t>>al&vs)}:{h:Number(t>>al&vs)|0,l:Number(t&vs)|0}}function Gf(t,e=!1){const r=t.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=Wf(t[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const cl=(t,e,r)=>t>>>r,ll=(t,e,r)=>t<<32-r|e>>>r,ur=(t,e,r)=>t>>>r|e<<32-r,hr=(t,e,r)=>t<<32-r|e>>>r,ji=(t,e,r)=>t<<64-r|e>>>r-32,Fi=(t,e,r)=>t>>>r-32|e<<64-r,k1=(t,e)=>e,L1=(t,e)=>t,M1=(t,e,r)=>t<<r|e>>>32-r,q1=(t,e,r)=>e<<r|t>>>32-r,z1=(t,e,r)=>e<<r-32|t>>>64-r,K1=(t,e,r)=>t<<r-32|e>>>64-r;function mt(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const ka=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),La=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,V1=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),H1=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,W1=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),G1=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,Hr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function gn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Et(t,...e){if(!gn(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function yn(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Jt(t.outputLen),Jt(t.blockLen)}function wr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ma(t,e){Et(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Gi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function pt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Gn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function It(t,e){return t<<32-e|t>>>e}const Yf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Zf(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Kt=Yf?t=>t:t=>Zf(t);function Y1(t){for(let e=0;e<t.length;e++)t[e]=Zf(t[e]);return t}const fr=Yf?t=>t:Y1,Jf=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Z1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function oi(t){if(Et(t),Jf)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Z1[t[r]];return e}const Mt={_0:48,_9:57,A:65,F:70,a:97,f:102};function ul(t){if(t>=Mt._0&&t<=Mt._9)return t-Mt._0;if(t>=Mt.A&&t<=Mt.F)return t-(Mt.A-10);if(t>=Mt.a&&t<=Mt.f)return t-(Mt.a-10)}function Zs(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Jf)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=ul(t.charCodeAt(n)),a=ul(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Xf(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function vt(t){return typeof t=="string"&&(t=Xf(t)),Et(t),t}function dr(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];Et(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class wn{}function ns(t){const e=i=>t().update(vt(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function J1(t){const e=(i,s)=>t(s).update(vt(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function kr(t=32){if(Hr&&typeof Hr.getRandomValues=="function")return Hr.getRandomValues(new Uint8Array(t));if(Hr&&typeof Hr.randomBytes=="function")return Uint8Array.from(Hr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const X1=BigInt(0),$i=BigInt(1),Q1=BigInt(2),ev=BigInt(7),tv=BigInt(256),rv=BigInt(113),Qf=[],ed=[],td=[];for(let t=0,e=$i,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Qf.push(2*(5*i+r)),ed.push((t+1)*(t+2)/2%64);let s=X1;for(let n=0;n<7;n++)e=(e<<$i^(e>>ev)*rv)%tv,e&Q1&&(s^=$i<<($i<<BigInt(n))-$i);td.push(s)}const rd=Gf(td,!0),iv=rd[0],sv=rd[1],hl=(t,e,r)=>r>32?z1(t,e,r):M1(t,e,r),fl=(t,e,r)=>r>32?K1(t,e,r):q1(t,e,r);function nv(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=hl(l,u,1)^r[a],f=fl(l,u,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=ed[o],c=hl(s,n,a),l=fl(s,n,a),u=Qf[o];s=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=iv[i],t[1]^=sv[i]}pt(r)}let ov=class id extends wn{constructor(e,r,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,Jt(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Gi(this.state)}clone(){return this._cloneInto()}keccak(){fr(this.state32),nv(this.state32,this.rounds),fr(this.state32),this.posOut=0,this.pos=0}update(e){wr(this),e=vt(e),Et(e);const{blockLen:r,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,r&128&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){wr(this,!1),Et(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Jt(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ma(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,pt(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new id(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const av=(t,e,r)=>ns(()=>new ov(e,t,r)),cv=av(1,136,256/8);function lv(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function uv(t,e,r){return t&e^~t&r}function hv(t,e,r){return t&e^t&r^e&r}let sd=class extends wn{constructor(e,r,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Gn(this.buffer)}update(e){wr(this),e=vt(e),Et(e);const{view:r,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Gn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){wr(this),Ma(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,pt(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;lv(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Gn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const ir=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Be=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ne=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),fv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),sr=new Uint32Array(64);class dv extends sd{constructor(e=32){super(64,e,8,!1),this.A=ir[0]|0,this.B=ir[1]|0,this.C=ir[2]|0,this.D=ir[3]|0,this.E=ir[4]|0,this.F=ir[5]|0,this.G=ir[6]|0,this.H=ir[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)sr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=sr[h-15],d=sr[h-2],p=It(f,7)^It(f,18)^f>>>3,y=It(d,17)^It(d,19)^d>>>10;sr[h]=y+sr[h-7]+p+sr[h-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=It(a,6)^It(a,11)^It(a,25),d=u+f+uv(a,c,l)+fv[h]+sr[h]|0,p=(It(i,2)^It(i,13)^It(i,22))+hv(i,s,n)|0;u=l,l=c,c=a,a=o+d|0,o=n,n=s,s=i,i=d+p|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,s,n,o,a,c,l,u)}roundClean(){pt(sr)}destroy(){this.set(0,0,0,0,0,0,0,0),pt(this.buffer)}}const nd=Gf(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),pv=nd[0],gv=nd[1],nr=new Uint32Array(80),or=new Uint32Array(80);let qa=class extends sd{constructor(e=64){super(128,e,16,!1),this.Ah=Ne[0]|0,this.Al=Ne[1]|0,this.Bh=Ne[2]|0,this.Bl=Ne[3]|0,this.Ch=Ne[4]|0,this.Cl=Ne[5]|0,this.Dh=Ne[6]|0,this.Dl=Ne[7]|0,this.Eh=Ne[8]|0,this.El=Ne[9]|0,this.Fh=Ne[10]|0,this.Fl=Ne[11]|0,this.Gh=Ne[12]|0,this.Gl=Ne[13]|0,this.Hh=Ne[14]|0,this.Hl=Ne[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:p,Hh:y,Hl:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,d,p,y,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,d,p,y,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=y|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)nr[b]=e.getUint32(r),or[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const A=nr[b-15]|0,C=or[b-15]|0,T=ur(A,C,1)^ur(A,C,8)^cl(A,C,7),j=hr(A,C,1)^hr(A,C,8)^ll(A,C,7),U=nr[b-2]|0,O=or[b-2]|0,K=ur(U,O,19)^ji(U,O,61)^cl(U,O,6),V=hr(U,O,19)^Fi(U,O,61)^ll(U,O,6),P=V1(j,V,or[b-7],or[b-16]),S=H1(P,T,K,nr[b-7],nr[b-16]);nr[b]=S|0,or[b]=P|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:p,Gh:y,Gl:m,Hh:x,Hl:D}=this;for(let b=0;b<80;b++){const A=ur(h,f,14)^ur(h,f,18)^ji(h,f,41),C=hr(h,f,14)^hr(h,f,18)^Fi(h,f,41),T=h&d^~h&y,j=f&p^~f&m,U=W1(D,C,j,gv[b],or[b]),O=G1(U,x,A,T,pv[b],nr[b]),K=U|0,V=ur(i,s,28)^ji(i,s,34)^ji(i,s,39),P=hr(i,s,28)^Fi(i,s,34)^Fi(i,s,39),S=i&n^i&a^n&a,$=s&o^s&c^o&c;x=y|0,D=m|0,y=d|0,m=p|0,d=h|0,p=f|0,{h,l:f}=mt(l|0,u|0,O|0,K|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const g=ka(K,P,$);i=La(g,O,V,S),s=g|0}({h:i,l:s}=mt(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=mt(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=mt(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=mt(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=mt(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=mt(this.Fh|0,this.Fl|0,d|0,p|0),{h:y,l:m}=mt(this.Gh|0,this.Gl|0,y|0,m|0),{h:x,l:D}=mt(this.Hh|0,this.Hl|0,x|0,D|0),this.set(i,s,n,o,a,c,l,u,h,f,d,p,y,m,x,D)}roundClean(){pt(nr,or)}destroy(){pt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class yv extends qa{constructor(){super(48),this.Ah=Be[0]|0,this.Al=Be[1]|0,this.Bh=Be[2]|0,this.Bl=Be[3]|0,this.Ch=Be[4]|0,this.Cl=Be[5]|0,this.Dh=Be[6]|0,this.Dl=Be[7]|0,this.Eh=Be[8]|0,this.El=Be[9]|0,this.Fh=Be[10]|0,this.Fl=Be[11]|0,this.Gh=Be[12]|0,this.Gl=Be[13]|0,this.Hh=Be[14]|0,this.Hl=Be[15]|0}}const Ue=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class wv extends qa{constructor(){super(32),this.Ah=Ue[0]|0,this.Al=Ue[1]|0,this.Bh=Ue[2]|0,this.Bl=Ue[3]|0,this.Ch=Ue[4]|0,this.Cl=Ue[5]|0,this.Dh=Ue[6]|0,this.Dl=Ue[7]|0,this.Eh=Ue[8]|0,this.El=Ue[9]|0,this.Fh=Ue[10]|0,this.Fl=Ue[11]|0,this.Gh=Ue[12]|0,this.Gl=Ue[13]|0,this.Hh=Ue[14]|0,this.Hl=Ue[15]|0}}const mn=ns(()=>new dv),mv=ns(()=>new qa),bv=ns(()=>new yv),vv=ns(()=>new wv),Ev=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),me=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),q=new Uint32Array(32);function ar(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=q[2*t],l=q[2*t+1],u=q[2*e],h=q[2*e+1],f=q[2*r],d=q[2*r+1],p=q[2*i],y=q[2*i+1],m=ka(c,u,o);l=La(m,l,h,a),c=m|0,{Dh:y,Dl:p}={Dh:y^l,Dl:p^c},{Dh:y,Dl:p}={Dh:k1(y,p),Dl:L1(y)},{h:d,l:f}=mt(d,f,y,p),{Bh:h,Bl:u}={Bh:h^d,Bl:u^f},{Bh:h,Bl:u}={Bh:ur(h,u,24),Bl:hr(h,u,24)},q[2*t]=c,q[2*t+1]=l,q[2*e]=u,q[2*e+1]=h,q[2*r]=f,q[2*r+1]=d,q[2*i]=p,q[2*i+1]=y}function cr(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=q[2*t],l=q[2*t+1],u=q[2*e],h=q[2*e+1],f=q[2*r],d=q[2*r+1],p=q[2*i],y=q[2*i+1],m=ka(c,u,o);l=La(m,l,h,a),c=m|0,{Dh:y,Dl:p}={Dh:y^l,Dl:p^c},{Dh:y,Dl:p}={Dh:ur(y,p,16),Dl:hr(y,p,16)},{h:d,l:f}=mt(d,f,y,p),{Bh:h,Bl:u}={Bh:h^d,Bl:u^f},{Bh:h,Bl:u}={Bh:ji(h,u,63),Bl:Fi(h,u,63)},q[2*t]=c,q[2*t+1]=l,q[2*e]=u,q[2*e+1]=h,q[2*r]=f,q[2*r+1]=d,q[2*i]=p,q[2*i+1]=y}function _v(t,e={},r,i,s){if(Jt(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:n,salt:o,personalization:a}=e;if(n!==void 0&&(n.length<1||n.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class xv extends wn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Jt(e),Jt(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Gi(this.buffer)}update(e){wr(this),e=vt(e),Et(e);const{blockLen:r,buffer:i,buffer32:s}=this,n=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<n;){this.pos===r&&(fr(s),this.compress(s,0,!1),fr(s),this.pos=0);const l=Math.min(r-this.pos,n-c),u=o+c;if(l===r&&!(u%4)&&c+l<n){const h=new Uint32Array(a,u,Math.floor((n-c)/4));fr(h);for(let f=0;c+r<n;f+=s.length,c+=r)this.length+=r,this.compress(h,f,!1);fr(h);continue}i.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){wr(this),Ma(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,pt(this.buffer.subarray(r)),fr(i),this.compress(i,0,!0),fr(i);const s=Gi(e);this.get().forEach((n,o)=>s[o]=Kt(n))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:s,destroyed:n,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=n,e.finished=s,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class Iv extends xv{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=me[0]|0,this.v0h=me[1]|0,this.v1l=me[2]|0,this.v1h=me[3]|0,this.v2l=me[4]|0,this.v2h=me[5]|0,this.v3l=me[6]|0,this.v3h=me[7]|0,this.v4l=me[8]|0,this.v4h=me[9]|0,this.v5l=me[10]|0,this.v5h=me[11]|0,this.v6l=me[12]|0,this.v6h=me[13]|0,this.v7l=me[14]|0,this.v7h=me[15]|0,_v(r,e,64,16,16);let{key:i,personalization:s,salt:n}=e,o=0;if(i!==void 0&&(i=vt(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,n!==void 0){n=vt(n);const a=Gi(n);this.v4l^=Kt(a[0]),this.v4h^=Kt(a[1]),this.v5l^=Kt(a[2]),this.v5h^=Kt(a[3])}if(s!==void 0){s=vt(s);const a=Gi(s);this.v6l^=Kt(a[0]),this.v6h^=Kt(a[1]),this.v7l^=Kt(a[2]),this.v7h^=Kt(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:s,v2l:n,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:d,v6h:p,v7l:y,v7h:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,d,p,y,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,d,p,y,m){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=s|0,this.v2l=n|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=d|0,this.v6h=p|0,this.v7l=y|0,this.v7h=m|0}compress(e,r,i){this.get().forEach((c,l)=>q[l]=c),q.set(me,16);let{h:s,l:n}=Wf(BigInt(this.length));q[24]=me[8]^n,q[25]=me[9]^s,i&&(q[28]=~q[28],q[29]=~q[29]);let o=0;const a=Ev;for(let c=0;c<12;c++)ar(0,4,8,12,e,r+2*a[o++]),cr(0,4,8,12,e,r+2*a[o++]),ar(1,5,9,13,e,r+2*a[o++]),cr(1,5,9,13,e,r+2*a[o++]),ar(2,6,10,14,e,r+2*a[o++]),cr(2,6,10,14,e,r+2*a[o++]),ar(3,7,11,15,e,r+2*a[o++]),cr(3,7,11,15,e,r+2*a[o++]),ar(0,5,10,15,e,r+2*a[o++]),cr(0,5,10,15,e,r+2*a[o++]),ar(1,6,11,12,e,r+2*a[o++]),cr(1,6,11,12,e,r+2*a[o++]),ar(2,7,8,13,e,r+2*a[o++]),cr(2,7,8,13,e,r+2*a[o++]),ar(3,4,9,14,e,r+2*a[o++]),cr(3,4,9,14,e,r+2*a[o++]);this.v0l^=q[0]^q[16],this.v0h^=q[1]^q[17],this.v1l^=q[2]^q[18],this.v1h^=q[3]^q[19],this.v2l^=q[4]^q[20],this.v2h^=q[5]^q[21],this.v3l^=q[6]^q[22],this.v3h^=q[7]^q[23],this.v4l^=q[8]^q[24],this.v4h^=q[9]^q[25],this.v5l^=q[10]^q[26],this.v5h^=q[11]^q[27],this.v6l^=q[12]^q[28],this.v6h^=q[13]^q[29],this.v7l^=q[14]^q[30],this.v7h^=q[15]^q[31],pt(q)}destroy(){this.destroyed=!0,pt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Sv=J1(t=>new Iv(t)),$v="https://rpc.walletconnect.org/v1";function od(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(cv(r)).toString("hex")}async function Dv(t,e,r,i,s,n){switch(r.t){case"eip191":return await Ov(t,e,r.s);case"eip1271":return await Av(t,e,r.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function Ov(t,e,r){return(await wy({hash:od(e),signature:r})).toLowerCase()===t.toLowerCase()}async function Av(t,e,r,i,s,n){const o=Gt(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:od(e)).substring(2),f=a+h+c+u+l,d=await fetch(`${n||$v}/?chainId=${i}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Pv(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:p}=await d.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Pv(){return Date.now()+Math.floor(Math.random()*1e3)}function Cv(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const n=Buffer.from(t,"base64").slice(1,65);return ts.encode(n)}function Tv(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(n=>n.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const s=Sv(i,{dkLen:32});return ts.encode(s)}function dl(t){const e=new Uint8Array(mn(Rv(t)));return ts.encode(e)}function Rv(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function pl(t){const e=Buffer.from(t,"base64"),r=tw(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=Hy(r),s=Buffer.from("TX"),n=Buffer.concat([s,Buffer.from(i)]),o=vv(n);return lw.encode(o).replace(/=+$/,"")}function Yn(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function Bv(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(Yn(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(Yn(r.length)),s.push(r),s.push(Buffer.from([26])),s.push(Yn(i.length)),s.push(i);const n=Buffer.concat(s),o=mn(n);return Buffer.from(o).toString("hex").toUpperCase()}function Nv(t){var e,r;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const s=(r=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&i.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return i}var Uv=Object.defineProperty,jv=Object.defineProperties,Fv=Object.getOwnPropertyDescriptors,gl=Object.getOwnPropertySymbols,kv=Object.prototype.hasOwnProperty,Lv=Object.prototype.propertyIsEnumerable,yl=(t,e,r)=>e in t?Uv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mv=(t,e)=>{for(var r in e||(e={}))kv.call(e,r)&&yl(t,r,e[r]);if(gl)for(var r of gl(e))Lv.call(e,r)&&yl(t,r,e[r]);return t},qv=(t,e)=>jv(t,Fv(e));const zv="did:pkh:",za=t=>t==null?void 0:t.split(":"),Kv=t=>{const e=t&&za(t);if(e)return t.includes(zv)?e[3]:e[1]},Mo=t=>{const e=t&&za(t);if(e)return e[2]+":"+e[3]},Js=t=>{const e=t&&za(t);if(e)return e.pop()};async function wl(t){const{cacao:e,projectId:r}=t,{s:i,p:s}=e,n=ad(s,s.iss),o=Js(s.iss);return await Dv(o,n,i,Mo(s.iss),r)}const ad=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,i=Js(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${Kv(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(y=>`
- ${y}`).join("")}`:void 0,p=js(t.resources);if(p){const y=Yi(p);s=Qv(s,y)}return[r,i,"",s,"",n,o,a,c,l,u,h,f,d].filter(y=>y!=null).join(`
`)};function Vv(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function Hv(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Ur(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function Wv(t,e,r,i={}){return r==null||r.sort((s,n)=>s.localeCompare(n)),{att:{[t]:Gv(e,r,i)}}}function Gv(t,e,r={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...i)}function cd(t){return Ur(t),`urn:recap:${Vv(t).replace(/=/g,"")}`}function Yi(t){const e=Hv(t.replace("urn:recap:",""));return Ur(e),e}function Yv(t,e,r){const i=Wv(t,e,r);return cd(i)}function Zv(t){return t&&t.includes("urn:recap:")}function Jv(t,e){const r=Yi(t),i=Yi(e),s=Xv(r,i);return cd(s)}function Xv(t,e){Ur(t),Ur(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return r.forEach(s=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[s]=qv(Mv({},i.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),i}function Qv(t="",e){Ur(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(s++,`(${s}) '${h}': '${l[h].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const n=i.join(" "),o=`${r}${n}`;return`${t?t+" ":""}${o}`}function ml(t){var e;const r=Yi(t);Ur(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function bl(t){const e=Yi(t);Ur(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function js(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return Zv(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function ld(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function qo(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Zn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function We(t,...e){if(!ld(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function vl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function e2(t,e){We(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function yr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ui(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function t2(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const r2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function i2(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function zo(t){if(typeof t=="string")t=i2(t);else if(ld(t))t=Ko(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function s2(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function n2(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const o2=(t,e)=>{function r(i,...s){if(We(i),!r2)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?We(l):We(l,t.nonceLength)}const n=t.tagLength;n&&s[1]!==void 0&&We(s[1]);const o=e(i,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");We(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,We(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(We(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function El(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!c2(e))throw new Error("invalid output, must be aligned");return e}function _l(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function a2(t,e,r){qo(r);const i=new Uint8Array(16),s=t2(i);return _l(s,0,BigInt(e),r),_l(s,8,BigInt(t),r),i}function c2(t){return t.byteOffset%4===0}function Ko(t){return Uint8Array.from(t)}const ud=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),l2=ud("expand 16-byte k"),u2=ud("expand 32-byte k"),h2=yr(l2),f2=yr(u2);function ee(t,e){return t<<e|t>>>32-e}function Vo(t){return t.byteOffset%4===0}const Es=64,d2=16,hd=2**32-1,xl=new Uint32Array;function p2(t,e,r,i,s,n,o,a){const c=s.length,l=new Uint8Array(Es),u=yr(l),h=Vo(s)&&Vo(n),f=h?yr(s):xl,d=h?yr(n):xl;for(let p=0;p<c;o++){if(t(e,r,i,u,o,a),o>=hd)throw new Error("arx: counter overflow");const y=Math.min(Es,c-p);if(h&&y===Es){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let x=0,D;x<d2;x++)D=m+x,d[D]=f[D]^u[x];p+=Es;continue}for(let m=0,x;m<y;m++)x=p+m,n[x]=s[x]^l[m];p+=y}}function g2(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=s2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Zn(s),Zn(o),qo(n),qo(r),(a,c,l,u,h=0)=>{We(a),We(c),We(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),We(u),Zn(h),h<0||h>=hd)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const d=[];let p=a.length,y,m;if(p===32)d.push(y=Ko(a)),m=f2;else if(p===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),m=h2,d.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Vo(c)||d.push(c=Ko(c));const x=yr(y);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(m,x,yr(c.subarray(0,16)),x),c=c.subarray(16)}const D=16-s;if(D!==c.length)throw new Error(`arx: nonce must be ${D} or 16 bytes`);if(D!==12){const A=new Uint8Array(12);A.set(c,n?0:12-c.length),c=A,d.push(c)}const b=yr(c);return p2(t,m,x,b,l,u,h,o),ui(...d),u}}const Se=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class y2{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=zo(e),We(e,32);const r=Se(e,0),i=Se(e,2),s=Se(e,4),n=Se(e,6),o=Se(e,8),a=Se(e,10),c=Se(e,12),l=Se(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Se(e,16+2*u)}process(e,r,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],d=o[6],p=o[7],y=o[8],m=o[9],x=Se(e,r+0),D=Se(e,r+2),b=Se(e,r+4),A=Se(e,r+6),C=Se(e,r+8),T=Se(e,r+10),j=Se(e,r+12),U=Se(e,r+14);let O=n[0]+(x&8191),K=n[1]+((x>>>13|D<<3)&8191),V=n[2]+((D>>>10|b<<6)&8191),P=n[3]+((b>>>7|A<<9)&8191),S=n[4]+((A>>>4|C<<12)&8191),$=n[5]+(C>>>1&8191),g=n[6]+((C>>>14|T<<2)&8191),w=n[7]+((T>>>11|j<<5)&8191),E=n[8]+((j>>>8|U<<8)&8191),I=n[9]+(U>>>5|s),v=0,_=v+O*a+K*(5*m)+V*(5*y)+P*(5*p)+S*(5*d);v=_>>>13,_&=8191,_+=$*(5*f)+g*(5*h)+w*(5*u)+E*(5*l)+I*(5*c),v+=_>>>13,_&=8191;let R=v+O*c+K*a+V*(5*m)+P*(5*y)+S*(5*p);v=R>>>13,R&=8191,R+=$*(5*d)+g*(5*f)+w*(5*h)+E*(5*u)+I*(5*l),v+=R>>>13,R&=8191;let N=v+O*l+K*c+V*a+P*(5*m)+S*(5*y);v=N>>>13,N&=8191,N+=$*(5*p)+g*(5*d)+w*(5*f)+E*(5*h)+I*(5*u),v+=N>>>13,N&=8191;let z=v+O*u+K*l+V*c+P*a+S*(5*m);v=z>>>13,z&=8191,z+=$*(5*y)+g*(5*p)+w*(5*d)+E*(5*f)+I*(5*h),v+=z>>>13,z&=8191;let k=v+O*h+K*u+V*l+P*c+S*a;v=k>>>13,k&=8191,k+=$*(5*m)+g*(5*y)+w*(5*p)+E*(5*d)+I*(5*f),v+=k>>>13,k&=8191;let M=v+O*f+K*h+V*u+P*l+S*c;v=M>>>13,M&=8191,M+=$*a+g*(5*m)+w*(5*y)+E*(5*p)+I*(5*d),v+=M>>>13,M&=8191;let H=v+O*d+K*f+V*h+P*u+S*l;v=H>>>13,H&=8191,H+=$*c+g*a+w*(5*m)+E*(5*y)+I*(5*p),v+=H>>>13,H&=8191;let G=v+O*p+K*d+V*f+P*h+S*u;v=G>>>13,G&=8191,G+=$*l+g*c+w*a+E*(5*m)+I*(5*y),v+=G>>>13,G&=8191;let J=v+O*y+K*p+V*d+P*f+S*h;v=J>>>13,J&=8191,J+=$*u+g*l+w*c+E*a+I*(5*m),v+=J>>>13,J&=8191;let W=v+O*m+K*y+V*p+P*d+S*f;v=W>>>13,W&=8191,W+=$*h+g*u+w*l+E*c+I*a,v+=W>>>13,W&=8191,v=(v<<2)+v|0,v=v+_|0,_=v&8191,v=v>>>13,R+=v,n[0]=_,n[1]=R,n[2]=N,n[3]=z,n[4]=k,n[5]=M,n[6]=H,n[7]=G,n[8]=J,n[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;ui(i)}update(e){vl(this),e=zo(e),We(e);const{buffer:r,blockLen:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}r.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){ui(this.h,this.r,this.buffer,this.pad)}digestInto(e){vl(this),e2(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function w2(t){const e=(i,s)=>t(s).update(zo(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const m2=w2(t=>new y2(t));function b2(t,e,r,i,s,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],f=e[2],d=e[3],p=e[4],y=e[5],m=e[6],x=e[7],D=s,b=r[0],A=r[1],C=r[2],T=o,j=a,U=c,O=l,K=u,V=h,P=f,S=d,$=p,g=y,w=m,E=x,I=D,v=b,_=A,R=C;for(let z=0;z<n;z+=2)T=T+K|0,I=ee(I^T,16),$=$+I|0,K=ee(K^$,12),T=T+K|0,I=ee(I^T,8),$=$+I|0,K=ee(K^$,7),j=j+V|0,v=ee(v^j,16),g=g+v|0,V=ee(V^g,12),j=j+V|0,v=ee(v^j,8),g=g+v|0,V=ee(V^g,7),U=U+P|0,_=ee(_^U,16),w=w+_|0,P=ee(P^w,12),U=U+P|0,_=ee(_^U,8),w=w+_|0,P=ee(P^w,7),O=O+S|0,R=ee(R^O,16),E=E+R|0,S=ee(S^E,12),O=O+S|0,R=ee(R^O,8),E=E+R|0,S=ee(S^E,7),T=T+V|0,R=ee(R^T,16),w=w+R|0,V=ee(V^w,12),T=T+V|0,R=ee(R^T,8),w=w+R|0,V=ee(V^w,7),j=j+P|0,I=ee(I^j,16),E=E+I|0,P=ee(P^E,12),j=j+P|0,I=ee(I^j,8),E=E+I|0,P=ee(P^E,7),U=U+S|0,v=ee(v^U,16),$=$+v|0,S=ee(S^$,12),U=U+S|0,v=ee(v^U,8),$=$+v|0,S=ee(S^$,7),O=O+K|0,_=ee(_^O,16),g=g+_|0,K=ee(K^g,12),O=O+K|0,_=ee(_^O,8),g=g+_|0,K=ee(K^g,7);let N=0;i[N++]=o+T|0,i[N++]=a+j|0,i[N++]=c+U|0,i[N++]=l+O|0,i[N++]=u+K|0,i[N++]=h+V|0,i[N++]=f+P|0,i[N++]=d+S|0,i[N++]=p+$|0,i[N++]=y+g|0,i[N++]=m+w|0,i[N++]=x+E|0,i[N++]=D+I|0,i[N++]=b+v|0,i[N++]=A+_|0,i[N++]=C+R|0}const v2=g2(b2,{counterRight:!1,counterLength:4,allowShortKeys:!1}),E2=new Uint8Array(16),Il=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(E2.subarray(r))},_2=new Uint8Array(32);function Sl(t,e,r,i,s){const n=t(e,r,_2),o=m2.create(n);s&&Il(o,s),Il(o,i);const a=a2(i.length,s?s.length:0,!0);o.update(a);const c=o.digest();return ui(n,a),c}const x2=t=>(e,r,i)=>({encrypt(s,n){const o=s.length;n=El(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);t(e,r,a,a,1);const c=Sl(t,e,r,a,i);return n.set(c,o),ui(c),n},decrypt(s,n){n=El(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Sl(t,e,r,o,i);if(!n2(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),t(e,r,n,n,1),ui(c),n}}),fd=o2({blockSize:64,nonceLength:12,tagLength:16},x2(v2));let dd=class extends wn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,yn(e);const i=vt(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),pt(n)}update(e){return wr(this),this.iHash.update(e),this}digestInto(e){wr(this),Et(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const bn=(t,e,r)=>new dd(t,e).update(r).digest();bn.create=(t,e)=>new dd(t,e);function I2(t,e,r){return yn(t),r===void 0&&(r=new Uint8Array(t.outputLen)),bn(t,vt(r),vt(e))}const Jn=Uint8Array.from([0]),$l=Uint8Array.of();function S2(t,e,r,i=32){yn(t),Jt(i);const s=t.outputLen;if(i>255*s)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(i/s);r===void 0&&(r=$l);const o=new Uint8Array(n*s),a=bn.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<n;u++)Jn[0]=u+1,c.update(u===0?$l:l).update(r).update(Jn).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),pt(l,Jn),o.slice(0,i)}const $2=(t,e,r,i,s)=>S2(t,I2(t,e,r),i,s),vn=mn,Ka=BigInt(0),Ho=BigInt(1);function Xs(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Pr(t,e,r=""){const i=gn(t),s=t==null?void 0:t.length,n=e!==void 0;if(!i||n&&s!==e){const o=r&&`"${r}" `,a=n?` of length ${e}`:"",c=i?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function _s(t){const e=t.toString(16);return e.length&1?"0"+e:e}function pd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ka:BigInt("0x"+t)}function En(t){return pd(oi(t))}function Qs(t){return Et(t),pd(oi(Uint8Array.from(t).reverse()))}function Va(t,e){return Zs(t.toString(16).padStart(e*2,"0"))}function Ha(t,e){return Va(t,e).reverse()}function ke(t,e,r){let i;if(typeof e=="string")try{i=Zs(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(gn(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}const Xn=t=>typeof t=="bigint"&&Ka<=t;function D2(t,e,r){return Xn(t)&&Xn(e)&&Xn(r)&&e<=t&&t<r}function Wo(t,e,r,i){if(!D2(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function gd(t){let e;for(e=0;t>Ka;t>>=Ho,e+=1);return e}const os=t=>(Ho<<BigInt(t))-Ho;function O2(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const i=f=>new Uint8Array(f),s=f=>Uint8Array.of(f);let n=i(t),o=i(t),a=0;const c=()=>{n.fill(1),o.fill(0),a=0},l=(...f)=>r(o,n,...f),u=(f=i(0))=>{o=l(s(0),f),n=l(),f.length!==0&&(o=l(s(1),f),n=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const d=[];for(;f<e;){n=l();const p=n.slice();d.push(p),f+=n.length}return dr(...d)};return(f,d)=>{c(),u(f);let p;for(;!(p=d(h()));)u();return c(),p}}function _n(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(s,n,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==n||a===null)throw new Error(`param "${s}" is invalid: expected ${n}, got ${c}`)}Object.entries(e).forEach(([s,n])=>i(s,n,!1)),Object.entries(r).forEach(([s,n])=>i(s,n,!0))}function Dl(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const Ye=BigInt(0),Le=BigInt(1),Cr=BigInt(2),yd=BigInt(3),wd=BigInt(4),md=BigInt(5),A2=BigInt(7),bd=BigInt(8),P2=BigInt(9),vd=BigInt(16);function it(t,e){const r=t%e;return r>=Ye?r:e+r}function wt(t,e,r){let i=t;for(;e-- >Ye;)i*=i,i%=r;return i}function Ol(t,e){if(t===Ye)throw new Error("invert: expected non-zero number");if(e<=Ye)throw new Error("invert: expected positive modulus, got "+e);let r=it(t,e),i=e,s=Ye,n=Le;for(;r!==Ye;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==Le)throw new Error("invert: does not exist");return it(s,e)}function Wa(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Ed(t,e){const r=(t.ORDER+Le)/wd,i=t.pow(e,r);return Wa(t,i,e),i}function C2(t,e){const r=(t.ORDER-md)/bd,i=t.mul(e,Cr),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,Cr),s),a=t.mul(n,t.sub(o,t.ONE));return Wa(t,a,e),a}function T2(t){const e=br(t),r=_d(t),i=r(e,e.neg(e.ONE)),s=r(e,i),n=r(e,e.neg(i)),o=(t+A2)/vd;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,i);const h=a.mul(l,s),f=a.mul(l,n),d=a.eql(a.sqr(u),c),p=a.eql(a.sqr(h),c);l=a.cmov(l,u,d),u=a.cmov(f,h,p);const y=a.eql(a.sqr(u),c),m=a.cmov(l,u,y);return Wa(a,m,c),m}}function _d(t){if(t<yd)throw new Error("sqrt is not defined for small field");let e=t-Le,r=0;for(;e%Cr===Ye;)e/=Cr,r++;let i=Cr;const s=br(t);for(;Al(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Ed;let n=s.pow(i,e);const o=(e+Le)/Cr;return function(a,c){if(a.is0(c))return c;if(Al(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,n),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,p=a.sqr(h);for(;!a.eql(p,a.ONE);)if(d++,p=a.sqr(p),d===l)throw new Error("Cannot find square root");const y=Le<<BigInt(l-d-1),m=a.pow(u,y);l=d,u=a.sqr(m),h=a.mul(h,u),f=a.mul(f,m)}return f}}function R2(t){return t%wd===yd?Ed:t%bd===md?C2:t%vd===P2?T2(t):_d(t)}const B2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function N2(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=B2.reduce((i,s)=>(i[s]="function",i),e);return _n(t,r),t}function U2(t,e,r){if(r<Ye)throw new Error("invalid exponent, negatives unsupported");if(r===Ye)return t.ONE;if(r===Le)return e;let i=t.ONE,s=e;for(;r>Ye;)r&Le&&(i=t.mul(i,s)),s=t.sqr(s),r>>=Le;return i}function xd(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function Al(t,e){const r=(t.ORDER-Le)/Cr,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function Id(t,e){e!==void 0&&Jt(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function br(t,e,r=!1,i={}){if(t<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,n,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(s=f.BITS),f.sqrt&&(n=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(s=e),i.sqrt&&(n=i.sqrt);const{nBitLength:c,nByteLength:l}=Id(t,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:os(c),ZERO:Ye,ONE:Le,allowedLengths:a,create:f=>it(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ye<=f&&f<t},is0:f=>f===Ye,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Le)===Le,neg:f=>it(-f,t),eql:(f,d)=>f===d,sqr:f=>it(f*f,t),add:(f,d)=>it(f+d,t),sub:(f,d)=>it(f-d,t),mul:(f,d)=>it(f*d,t),pow:(f,d)=>U2(h,f,d),div:(f,d)=>it(f*Ol(d,t),t),sqrN:f=>f*f,addN:(f,d)=>f+d,subN:(f,d)=>f-d,mulN:(f,d)=>f*d,inv:f=>Ol(f,t),sqrt:n||(f=>(u||(u=R2(t)),u(h,f))),toBytes:f=>r?Ha(f,l):Va(f,l),fromBytes:(f,d=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const y=new Uint8Array(l);y.set(f,r?0:y.length-f.length),f=y}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let p=r?Qs(f):En(f);if(o&&(p=it(p,t)),!d&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>xd(h,f),cmov:(f,d,p)=>p?d:f});return Object.freeze(h)}function Sd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function $d(t){const e=Sd(t);return e+Math.ceil(e/2)}function j2(t,e,r=!1){const i=t.length,s=Sd(e),n=$d(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?Qs(t):En(t),a=it(o,e-Le)+Le;return r?Ha(a,s):Va(a,s)}const hi=BigInt(0),Tr=BigInt(1);function en(t,e){const r=e.negate();return t?r:e}function Qn(t,e){const r=xd(t.Fp,e.map(i=>i.Z));return e.map((i,s)=>t.fromAffine(i.toAffine(r[s])))}function Dd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function eo(t,e){Dd(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=os(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function Pl(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=Tr);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:d,offsetF:l}}function F2(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function k2(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const to=new WeakMap,Od=new WeakMap;function ro(t){return Od.get(t)||1}function Cl(t){if(t!==hi)throw new Error("invalid wNAF")}class L2{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,i=this.ZERO){let s=e;for(;r>hi;)r&Tr&&(i=i.add(s)),s=s.double(),r>>=Tr;return i}precomputeWindow(e,r){const{windows:i,windowSize:s}=eo(r,this.bits),n=[];let o=e,a=o;for(let c=0;c<i;c++){a=o,n.push(a);for(let l=1;l<s;l++)a=a.add(o),n.push(a);o=a.double()}return n}wNAF(e,r,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let s=this.ZERO,n=this.BASE;const o=eo(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:d}=Pl(i,a,o);i=c,u?n=n.add(en(f,r[d])):s=s.add(en(h,r[l]))}return Cl(i),{p:s,f:n}}wNAFUnsafe(e,r,i,s=this.ZERO){const n=eo(e,this.bits);for(let o=0;o<n.windows&&i!==hi;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=Pl(i,o,n);if(i=a,!l){const h=r[c];s=s.add(u?h.negate():h)}}return Cl(i),s}getPrecomputes(e,r,i){let s=to.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof i=="function"&&(s=i(s)),to.set(r,s))),s}cached(e,r,i){const s=ro(e);return this.wNAF(s,this.getPrecomputes(s,e,i),r)}unsafe(e,r,i,s){const n=ro(e);return n===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(n,this.getPrecomputes(n,e,i),r,s)}createCache(e,r){Dd(r,this.bits),Od.set(e,r),to.delete(e)}hasCache(e){return ro(e)!==1}}function M2(t,e,r,i){let s=e,n=t.ZERO,o=t.ZERO;for(;r>hi||i>hi;)r&Tr&&(n=n.add(s)),i&Tr&&(o=o.add(s)),s=s.double(),r>>=Tr,i>>=Tr;return{p1:n,p2:o}}function q2(t,e,r,i){F2(r,t),k2(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=gd(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=os(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let d=h;d>=0;d-=c){u.fill(o);for(let y=0;y<n;y++){const m=i[y],x=Number(m>>BigInt(d)&l);u[x]=u[x].add(r[y])}let p=o;for(let y=u.length-1,m=o;y>0;y--)m=m.add(u[y]),p=p.add(m);if(f=f.add(p),d!==0)for(let y=0;y<c;y++)f=f.double()}return f}function Tl(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return N2(e),e}else return br(t,{isLE:r})}function z2(t,e,r={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>hi))throw new Error(`CURVE.${a} must be positive bigint`)}const s=Tl(e.p,r.Fp,i),n=Tl(e.n,r.Fn,i),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:n}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Xf("HashToScalar-");const Di=BigInt(0),Wr=BigInt(1),xs=BigInt(2);function K2(t){return _n(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function V2(t){const e=K2(t),{P:r,type:i,adjustScalarBytes:s,powPminus2:n,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||kr,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),d=a?xs**BigInt(254):xs**BigInt(447),p=a?BigInt(8)*xs**BigInt(251)-Wr:BigInt(4)*xs**BigInt(445)-Wr,y=d+p+Wr,m=P=>it(P,r),x=D(h);function D(P){return Ha(m(P),u)}function b(P){const S=ke("u coordinate",P,u);return a&&(S[31]&=127),m(Qs(S))}function A(P){return Qs(s(ke("scalar",P,u)))}function C(P,S){const $=U(b(S),A(P));if($===Di)throw new Error("invalid private or public key received");return D($)}function T(P){return C(P,x)}function j(P,S,$){const g=m(P*(S-$));return S=m(S-g),$=m($+g),{x_2:S,x_3:$}}function U(P,S){Wo("u",P,Di,r),Wo("scalar",S,d,y);const $=S,g=P;let w=Wr,E=Di,I=P,v=Wr,_=Di;for(let N=BigInt(l-1);N>=Di;N--){const z=$>>N&Wr;_^=z,{x_2:w,x_3:I}=j(_,w,I),{x_2:E,x_3:v}=j(_,E,v),_=z;const k=w+E,M=m(k*k),H=w-E,G=m(H*H),J=M-G,W=I+v,ie=I-v,we=m(ie*k),Xe=m(W*H),_t=we+Xe,jt=we-Xe;I=m(_t*_t),v=m(g*m(jt*jt)),w=m(M*G),E=m(J*(M+m(f*J)))}({x_2:w,x_3:I}=j(_,w,I)),{x_2:E,x_3:v}=j(_,E,v);const R=n(E);return m(w*R)}const O={secretKey:u,publicKey:u,seed:u},K=(P=c(u))=>(Et(P,O.seed),P);function V(P){const S=K(P);return{secretKey:S,publicKey:T(S)}}return{keygen:V,getSharedSecret:(P,S)=>C(P,S),getPublicKey:P=>T(P),scalarMult:C,scalarMultBase:T,utils:{randomSecretKey:K,randomPrivateKey:K},GuBytes:x.slice(),lengths:O}}const H2=BigInt(1),Rl=BigInt(2),W2=BigInt(3),G2=BigInt(5);BigInt(8);const Ad=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Y2={p:Ad,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Z2(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=Ad,o=t*t%n*t%n,a=wt(o,Rl,n)*o%n,c=wt(a,H2,n)*t%n,l=wt(c,G2,n)*c%n,u=wt(l,e,n)*l%n,h=wt(u,r,n)*u%n,f=wt(h,i,n)*h%n,d=wt(f,s,n)*f%n,p=wt(d,s,n)*f%n,y=wt(p,e,n)*l%n;return{pow_p_5_8:wt(y,Rl,n)*t%n,b2:o}}function J2(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const X2=br(Y2.p,{isLE:!0}),Go=(()=>{const t=X2.ORDER;return V2({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:i}=Z2(e);return it(wt(r,W2,t)*i,t)},adjustScalarBytes:J2})})(),Bl=(t,e)=>(t+(t>=0?e:-e)/Pd)/e;function Q2(t,e,r){const[[i,s],[n,o]]=e,a=Bl(o*t,r),c=Bl(-s*t,r);let l=t-a*i-c*n,u=-a*s-c*o;const h=l<Wt,f=u<Wt;h&&(l=-l),f&&(u=-u);const d=os(Math.ceil(gd(r)/2))+ai;if(l<Wt||l>=d||u<Wt||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}function Yo(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function io(t,e){const r={};for(let i of Object.keys(e))r[i]=t[i]===void 0?e[i]:t[i];return Xs(r.lowS,"lowS"),Xs(r.prehash,"prehash"),r.format!==void 0&&Yo(r.format),r}class eE extends Error{constructor(e=""){super(e)}}const Ht={Err:eE,_tlv:{encode:(t,e)=>{const{Err:r}=Ht;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=_s(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?_s(s.length/2|128):"";return _s(t)+n+s+e},decode(t,e){const{Err:r}=Ht;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Ht;if(t<Wt)throw new e("integer: negative integers are not allowed");let r=_s(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Ht;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return En(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Ht,s=ke("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Ht,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}},Wt=BigInt(0),ai=BigInt(1),Pd=BigInt(2),Is=BigInt(3),tE=BigInt(4);function ti(t,e){const{BYTES:r}=t;let i;if(typeof e=="bigint")i=e;else{let s=ke("private key",e);try{i=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function rE(t,e={}){const r=z2("weierstrass",t,e),{Fp:i,Fn:s}=r;let n=r.CURVE;const{h:o,n:a}=n;_n(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!i.is0(n.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=Td(i,s);function u(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(P,S,$){const{x:g,y:w}=S.toAffine(),E=i.toBytes(g);if(Xs($,"isCompressed"),$){u();const I=!i.isOdd(w);return dr(Cd(I),E)}else return dr(Uint8Array.of(4),E,i.toBytes(w))}function f(P){Pr(P,void 0,"Point");const{publicKey:S,publicKeyUncompressed:$}=l,g=P.length,w=P[0],E=P.subarray(1);if(g===S&&(w===2||w===3)){const I=i.fromBytes(E);if(!i.isValid(I))throw new Error("bad point: is not on curve, wrong x");const v=y(I);let _;try{_=i.sqrt(v)}catch(N){const z=N instanceof Error?": "+N.message:"";throw new Error("bad point: is not on curve, sqrt error"+z)}u();const R=i.isOdd(_);return(w&1)===1!==R&&(_=i.neg(_)),{x:I,y:_}}else if(g===$&&w===4){const I=i.BYTES,v=i.fromBytes(E.subarray(0,I)),_=i.fromBytes(E.subarray(I,I*2));if(!m(v,_))throw new Error("bad point: is not on curve");return{x:v,y:_}}else throw new Error(`bad point: got length ${g}, expected compressed=${S} or uncompressed=${$}`)}const d=e.toBytes||h,p=e.fromBytes||f;function y(P){const S=i.sqr(P),$=i.mul(S,P);return i.add(i.add($,i.mul(P,n.a)),n.b)}function m(P,S){const $=i.sqr(S),g=y(P);return i.eql($,g)}if(!m(n.Gx,n.Gy))throw new Error("bad curve params: generator point");const x=i.mul(i.pow(n.a,Is),tE),D=i.mul(i.sqr(n.b),BigInt(27));if(i.is0(i.add(x,D)))throw new Error("bad curve params: a or b");function b(P,S,$=!1){if(!i.isValid(S)||$&&i.is0(S))throw new Error(`bad point coordinate ${P}`);return S}function A(P){if(!(P instanceof O))throw new Error("ProjectivePoint expected")}function C(P){if(!c||!c.basises)throw new Error("no endo");return Q2(P,c.basises,s.ORDER)}const T=Dl((P,S)=>{const{X:$,Y:g,Z:w}=P;if(i.eql(w,i.ONE))return{x:$,y:g};const E=P.is0();S==null&&(S=E?i.ONE:i.inv(w));const I=i.mul($,S),v=i.mul(g,S),_=i.mul(w,S);if(E)return{x:i.ZERO,y:i.ZERO};if(!i.eql(_,i.ONE))throw new Error("invZ was invalid");return{x:I,y:v}}),j=Dl(P=>{if(P.is0()){if(e.allowInfinityPoint&&!i.is0(P.Y))return;throw new Error("bad point: ZERO")}const{x:S,y:$}=P.toAffine();if(!i.isValid(S)||!i.isValid($))throw new Error("bad point: x or y not field elements");if(!m(S,$))throw new Error("bad point: equation left != right");if(!P.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(P,S,$,g,w){return $=new O(i.mul($.X,P),$.Y,$.Z),S=en(g,S),$=en(w,$),S.add($)}class O{constructor(S,$,g){this.X=b("x",S),this.Y=b("y",$,!0),this.Z=b("z",g),Object.freeze(this)}static CURVE(){return n}static fromAffine(S){const{x:$,y:g}=S||{};if(!S||!i.isValid($)||!i.isValid(g))throw new Error("invalid affine point");if(S instanceof O)throw new Error("projective point not allowed");return i.is0($)&&i.is0(g)?O.ZERO:new O($,g,i.ONE)}static fromBytes(S){const $=O.fromAffine(p(Pr(S,void 0,"point")));return $.assertValidity(),$}static fromHex(S){return O.fromBytes(ke("pointHex",S))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(S=8,$=!0){return V.createCache(this,S),$||this.multiply(Is),this}assertValidity(){j(this)}hasEvenY(){const{y:S}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(S)}equals(S){A(S);const{X:$,Y:g,Z:w}=this,{X:E,Y:I,Z:v}=S,_=i.eql(i.mul($,v),i.mul(E,w)),R=i.eql(i.mul(g,v),i.mul(I,w));return _&&R}negate(){return new O(this.X,i.neg(this.Y),this.Z)}double(){const{a:S,b:$}=n,g=i.mul($,Is),{X:w,Y:E,Z:I}=this;let v=i.ZERO,_=i.ZERO,R=i.ZERO,N=i.mul(w,w),z=i.mul(E,E),k=i.mul(I,I),M=i.mul(w,E);return M=i.add(M,M),R=i.mul(w,I),R=i.add(R,R),v=i.mul(S,R),_=i.mul(g,k),_=i.add(v,_),v=i.sub(z,_),_=i.add(z,_),_=i.mul(v,_),v=i.mul(M,v),R=i.mul(g,R),k=i.mul(S,k),M=i.sub(N,k),M=i.mul(S,M),M=i.add(M,R),R=i.add(N,N),N=i.add(R,N),N=i.add(N,k),N=i.mul(N,M),_=i.add(_,N),k=i.mul(E,I),k=i.add(k,k),N=i.mul(k,M),v=i.sub(v,N),R=i.mul(k,z),R=i.add(R,R),R=i.add(R,R),new O(v,_,R)}add(S){A(S);const{X:$,Y:g,Z:w}=this,{X:E,Y:I,Z:v}=S;let _=i.ZERO,R=i.ZERO,N=i.ZERO;const z=n.a,k=i.mul(n.b,Is);let M=i.mul($,E),H=i.mul(g,I),G=i.mul(w,v),J=i.add($,g),W=i.add(E,I);J=i.mul(J,W),W=i.add(M,H),J=i.sub(J,W),W=i.add($,w);let ie=i.add(E,v);return W=i.mul(W,ie),ie=i.add(M,G),W=i.sub(W,ie),ie=i.add(g,w),_=i.add(I,v),ie=i.mul(ie,_),_=i.add(H,G),ie=i.sub(ie,_),N=i.mul(z,W),_=i.mul(k,G),N=i.add(_,N),_=i.sub(H,N),N=i.add(H,N),R=i.mul(_,N),H=i.add(M,M),H=i.add(H,M),G=i.mul(z,G),W=i.mul(k,W),H=i.add(H,G),G=i.sub(M,G),G=i.mul(z,G),W=i.add(W,G),M=i.mul(H,W),R=i.add(R,M),M=i.mul(ie,W),_=i.mul(J,_),_=i.sub(_,M),M=i.mul(J,H),N=i.mul(ie,N),N=i.add(N,M),new O(_,R,N)}subtract(S){return this.add(S.negate())}is0(){return this.equals(O.ZERO)}multiply(S){const{endo:$}=e;if(!s.isValidNot0(S))throw new Error("invalid scalar: out of range");let g,w;const E=I=>V.cached(this,I,v=>Qn(O,v));if($){const{k1neg:I,k1:v,k2neg:_,k2:R}=C(S),{p:N,f:z}=E(v),{p:k,f:M}=E(R);w=z.add(M),g=U($.beta,N,k,I,_)}else{const{p:I,f:v}=E(S);g=I,w=v}return Qn(O,[g,w])[0]}multiplyUnsafe(S){const{endo:$}=e,g=this;if(!s.isValid(S))throw new Error("invalid scalar: out of range");if(S===Wt||g.is0())return O.ZERO;if(S===ai)return g;if(V.hasCache(this))return this.multiply(S);if($){const{k1neg:w,k1:E,k2neg:I,k2:v}=C(S),{p1:_,p2:R}=M2(O,g,E,v);return U($.beta,_,R,w,I)}else return V.unsafe(g,S)}multiplyAndAddUnsafe(S,$,g){const w=this.multiplyUnsafe($).add(S.multiplyUnsafe(g));return w.is0()?void 0:w}toAffine(S){return T(this,S)}isTorsionFree(){const{isTorsionFree:S}=e;return o===ai?!0:S?S(O,this):V.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:S}=e;return o===ai?this:S?S(O,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(S=!0){return Xs(S,"isCompressed"),this.assertValidity(),d(O,this,S)}toHex(S=!0){return oi(this.toBytes(S))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(S=!0){return this.toBytes(S)}_setWindowSize(S){this.precompute(S)}static normalizeZ(S){return Qn(O,S)}static msm(S,$){return q2(O,s,S,$)}static fromPrivateKey(S){return O.BASE.multiply(ti(s,S))}}O.BASE=new O(n.Gx,n.Gy,i.ONE),O.ZERO=new O(i.ZERO,i.ONE,i.ZERO),O.Fp=i,O.Fn=s;const K=s.BITS,V=new L2(O,e.endo?Math.ceil(K/2):K);return O.BASE.precompute(8),O}function Cd(t){return Uint8Array.of(t?2:3)}function Td(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function iE(t,e={}){const{Fn:r}=t,i=e.randomBytes||kr,s=Object.assign(Td(t.Fp,r),{seed:$d(r.ORDER)});function n(f){try{return!!ti(r,f)}catch{return!1}}function o(f,d){const{publicKey:p,publicKeyUncompressed:y}=s;try{const m=f.length;return d===!0&&m!==p||d===!1&&m!==y?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=i(s.seed)){return j2(Pr(f,s.seed,"seed"),r.ORDER)}function c(f,d=!0){return t.BASE.multiply(ti(r,f)).toBytes(d)}function l(f){const d=a(f);return{secretKey:d,publicKey:c(d)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:d,publicKey:p,publicKeyUncompressed:y}=s;if(r.allowedLengths||d===p)return;const m=ke("key",f).length;return m===p||m===y}function h(f,d,p=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");const y=ti(r,f);return t.fromHex(d).multiply(y).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:n,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:n,randomPrivateKey:a,normPrivateKeyToScalar:f=>ti(r,f),precompute(f=8,d=t.BASE){return d.precompute(f,!1)}},lengths:s})}function sE(t,e,r={}){yn(e),_n(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=r.randomBytes||kr,s=r.hmac||(($,...g)=>bn(e,$,dr(...g))),{Fp:n,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:d}=iE(t,r),p={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},y="compact";function m($){const g=a>>ai;return $>g}function x($,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${$}: out of range 1..Point.Fn.ORDER`);return g}function D($,g){Yo(g);const w=d.signature,E=g==="compact"?w:g==="recovered"?w+1:void 0;return Pr($,E,`${g} signature`)}class b{constructor(g,w,E){this.r=x("r",g),this.s=x("s",w),E!=null&&(this.recovery=E),Object.freeze(this)}static fromBytes(g,w=y){D(g,w);let E;if(w==="der"){const{r:R,s:N}=Ht.toSig(Pr(g));return new b(R,N)}w==="recovered"&&(E=g[0],w="compact",g=g.subarray(1));const I=o.BYTES,v=g.subarray(0,I),_=g.subarray(I,I*2);return new b(o.fromBytes(v),o.fromBytes(_),E)}static fromHex(g,w){return this.fromBytes(Zs(g),w)}addRecoveryBit(g){return new b(this.r,this.s,g)}recoverPublicKey(g){const w=n.ORDER,{r:E,s:I,recovery:v}=this;if(v==null||![0,1,2,3].includes(v))throw new Error("recovery id invalid");if(a*Pd<w&&v>1)throw new Error("recovery id is ambiguous for h>1 curve");const _=v===2||v===3?E+a:E;if(!n.isValid(_))throw new Error("recovery id 2 or 3 invalid");const R=n.toBytes(_),N=t.fromBytes(dr(Cd((v&1)===0),R)),z=o.inv(_),k=C(ke("msgHash",g)),M=o.create(-k*z),H=o.create(I*z),G=t.BASE.multiplyUnsafe(M).add(N.multiplyUnsafe(H));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return m(this.s)}toBytes(g=y){if(Yo(g),g==="der")return Zs(Ht.hexFromSig(this));const w=o.toBytes(this.r),E=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return dr(Uint8Array.of(this.recovery),w,E)}return dr(w,E)}toHex(g){return oi(this.toBytes(g))}assertValidity(){}static fromCompact(g){return b.fromBytes(ke("sig",g),"compact")}static fromDER(g){return b.fromBytes(ke("sig",g),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return oi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return oi(this.toBytes("compact"))}}const A=r.bits2int||function($){if($.length>8192)throw new Error("input is too large");const g=En($),w=$.length*8-c;return w>0?g>>BigInt(w):g},C=r.bits2int_modN||function($){return o.create(A($))},T=os(c);function j($){return Wo("num < 2^"+c,$,Wt,T),o.toBytes($)}function U($,g){return Pr($,void 0,"message"),g?Pr(e($),void 0,"prehashed message"):$}function O($,g,w){if(["recovered","canonical"].some(H=>H in w))throw new Error("sign() legacy options not supported");const{lowS:E,prehash:I,extraEntropy:v}=io(w,p);$=U($,I);const _=C($),R=ti(o,g),N=[j(R),j(_)];if(v!=null&&v!==!1){const H=v===!0?i(d.secretKey):v;N.push(ke("extraEntropy",H))}const z=dr(...N),k=_;function M(H){const G=A(H);if(!o.isValidNot0(G))return;const J=o.inv(G),W=t.BASE.multiply(G).toAffine(),ie=o.create(W.x);if(ie===Wt)return;const we=o.create(J*o.create(k+ie*R));if(we===Wt)return;let Xe=(W.x===ie?0:2)|Number(W.y&ai),_t=we;return E&&m(we)&&(_t=o.neg(we),Xe^=1),new b(ie,_t,Xe)}return{seed:z,k2sig:M}}function K($,g,w={}){$=ke("message",$);const{seed:E,k2sig:I}=O($,g,w);return O2(e.outputLen,o.BYTES,s)(E,I)}function V($){let g;const w=typeof $=="string"||gn($),E=!w&&$!==null&&typeof $=="object"&&typeof $.r=="bigint"&&typeof $.s=="bigint";if(!w&&!E)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(E)g=new b($.r,$.s);else if(w){try{g=b.fromBytes(ke("sig",$),"der")}catch(I){if(!(I instanceof Ht.Err))throw I}if(!g)try{g=b.fromBytes(ke("sig",$),"compact")}catch{return!1}}return g||!1}function P($,g,w,E={}){const{lowS:I,prehash:v,format:_}=io(E,p);if(w=ke("publicKey",w),g=U(ke("message",g),v),"strict"in E)throw new Error("options.strict was renamed to lowS");const R=_===void 0?V($):b.fromBytes(ke("sig",$),_);if(R===!1)return!1;try{const N=t.fromBytes(w);if(I&&R.hasHighS())return!1;const{r:z,s:k}=R,M=C(g),H=o.inv(k),G=o.create(M*H),J=o.create(z*H),W=t.BASE.multiplyUnsafe(G).add(N.multiplyUnsafe(J));return W.is0()?!1:o.create(W.x)===z}catch{return!1}}function S($,g,w={}){const{prehash:E}=io(w,p);return g=U(g,E),b.fromBytes($,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:d,Point:t,sign:K,verify:P,recoverPublicKey:S,Signature:b,hash:e})}function nE(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=br(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),n={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:n}}function oE(t){const{CURVE:e,curveOpts:r}=nE(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:i}}function aE(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,Id(r.Fn.ORDER,r.Fn.BITS))})}function cE(t){const{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:s}=oE(t),n=rE(e,r),o=sE(n,i,s);return aE(t,o)}function Zo(t,e){const r=i=>cE({...t,hash:i});return{...r(e),create:r}}const Rd={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Bd={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Nd={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},lE=br(Rd.p),uE=br(Bd.p),hE=br(Nd.p),fE=Zo({...Rd,Fp:lE,lowS:!1},mn);Zo({...Bd,Fp:uE,lowS:!1},bv),Zo({...Nd,Fp:hE,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},mv);const dE=fE,Ud="base10",Me="base16",Ge="base64pad",pr="base64url",as="utf8",jd=0,Yt=1,cs=2,pE=0,Nl=1,qi=12,Ga=32;function gE(){const t=Go.utils.randomPrivateKey(),e=Go.getPublicKey(t);return{privateKey:Ze(t,Me),publicKey:Ze(e,Me)}}function Jo(){const t=kr(Ga);return Ze(t,Me)}function yE(t,e){const r=Go.getSharedSecret(ft(t,Me),ft(e,Me)),i=$2(vn,r,void 0,void 0,Ga);return Ze(i,Me)}function Fs(t){const e=vn(ft(t,Me));return Ze(e,Me)}function ut(t){const e=vn(ft(t,as));return Ze(e,Me)}function Fd(t){return ft(`${t}`,Ud)}function jr(t){return Number(Ze(t,Ud))}function kd(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Ld(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function wE(t){const e=Fd(typeof t.type<"u"?t.type:jd);if(jr(e)===Yt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ft(t.senderPublicKey,Me):void 0,i=typeof t.iv<"u"?ft(t.iv,Me):kr(qi),s=ft(t.symKey,Me),n=fd(s,i).encrypt(ft(t.message,as)),o=Md({type:e,sealed:n,iv:i,senderPublicKey:r});return t.encoding===pr?kd(o):o}function mE(t){const e=ft(t.symKey,Me),{sealed:r,iv:i}=Zi({encoded:t.encoded,encoding:t.encoding}),s=fd(e,i).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Ze(s,as)}function bE(t,e){const r=Fd(cs),i=kr(qi),s=ft(t,as),n=Md({type:r,sealed:s,iv:i});return e===pr?kd(n):n}function vE(t,e){const{sealed:r}=Zi({encoded:t,encoding:e});return Ze(r,as)}function Md(t){if(jr(t.type)===cs)return Ze(Mi([t.type,t.sealed]),Ge);if(jr(t.type)===Yt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ze(Mi([t.type,t.senderPublicKey,t.iv,t.sealed]),Ge)}return Ze(Mi([t.type,t.iv,t.sealed]),Ge)}function Zi(t){const e=(t.encoding||Ge)===pr?Ld(t.encoded):t.encoded,r=ft(e,Ge),i=r.slice(pE,Nl),s=Nl;if(jr(i)===Yt){const c=s+Ga,l=c+qi,u=r.slice(s,c),h=r.slice(c,l),f=r.slice(l);return{type:i,sealed:f,iv:h,senderPublicKey:u}}if(jr(i)===cs){const c=r.slice(s),l=kr(qi);return{type:i,sealed:c,iv:l}}const n=s+qi,o=r.slice(s,n),a=r.slice(n);return{type:i,sealed:a,iv:o}}function EE(t,e){const r=Zi({encoded:t,encoding:e==null?void 0:e.encoding});return qd({type:jr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Ze(r.senderPublicKey,Me):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function qd(t){const e=(t==null?void 0:t.type)||jd;if(e===Yt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Ul(t){return t.type===Yt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function jl(t){return t.type===cs}function _E(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Mi([new Uint8Array([4]),e,r])}function xE(t,e){const[r,i,s]=t.split("."),n=Buffer.from(Ld(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${r}.${i}`,l=vn(c),u=_E(e);if(!dE.verify(Mi([o,a]),l,u))throw new Error("Invalid signature");return jo(t).payload}const IE="irn";function tn(t){return(t==null?void 0:t.relay)||{protocol:IE}}function ri(t){const e=Xb[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var SE=Object.defineProperty,$E=Object.defineProperties,DE=Object.getOwnPropertyDescriptors,Fl=Object.getOwnPropertySymbols,OE=Object.prototype.hasOwnProperty,AE=Object.prototype.propertyIsEnumerable,kl=(t,e,r)=>e in t?SE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,so=(t,e)=>{for(var r in e||(e={}))OE.call(e,r)&&kl(t,r,e[r]);if(Fl)for(var r of Fl(e))AE.call(e,r)&&kl(t,r,e[r]);return t},PE=(t,e)=>$E(t,DE(e));function CE(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=t[s];r[n]=o}}),r}function Ll(t){if(!t.includes("wc:")){const l=Hf(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),n=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(n),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:TE(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:CE(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function TE(t){return t.startsWith("//")?t.substring(2):t}function RE(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const n=s,o=r+e+n;t[n]&&(i[o]=t[n])}),i}function Ml(t){const e=new URLSearchParams,r=so(so(PE(so({},RE(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!==void 0&&e.append(i,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Ss(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var BE=Object.defineProperty,NE=Object.defineProperties,UE=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,jE=Object.prototype.hasOwnProperty,FE=Object.prototype.propertyIsEnumerable,zl=(t,e,r)=>e in t?BE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kE=(t,e)=>{for(var r in e||(e={}))jE.call(e,r)&&zl(t,r,e[r]);if(ql)for(var r of ql(e))FE.call(e,r)&&zl(t,r,e[r]);return t},LE=(t,e)=>NE(t,UE(e));function wi(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function ME(t){const e=[];return Object.values(t).forEach(r=>{e.push(...wi(r.accounts))}),e}function qE(t,e){const r=[];return Object.values(t).forEach(i=>{wi(i.accounts).includes(e)&&r.push(...i.methods)}),r}function zE(t,e){const r=[];return Object.values(t).forEach(i=>{wi(i.accounts).includes(e)&&r.push(...i.events)}),r}function xn(t){return t.includes(":")}function ii(t){return xn(t)?t.split(":")[0]:t}function Kl(t){var e,r,i;const s={};if(!Bt(t))return s;for(const[n,o]of Object.entries(t)){const a=xn(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],u=ii(n);s[u]=LE(kE({},s[u]),{chains:Rt(a,(e=s[u])==null?void 0:e.chains),methods:Rt(c,(r=s[u])==null?void 0:r.methods),events:Rt(l,(i=s[u])==null?void 0:i.events)})}return s}function KE(t){const e={};return t==null||t.forEach(r=>{var i;const[s,n]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function Vl(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=KE(e);for(const[i,s]of Object.entries(r))s.methods?s.methods=Rt(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function VE(t,e){var r,i,s,n,o,a;const c=Kl(t),l=Kl(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:Rt((r=c[f])==null?void 0:r.chains,(i=l[f])==null?void 0:i.chains),methods:Rt((s=c[f])==null?void 0:s.methods,(n=l[f])==null?void 0:n.methods),events:Rt((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const HE={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},WE={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function L(t,e){const{message:r,code:i}=WE[t];return{message:e?`${r} ${e}`:r,code:i}}function he(t,e){const{message:r,code:i}=HE[t];return{message:e?`${r} ${e}`:r,code:i}}function dt(t,e){return!!Array.isArray(t)}function Bt(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function ve(t){return typeof t>"u"}function ye(t,e){return e&&ve(t)?!0:typeof t=="string"&&!!t.trim().length}function Ya(t,e){return e&&ve(t)?!0:typeof t=="number"&&!isNaN(t)}function GE(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let n=!0;return Ar(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=wi(a),h=r[o];(!Ar(Mf(o,h),u)||!Ar(h.methods,c)||!Ar(h.events,l))&&(n=!1)}),n):!1}function rn(t){return ye(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function YE(t){if(ye(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&rn(r)}}return!1}function ZE(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(ye(t,!1)){if(e(t))return!0;const r=Hf(t);return e(r)}}catch{}return!1}function JE(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function XE(t){return t==null?void 0:t.topic}function QE(t,e){let r=null;return ye(t==null?void 0:t.publicKey,!1)||(r=L("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Hl(t){let e=!0;return dt(t)?t.length&&(e=t.every(r=>ye(r,!1))):e=!1,e}function e_(t,e,r){let i=null;return dt(e)&&e.length?e.forEach(s=>{i||rn(s)||(i=he("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):rn(t)||(i=he("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function t_(t,e,r){let i=null;return Object.entries(t).forEach(([s,n])=>{if(i)return;const o=e_(s,Mf(s,n),`${e} ${r}`);o&&(i=o)}),i}function r_(t,e){let r=null;return dt(t)?t.forEach(i=>{r||YE(i)||(r=he("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=he("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function i_(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=r_(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function s_(t,e){let r=null;return Hl(t==null?void 0:t.methods)?Hl(t==null?void 0:t.events)||(r=he("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=he("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function zd(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=s_(i,`${e}, namespace`);s&&(r=s)}),r}function n_(t,e,r){let i=null;if(t&&Bt(t)){const s=zd(t,e);s&&(i=s);const n=t_(t,e,r);n&&(i=n)}else i=L("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function no(t,e){let r=null;if(t&&Bt(t)){const i=zd(t,e);i&&(r=i);const s=i_(t,e);s&&(r=s)}else r=L("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Kd(t){return ye(t.protocol,!0)}function o_(t,e){let r=!1;return t?t&&dt(t)&&t.length&&t.forEach(i=>{r=Kd(i)}):r=!0,r}function a_(t){return typeof t=="number"}function He(t){return typeof t<"u"&&typeof t!==null}function c_(t){return!(!t||typeof t!="object"||!t.code||!Ya(t.code,!1)||!t.message||!ye(t.message,!1))}function l_(t){return!(ve(t)||!ye(t.method,!1))}function u_(t){return!(ve(t)||ve(t.result)&&ve(t.error)||!Ya(t.id,!1)||!ye(t.jsonrpc,!1))}function h_(t){return!(ve(t)||!ye(t.name,!1))}function Wl(t,e){return!(!rn(e)||!ME(t).includes(e))}function f_(t,e,r){return ye(r,!1)?qE(t,e).includes(r):!1}function d_(t,e,r){return ye(r,!1)?zE(t,e).includes(r):!1}function Gl(t,e,r){let i=null;const s=p_(t),n=g_(e),o=Object.keys(s),a=Object.keys(n),c=Yl(Object.keys(t)),l=Yl(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Ar(o,a)||(i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const f=wi(e[h].accounts);f.includes(h)||(i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{i||(Ar(s[h].methods,n[h].methods)?Ar(s[h].events,n[h].events)||(i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function p_(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function Yl(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function g_(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=wi(t[r].accounts);i==null||i.forEach(s=>{e[s]={accounts:t[r].accounts.filter(n=>n.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function y_(t,e){return Ya(t,!1)&&t<=e.max&&t>=e.min}function Zl(){const t=ss();return new Promise(e=>{switch(t){case st.browser:e(w_());break;case st.reactNative:e(m_());break;case st.node:e(b_());break;default:e(!0)}})}function w_(){return yi()&&(navigator==null?void 0:navigator.onLine)}async function m_(){if(mr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function b_(){return!0}function v_(t){switch(ss()){case st.browser:E_(t);break;case st.reactNative:__(t);break}}function E_(t){!mr()&&yi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function __(t){mr()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function x_(){var t;return yi()&&Rr()?((t=Rr())==null?void 0:t.visibilityState)==="visible":!0}const oo={};class Oi{static get(e){return oo[e]}static set(e,r){oo[e]=r}static delete(e){delete oo[e]}}function I_(t){const e=ts.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function S_({publicKey:t,signature:e,payload:r}){var i;const s=Xo(r.method),n=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=O_(r.address),a=r.era==="00"?new Uint8Array([0]):Xo(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${D_(r.tip)}`),h=P_(u),f=new Uint8Array([0,...t,o,...e,...a,...l,...h,...s]),d=A_(f.length+1);return new Uint8Array([...d,n,...f])}function $_(t){const e=Xo(t),r=u1.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function Xo(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function D_(t){return t.startsWith("0x")?t.slice(2):t}function O_(t){const e=ts.decode(t)[0];return e===42?0:e===60?2:1}function A_(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function P_(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function C_(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=I_(t.transaction.address),i=S_({publicKey:r,signature:e,payload:t.transaction}),s=Buffer.from(i).toString("hex");return $_(s)}class Lr{}let T_=class extends Lr{constructor(e){super()}};const Jl=F.FIVE_SECONDS,Mr={pulse:"heartbeat_pulse"};let R_=class Vd extends T_{constructor(e){super(e),this.events=new nt.EventEmitter,this.interval=Jl,this.interval=(e==null?void 0:e.interval)||Jl}static async init(e){const r=new Vd(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),F.toMiliseconds(this.interval))}pulse(){this.events.emit(Mr.pulse)}};const B_=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,N_=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,U_=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function j_(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){F_(t);return}return e}function F_(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function $s(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!U_.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(B_.test(t)||N_.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,j_)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function k_(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function _e(t,...e){try{return k_(t(...e))}catch(r){return Promise.reject(r)}}function L_(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function M_(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function ks(t){if(L_(t))return String(t);if(M_(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return ks(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Qo="base64:";function q_(t){return typeof t=="string"?t:Qo+V_(t)}function z_(t){return typeof t!="string"||!t.startsWith(Qo)?t:K_(t.slice(Qo.length))}function K_(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function V_(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ve(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function H_(...t){return Ve(t.join(":"))}function Ds(t){return t=Ve(t),t?t+":":""}function W_(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function G_(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const Y_="memory",Z_=()=>{const t=new Map;return{name:Y_,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function J_(t={}){const e={mounts:{"":t.driver||Z_()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(l,u)=>{if(e.watching){u=Ve(u);for(const h of e.watchListeners)h(l,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await Xl(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,d=p=>{let y=f.get(p.base);return y||(y={driver:p.driver,base:p.base,items:[]},f.set(p.base,y)),y};for(const p of l){const y=typeof p=="string",m=Ve(y?p:p.key),x=y?void 0:p.value,D=y||!p.options?u:{...u,...p.options},b=r(m);d(b).items.push({key:m,value:x,relativeKey:b.relativeKey,options:D})}return Promise.all([...f.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return _e(f.hasItem,h,u)},getItem(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return _e(f.getItem,h,u).then(d=>$s(d))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?_e(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(d=>({key:H_(h.base,d.key),value:$s(d.value)}))):Promise.all(h.items.map(f=>_e(h.driver.getItem,f.relativeKey,f.options).then(d=>({key:f.key,value:$s(d)})))))},getItemRaw(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return f.getItemRaw?_e(f.getItemRaw,h,u):_e(f.getItem,h,u).then(d=>z_(d))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Ve(l);const{relativeKey:f,driver:d}=r(l);d.setItem&&(await _e(d.setItem,f,ks(u),h),d.watch||s("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return _e(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:ks(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>_e(h.driver.setItem,f.relativeKey,ks(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Ve(l);const{relativeKey:f,driver:d}=r(l);if(d.setItemRaw)await _e(d.setItemRaw,f,u,h);else if(d.setItem)await _e(d.setItem,f,q_(u),h);else return;d.watch||s("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Ve(l);const{relativeKey:h,driver:f}=r(l);f.removeItem&&(await _e(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await _e(f.removeItem,h+"$",u),f.watch||s("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Ve(l);const{relativeKey:h,driver:f}=r(l),d=Object.create(null);if(f.getMeta&&Object.assign(d,await _e(f.getMeta,h,u)),!u.nativeOnly){const p=await _e(f.getItem,h+"$",u).then(y=>$s(y));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(d,p))}return d},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var m;l=Ds(l);const h=i(l,!0);let f=[];const d=[];let p=!0;for(const x of h){(m=x.driver.flags)!=null&&m.maxDepth||(p=!1);const D=await _e(x.driver.getKeys,x.relativeBase,u);for(const b of D){const A=x.mountpoint+Ve(b);f.some(C=>A.startsWith(C))||d.push(A)}f=[x.mountpoint,...f.filter(b=>!b.startsWith(x.mountpoint))]}const y=u.maxDepth!==void 0&&!p;return d.filter(x=>(!y||W_(x,u.maxDepth))&&G_(x,l))},async clear(l,u={}){l=Ds(l),await Promise.all(i(l,!1).map(async h=>{if(h.driver.clear)return _e(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(d=>h.driver.removeItem(d,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Ql(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=Ds(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(Xl(u,s,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,f;l=Ds(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((f=(h=e.unwatch)[l])==null||f.call(h),delete e.unwatch[l]),u&&await Ql(e.mounts[l]),e.mountpoints=e.mountpoints.filter(d=>d!==l),delete e.mounts[l])},getMount(l=""){l=Ve(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Ve(l),i(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function Xl(t,e,r){return t.watch?t.watch((i,s)=>e(i,r+s)):()=>{}}async function Ql(t){typeof t.dispose=="function"&&await _e(t.dispose)}function qr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Hd(t,e){let r;const i=()=>{if(r)return r;const s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),r=qr(s),r.then(n=>{n.onclose=()=>r=void 0},()=>{}),r};return(s,n)=>i().then(o=>n(o.transaction(e,s).objectStore(e)))}let ao;function ls(){return ao||(ao=Hd("keyval-store","keyval")),ao}function eu(t,e=ls()){return e("readonly",r=>qr(r.get(t)))}function X_(t,e,r=ls()){return r("readwrite",i=>(i.put(e,t),qr(i.transaction)))}function Q_(t,e=ls()){return e("readwrite",r=>(r.delete(t),qr(r.transaction)))}function e3(t=ls()){return t("readwrite",e=>(e.clear(),qr(e.transaction)))}function t3(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},qr(t.transaction)}function r3(t=ls()){return t("readonly",e=>{if(e.getAllKeys)return qr(e.getAllKeys());const r=[];return t3(e,i=>r.push(i.key)).then(()=>r)})}const i3="idb-keyval";var s3=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let i;return t.dbName&&t.storeName&&(i=Hd(t.dbName,t.storeName)),{name:i3,options:t,async hasItem(s){return!(typeof await eu(r(s),i)>"u")},async getItem(s){return await eu(r(s),i)??null},setItem(s,n){return X_(r(s),n,i)},removeItem(s){return Q_(r(s),i)},getKeys(){return r3(i)},clear(){return e3(i)}}};const n3="WALLET_CONNECT_V2_INDEXED_DB",o3="keyvaluestorage";let a3=class{constructor(){this.indexedDb=J_({driver:s3({dbName:n3,storeName:o3})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Zt(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var co=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ls={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof co<"u"&&co.localStorage?Ls.exports=co.localStorage:typeof window<"u"&&window.localStorage?Ls.exports=window.localStorage:Ls.exports=new e})();function c3(t){var e;return[t[0],Nr((e=t[1])!=null?e:"")]}let l3=class{constructor(){this.localStorage=Ls.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(c3)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Nr(r)}async setItem(e,r){this.localStorage.setItem(e,Zt(r))}async removeItem(e){this.localStorage.removeItem(e)}};const u3="wc_storage_version",tu=1,h3=async(t,e,r)=>{const i=u3,s=await e.getItem(i);if(s&&s>=tu){r(e);return}const n=await t.getKeys();if(!n.length){r(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,tu),r(e),f3(t,o)},f3=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let d3=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new l3;this.storage=e;try{const r=new a3;h3(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};function p3(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var g3=y3;function y3(t,e,r){var i=r&&r.stringify||p3,s=1;if(typeof t=="object"&&t!==null){var n=e.length+s;if(n===1)return t;var o=new Array(n);o[0]=i(t);for(var a=1;a<n;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var l="",u=1-s,h=-1,f=t&&t.length||0,d=0;d<f;){if(t.charCodeAt(d)===37&&d+1<f){switch(h=h>-1?h:0,t.charCodeAt(d+1)){case 100:case 102:if(u>=c||e[u]==null)break;h<d&&(l+=t.slice(h,d)),l+=Number(e[u]),h=d+2,d++;break;case 105:if(u>=c||e[u]==null)break;h<d&&(l+=t.slice(h,d)),l+=Math.floor(Number(e[u])),h=d+2,d++;break;case 79:case 111:case 106:if(u>=c||e[u]===void 0)break;h<d&&(l+=t.slice(h,d));var p=typeof e[u];if(p==="string"){l+="'"+e[u]+"'",h=d+2,d++;break}if(p==="function"){l+=e[u].name||"<anonymous>",h=d+2,d++;break}l+=i(e[u]),h=d+2,d++;break;case 115:if(u>=c)break;h<d&&(l+=t.slice(h,d)),l+=String(e[u]),h=d+2,d++;break;case 37:h<d&&(l+=t.slice(h,d)),l+="%",h=d+2,d++,u--;break}++u}++d}return h===-1?t:(h<f&&(l+=t.slice(h)),l)}const ru=g3;var ei=Nt;const Ji=$3().console||{},w3={mapHttpRequest:Os,mapHttpResponse:Os,wrapRequestSerializer:lo,wrapResponseSerializer:lo,wrapErrorSerializer:lo,req:Os,res:Os,err:_3};function m3(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Nt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Ji;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},s=m3(t.browser.serialize,i);let n=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(n=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=Xi),Object.defineProperty(c,"levelVal",{get:u}),Object.defineProperty(c,"level",{get:h,set:f});const l={transmit:e,serialize:s,asObject:t.browser.asObject,levels:o,timestamp:x3(t)};c.levels=Nt.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Xi,c.serializers=i,c._serialize=s,c._stdErrSerialize=n,c.child=d,e&&(c._logEvent=ea());function u(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function f(p){if(p!=="silent"&&!this.levels.values[p])throw Error("unknown level "+p);this._level=p,Gr(l,c,"error","log"),Gr(l,c,"fatal","error"),Gr(l,c,"warn","error"),Gr(l,c,"info","log"),Gr(l,c,"debug","log"),Gr(l,c,"trace","log")}function d(p,y){if(!p)throw new Error("missing bindings for child Pino");y=y||{},s&&p.serializers&&(y.serializers=p.serializers);const m=y.serializers;if(s&&m){var x=Object.assign({},i,m),D=t.browser.serialize===!0?Object.keys(x):s;delete p.serializers,In([p],D,x,this._stdErrSerialize)}function b(A){this._childLevel=(A._childLevel|0)+1,this.error=Yr(A,p,"error"),this.fatal=Yr(A,p,"fatal"),this.warn=Yr(A,p,"warn"),this.info=Yr(A,p,"info"),this.debug=Yr(A,p,"debug"),this.trace=Yr(A,p,"trace"),x&&(this.serializers=x,this._serialize=D),e&&(this._logEvent=ea([].concat(A._logEvent.bindings,p)))}return b.prototype=this,new b(this)}return c}Nt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Nt.stdSerializers=w3;Nt.stdTimeFunctions=Object.assign({},{nullTime:Wd,epochTime:Gd,unixTime:I3,isoTime:S3});function Gr(t,e,r,i){const s=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Xi:s[r]?s[r]:Ji[r]||Ji[i]||Xi,b3(t,e,r)}function b3(t,e,r){!t.transmit&&e[r]===Xi||(e[r]=function(i){return function(){const n=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Ji?Ji:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&In(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(a,v3(this,r,o,n)):i.apply(a,o),t.transmit){const l=t.transmit.level||e.level,u=Nt.levels.values[l],h=Nt.levels.values[r];if(h<u)return;E3(this,{ts:n,methodLevel:r,methodValue:h,transmitValue:Nt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function v3(t,e,r,i){t._serialize&&In(r,t._serialize,t.serializers,t._stdErrSerialize);const s=r.slice();let n=s[0];const o={};i&&(o.time=i),o.level=Nt.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),n!==null&&typeof n=="object"){for(;a--&&typeof s[0]=="object";)Object.assign(o,s.shift());n=s.length?ru(s.shift(),s):void 0}else typeof n=="string"&&(n=ru(s.shift(),s));return n!==void 0&&(o.msg=n),o}function In(t,e,r,i){for(const s in t)if(i&&t[s]instanceof Error)t[s]=Nt.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s]))for(const n in t[s])e&&e.indexOf(n)>-1&&n in r&&(t[s][n]=r[n](t[s][n]))}function Yr(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return t[r].apply(this,i)}}function E3(t,e,r){const i=e.send,s=e.ts,n=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;In(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(l){return c.indexOf(l)===-1}),t._logEvent.level.label=n,t._logEvent.level.value=o,i(n,t._logEvent,a),t._logEvent=ea(c)}function ea(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function _3(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function x3(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Wd:Gd}function Os(){return{}}function lo(t){return t}function Xi(){}function Wd(){return!1}function Gd(){return Date.now()}function I3(){return Math.round(Date.now()/1e3)}function S3(){return new Date(Date.now()).toISOString()}function $3(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const us=Ea(ei),D3={level:"info"},hs="custom_context",Za=1e3*1024;let O3=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},iu=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new O3(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}},Yd=class{constructor(e,r=Za){this.level=e??"error",this.levelValue=ei.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new iu(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===ei.levels.values.error?console.error(e):r===ei.levels.values.warn?console.warn(e):r===ei.levels.values.debug?console.debug(e):r===ei.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Zt({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new iu(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Zt({extraMetadata:e})),new Blob(r,{type:"application/json"})}},A3=class{constructor(e,r=Za){this.baseChunkLogger=new Yd(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}},P3=class{constructor(e,r=Za){this.baseChunkLogger=new Yd(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var C3=Object.defineProperty,T3=Object.defineProperties,R3=Object.getOwnPropertyDescriptors,su=Object.getOwnPropertySymbols,B3=Object.prototype.hasOwnProperty,N3=Object.prototype.propertyIsEnumerable,nu=(t,e,r)=>e in t?C3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sn=(t,e)=>{for(var r in e||(e={}))B3.call(e,r)&&nu(t,r,e[r]);if(su)for(var r of su(e))N3.call(e,r)&&nu(t,r,e[r]);return t},nn=(t,e)=>T3(t,R3(e));function Sn(t){return nn(sn({},t),{level:(t==null?void 0:t.level)||D3.level})}function U3(t,e=hs){return t[e]||""}function j3(t,e,r=hs){return t[r]=e,t}function Je(t,e=hs){let r="";return typeof t.bindings>"u"?r=U3(t,e):r=t.bindings().context||"",r}function F3(t,e,r=hs){const i=Je(t,r);return i.trim()?`${i}/${e}`:e}function qe(t,e,r=hs){const i=F3(t,e,r),s=t.child({context:i});return j3(s,i,r)}function k3(t){var e,r;const i=new A3((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:us(nn(sn({},t.opts),{level:"trace",browser:nn(sn({},(r=t.opts)==null?void 0:r.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function L3(t){var e;const r=new P3((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:us(nn(sn({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function M3(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?k3(t):L3(t)}var q3=Object.defineProperty,z3=(t,e,r)=>e in t?q3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ou=(t,e,r)=>z3(t,typeof e!="symbol"?e+"":e,r);let K3=class extends Lr{constructor(e){super(),this.opts=e,ou(this,"protocol","wc"),ou(this,"version",2)}};var V3=Object.defineProperty,H3=(t,e,r)=>e in t?V3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,W3=(t,e,r)=>H3(t,e+"",r);let G3=class extends Lr{constructor(e,r){super(),this.core=e,this.logger=r,W3(this,"records",new Map)}},Y3=class{constructor(e,r){this.logger=e,this.core=r}},Z3=class extends Lr{constructor(e,r){super(),this.relayer=e,this.logger=r}},J3=class extends Lr{constructor(e){super()}},X3=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}},Q3=class extends Lr{constructor(e,r){super(),this.relayer=e,this.logger=r}},ex=class extends Lr{constructor(e,r){super(),this.core=e,this.logger=r}},tx=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},rx=class{constructor(e,r){this.projectId=e,this.logger=r}},ix=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var sx=Object.defineProperty,nx=(t,e,r)=>e in t?sx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,au=(t,e,r)=>nx(t,typeof e!="symbol"?e+"":e,r);let ox=class{constructor(e){this.opts=e,au(this,"protocol","wc"),au(this,"version",2)}},ax=class{constructor(e){this.client=e}};const cx="PARSE_ERROR",lx="INVALID_REQUEST",ux="METHOD_NOT_FOUND",hx="INVALID_PARAMS",Zd="INTERNAL_ERROR",Ja="SERVER_ERROR",fx=[-32700,-32600,-32601,-32602,-32603],zi={[cx]:{code:-32700,message:"Parse error"},[lx]:{code:-32600,message:"Invalid Request"},[ux]:{code:-32601,message:"Method not found"},[hx]:{code:-32602,message:"Invalid params"},[Zd]:{code:-32603,message:"Internal error"},[Ja]:{code:-32e3,message:"Server error"}},Jd=Ja;function dx(t){return fx.includes(t)}function cu(t){return Object.keys(zi).includes(t)?zi[t]:zi[Jd]}function px(t){const e=Object.values(zi).find(r=>r.code===t);return e||zi[Jd]}function Xd(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Qd={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ta=function(t,e){return ta=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},ta(t,e)};function gx(t,e){ta(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var ra=function(){return ra=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ra.apply(this,arguments)};function yx(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function wx(t,e,r,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(s<3?o(n):s>3?o(e,r,n):o(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n}function mx(t,e){return function(r,i){e(r,i,t)}}function bx(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function vx(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?n(u.value):s(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Ex(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=l[0]&2?s.return:l[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,l[1])).done)return n;switch(s=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){r.label=l[1];break}if(l[0]===6&&r.label<n[1]){r.label=n[1],n=l;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(l);break}n[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],s=0}finally{i=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function _x(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function xx(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ia(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ep(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return n}function Ix(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ep(arguments[e]));return t}function Sx(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Qi(t){return this instanceof Qi?(this.v=t,this):new Qi(t)}function $x(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){i[f]&&(s[f]=function(d){return new Promise(function(p,y){n.push([f,d,p,y])>1||a(f,d)})})}function a(f,d){try{c(i[f](d))}catch(p){h(n[0][3],p)}}function c(f){f.value instanceof Qi?Promise.resolve(f.value.v).then(l,u):h(n[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),n.shift(),n.length&&a(n[0][0],n[0][1])}}function Dx(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=t[s]?function(o){return(r=!r)?{value:Qi(t[s](o)),done:s==="return"}:n?n(o):o}:n}}function Ox(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ia=="function"?ia(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(n){r[n]=t[n]&&function(o){return new Promise(function(a,c){o=t[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(l){n({value:l,done:a})},o)}}function Ax(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Px(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Cx(t){return t&&t.__esModule?t:{default:t}}function Tx(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Rx(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Bx=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ra},__asyncDelegator:Dx,__asyncGenerator:$x,__asyncValues:Ox,__await:Qi,__awaiter:vx,__classPrivateFieldGet:Tx,__classPrivateFieldSet:Rx,__createBinding:_x,__decorate:wx,__exportStar:xx,__extends:gx,__generator:Ex,__importDefault:Cx,__importStar:Px,__makeTemplateObject:Ax,__metadata:bx,__param:mx,__read:ep,__rest:yx,__spread:Ix,__spreadArrays:Sx,__values:ia},Symbol.toStringTag,{value:"Module"})),Nx=mh(Bx);var qt={},lu;function Ux(){if(lu)return qt;lu=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.isBrowserCryptoAvailable=qt.getSubtleCrypto=qt.getBrowerCrypto=void 0;function t(){return(Pt===null||Pt===void 0?void 0:Pt.crypto)||(Pt===null||Pt===void 0?void 0:Pt.msCrypto)||{}}qt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}qt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return qt.isBrowserCryptoAvailable=r,qt}var zt={},uu;function jx(){if(uu)return zt;uu=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.isBrowser=zt.isNode=zt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}zt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}zt.isNode=e;function r(){return!t()&&!e()}return zt.isBrowser=r,zt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Nx;e.__exportStar(Ux(),t),e.__exportStar(jx(),t)})(Qd);function Ot(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function gr(t=6){return BigInt(Ot(t))}function bt(t,e,r){return{id:r||Ot(),jsonrpc:"2.0",method:t,params:e}}function es(t,e){return{id:t,jsonrpc:"2.0",result:e}}function $n(t,e,r){return{id:t,jsonrpc:"2.0",error:Fx(e)}}function Fx(t,e){return typeof t>"u"?cu(Zd):(typeof t=="string"&&(t=Object.assign(Object.assign({},cu(Ja)),{message:t})),dx(t.code)&&(t=px(t.code)),t)}class kx{}class Lx extends kx{constructor(){super()}}class Mx extends Lx{constructor(e){super()}}const qx="^https?:",zx="^wss?:";function Kx(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function tp(t,e){const r=Kx(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function hu(t){return tp(t,qx)}function fu(t){return tp(t,zx)}function Vx(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function rp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Xa(t){return rp(t)&&"method"in t}function Dn(t){return rp(t)&&(At(t)||ht(t))}function At(t){return"result"in t}function ht(t){return"error"in t}let Qa=class extends Mx{constructor(e){super(e),this.events=new nt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(bt(e.method,e.params||[],e.id||gr().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{ht(n)?s(n.error):i(n.result)});try{await this.connection.send(e,r)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Dn(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const Hx=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Wx=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",du=t=>t.split("?")[0],pu=10,Gx=Hx();let Yx=class{constructor(e){if(this.url=e,this.events=new nt.EventEmitter,this.registering=!1,!fu(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Zt(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!fu(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=Qd.isReactNative()?void 0:{rejectUnauthorized:!Vx(e)},n=new Gx(e,[],s);Wx()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),r(n)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Nr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=$n(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return Xd(e,du(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>pu&&this.events.setMaxListeners(pu)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${du(this.url)}`));return this.events.emit("register_error",r),r}};var Zx={};const ip="wc",sp=2,sa="core",Ut=`${ip}@2:${sa}:`,Jx={logger:"error"},Xx={database:":memory:"},Qx="crypto",gu="client_ed25519_seed",eI=F.ONE_DAY,tI="keychain",rI="0.3",iI="messages",sI="0.3",nI=F.SIX_HOURS,oI="publisher",np="irn",aI="error",op="wss://relay.walletconnect.org",cI="relayer",fe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},lI="_subscription",ot={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},uI=.1,na="2.21.9",ue={link_mode:"link_mode",relay:"relay"},Ms={inbound:"inbound",outbound:"outbound"},hI="0.3",fI="WALLETCONNECT_CLIENT_ID",yu="WALLETCONNECT_LINK_MODE_APPS",tt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},dI="subscription",pI="0.3",gI="pairing",yI="0.3",Ai={wc_pairingDelete:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:F.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:F.ONE_DAY,prompt:!1,tag:0},res:{ttl:F.ONE_DAY,prompt:!1,tag:0}}},Dr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},yt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},wI="history",mI="0.3",bI="expirer",lt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},vI="0.3",EI="verify-api",_I="https://verify.walletconnect.com",ap="https://verify.walletconnect.org",Ki=ap,xI=`${Ki}/v3`,II=[_I,ap],SI="echo",$I="https://echo.walletconnect.com",Dt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Vt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},lr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Pi={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},_r={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Ci={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},DI=.1,OI="event-client",AI=86400,PI="https://pulse.walletconnect.org/batch";function CI(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,m=0,x=0,D=p.length;x!==D&&p[x]===0;)x++,y++;for(var b=(D-x)*u+1>>>0,A=new Uint8Array(b);x!==D;){for(var C=p[x],T=0,j=b-1;(C!==0||T<m)&&j!==-1;j--,T++)C+=256*A[j]>>>0,A[j]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");m=T,x++}for(var U=b-m;U!==b&&A[U]===0;)U++;for(var O=c.repeat(y);U<b;++U)O+=t.charAt(A[U]);return O}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var m=0,x=0;p[y]===c;)m++,y++;for(var D=(p.length-y)*l+1>>>0,b=new Uint8Array(D);p[y];){var A=r[p.charCodeAt(y)];if(A===255)return;for(var C=0,T=D-1;(A!==0||C<x)&&T!==-1;T--,C++)A+=a*b[T]>>>0,b[T]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");x=C,y++}if(p[y]!==" "){for(var j=D-x;j!==D&&b[j]===0;)j++;for(var U=new Uint8Array(m+(D-j)),O=m;j!==D;)U[O++]=b[j++];return U}}}function d(p){var y=f(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var TI=CI,RI=TI;const cp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},BI=t=>new TextEncoder().encode(t),NI=t=>new TextDecoder().decode(t);class UI{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class jI{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return lp(this,e)}}class FI{constructor(e){this.decoders=e}or(e){return lp(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const lp=(t,e)=>new FI({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class kI{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new UI(e,r,i),this.decoder=new jI(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const On=({name:t,prefix:e,encode:r,decode:i})=>new kI(t,e,r,i),fs=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=RI(r,e);return On({prefix:t,name:e,encode:i,decode:n=>cp(s(n))})},LI=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},MI=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Ce=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>On({prefix:e,name:t,encode(s){return MI(s,i,r)},decode(s){return LI(s,i,r,t)}}),qI=On({prefix:"\0",name:"identity",encode:t=>NI(t),decode:t=>BI(t)});var zI=Object.freeze({__proto__:null,identity:qI});const KI=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var VI=Object.freeze({__proto__:null,base2:KI});const HI=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var WI=Object.freeze({__proto__:null,base8:HI});const GI=fs({prefix:"9",name:"base10",alphabet:"0123456789"});var YI=Object.freeze({__proto__:null,base10:GI});const ZI=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),JI=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var XI=Object.freeze({__proto__:null,base16:ZI,base16upper:JI});const QI=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),eS=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),tS=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rS=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),iS=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sS=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),nS=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oS=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),aS=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var cS=Object.freeze({__proto__:null,base32:QI,base32upper:eS,base32pad:tS,base32padupper:rS,base32hex:iS,base32hexupper:sS,base32hexpad:nS,base32hexpadupper:oS,base32z:aS});const lS=fs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),uS=fs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var hS=Object.freeze({__proto__:null,base36:lS,base36upper:uS});const fS=fs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dS=fs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var pS=Object.freeze({__proto__:null,base58btc:fS,base58flickr:dS});const gS=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),yS=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wS=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mS=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var bS=Object.freeze({__proto__:null,base64:gS,base64pad:yS,base64url:wS,base64urlpad:mS});const up=Array.from(""),vS=up.reduce((t,e,r)=>(t[r]=e,t),[]),ES=up.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function _S(t){return t.reduce((e,r)=>(e+=vS[r],e),"")}function xS(t){const e=[];for(const r of t){const i=ES[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const IS=On({prefix:"",name:"base256emoji",encode:_S,decode:xS});var SS=Object.freeze({__proto__:null,base256emoji:IS}),$S=hp,wu=128,DS=-128,OS=Math.pow(2,31);function hp(t,e,r){e=e||[],r=r||0;for(var i=r;t>=OS;)e[r++]=t&255|wu,t/=128;for(;t&DS;)e[r++]=t&255|wu,t>>>=7;return e[r]=t|0,hp.bytes=r-i+1,e}var AS=oa,PS=128,mu=127;function oa(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw oa.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&mu)<<s:(o&mu)*Math.pow(2,s),s+=7}while(o>=PS);return oa.bytes=n-i,r}var CS=Math.pow(2,7),TS=Math.pow(2,14),RS=Math.pow(2,21),BS=Math.pow(2,28),NS=Math.pow(2,35),US=Math.pow(2,42),jS=Math.pow(2,49),FS=Math.pow(2,56),kS=Math.pow(2,63),LS=function(t){return t<CS?1:t<TS?2:t<RS?3:t<BS?4:t<NS?5:t<US?6:t<jS?7:t<FS?8:t<kS?9:10},MS={encode:$S,decode:AS,encodingLength:LS},fp=MS;const bu=(t,e,r=0)=>(fp.encode(t,e,r),e),vu=t=>fp.encodingLength(t),aa=(t,e)=>{const r=e.byteLength,i=vu(t),s=i+vu(r),n=new Uint8Array(s+r);return bu(t,n,0),bu(r,n,i),n.set(e,s),new qS(t,r,e,n)};class qS{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const dp=({name:t,code:e,encode:r})=>new zS(t,e,r);class zS{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?aa(this.code,r):r.then(i=>aa(this.code,i))}else throw Error("Unknown type, must be binary type")}}const pp=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),KS=dp({name:"sha2-256",code:18,encode:pp("SHA-256")}),VS=dp({name:"sha2-512",code:19,encode:pp("SHA-512")});var HS=Object.freeze({__proto__:null,sha256:KS,sha512:VS});const gp=0,WS="identity",yp=cp,GS=t=>aa(gp,yp(t)),YS={code:gp,name:WS,encode:yp,digest:GS};var ZS=Object.freeze({__proto__:null,identity:YS});new TextEncoder,new TextDecoder;const Eu={...zI,...VI,...WI,...YI,...XI,...cS,...hS,...pS,...bS,...SS};({...HS,...ZS});function wp(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function JS(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?wp(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function mp(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const _u=mp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),uo=mp("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=JS(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),XS={utf8:_u,"utf-8":_u,hex:Eu.base16,latin1:uo,ascii:uo,binary:uo,...Eu};function QS(t,e="utf8"){const r=XS[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?wp(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var e8=Object.defineProperty,t8=(t,e,r)=>e in t?e8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,St=(t,e,r)=>t8(t,typeof e!="symbol"?e+"":e,r);class r8{constructor(e,r){this.core=e,this.logger=r,St(this,"keychain",new Map),St(this,"name",tI),St(this,"version",rI),St(this,"initialized",!1),St(this,"storagePrefix",Ut),St(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),St(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),St(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),St(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),St(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=qe(r,this.name)}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ko(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Lo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var i8=Object.defineProperty,s8=(t,e,r)=>e in t?i8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$e=(t,e,r)=>s8(t,typeof e!="symbol"?e+"":e,r);class n8{constructor(e,r,i){this.core=e,this.logger=r,$e(this,"name",Qx),$e(this,"keychain"),$e(this,"randomSessionIdentifier",Jo()),$e(this,"initialized",!1),$e(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),$e(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),$e(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=Zc(s);return _f(n.publicKey)}),$e(this,"generateKeyPair",()=>{this.isInitialized();const s=gE();return this.setPrivateKey(s.publicKey,s.privateKey)}),$e(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=Zc(n),a=this.randomSessionIdentifier;return await tb(a,s,eI,o)}),$e(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=yE(a,n);return this.setSymKey(c,o)}),$e(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||Fs(s);return await this.keychain.set(o,s),o}),$e(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),$e(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),$e(this,"encode",async(s,n,o)=>{this.isInitialized();const a=qd(o),c=Zt(n);if(jl(a))return bE(c,o==null?void 0:o.encoding);if(Ul(a)){const f=a.senderPublicKey,d=a.receiverPublicKey;s=await this.generateSharedKey(f,d)}const l=this.getSymKey(s),{type:u,senderPublicKey:h}=a;return wE({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),$e(this,"decode",async(s,n,o)=>{this.isInitialized();const a=EE(n,o);if(jl(a)){const c=vE(n,o==null?void 0:o.encoding);return Nr(c)}if(Ul(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=mE({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return Nr(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),$e(this,"getPayloadType",(s,n=Ge)=>{const o=Zi({encoded:s,encoding:n});return jr(o.type)}),$e(this,"getPayloadSenderPublicKey",(s,n=Ge)=>{const o=Zi({encoded:s,encoding:n});return o.senderPublicKey?Ze(o.senderPublicKey,Me):void 0}),this.core=e,this.logger=qe(r,this.name),this.keychain=i||new r8(this.core,this.logger)}get context(){return Je(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(gu)}catch{e=Jo(),await this.keychain.set(gu,e)}return QS(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var o8=Object.defineProperty,a8=Object.defineProperties,c8=Object.getOwnPropertyDescriptors,xu=Object.getOwnPropertySymbols,l8=Object.prototype.hasOwnProperty,u8=Object.prototype.propertyIsEnumerable,ca=(t,e,r)=>e in t?o8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h8=(t,e)=>{for(var r in e||(e={}))l8.call(e,r)&&ca(t,r,e[r]);if(xu)for(var r of xu(e))u8.call(e,r)&&ca(t,r,e[r]);return t},f8=(t,e)=>a8(t,c8(e)),Qe=(t,e,r)=>ca(t,typeof e!="symbol"?e+"":e,r);class d8 extends Y3{constructor(e,r){super(e,r),this.logger=e,this.core=r,Qe(this,"messages",new Map),Qe(this,"messagesWithoutClientAck",new Map),Qe(this,"name",iI),Qe(this,"version",sI),Qe(this,"initialized",!1),Qe(this,"storagePrefix",Ut),Qe(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),Qe(this,"set",async(i,s,n)=>{this.isInitialized();const o=ut(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===Ms.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,f8(h8({},c),{[o]:s}))}return await this.persist(),o}),Qe(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),Qe(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),Qe(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=ut(s);return typeof n[o]<"u"}),Qe(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=ut(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),Qe(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=qe(e,this.name),this.core=r}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ko(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ko(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Lo(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Lo(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var p8=Object.defineProperty,g8=Object.defineProperties,y8=Object.getOwnPropertyDescriptors,Iu=Object.getOwnPropertySymbols,w8=Object.prototype.hasOwnProperty,m8=Object.prototype.propertyIsEnumerable,la=(t,e,r)=>e in t?p8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zr=(t,e)=>{for(var r in e||(e={}))w8.call(e,r)&&la(t,r,e[r]);if(Iu)for(var r of Iu(e))m8.call(e,r)&&la(t,r,e[r]);return t},Su=(t,e)=>g8(t,y8(e)),at=(t,e,r)=>la(t,typeof e!="symbol"?e+"":e,r);class b8 extends Z3{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,at(this,"events",new nt.EventEmitter),at(this,"name",oI),at(this,"queue",new Map),at(this,"publishTimeout",F.toMiliseconds(F.ONE_MINUTE)),at(this,"initialPublishTimeout",F.toMiliseconds(F.ONE_SECOND*15)),at(this,"needsTransportRestart",!1),at(this,"publish",async(i,s,n)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const h=(n==null?void 0:n.ttl)||nI,f=(n==null?void 0:n.prompt)||!1,d=(n==null?void 0:n.tag)||0,p=(n==null?void 0:n.id)||gr().toString(),y=ri(tn().protocol),m={id:p,method:(n==null?void 0:n.publishMethod)||y.publish,params:Zr({topic:i,message:s,ttl:h,prompt:f,tag:d,attestation:n==null?void 0:n.attestation},n==null?void 0:n.tvf)},x=`Failed to publish payload, please try again. id:${p} tag:${d}`;try{ve((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),ve((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);const D=new Promise(async b=>{const A=({id:T})=>{var j;((j=m.id)==null?void 0:j.toString())===T.toString()&&(this.removeRequestFromQueue(T),this.relayer.events.removeListener(fe.publish,A),b())};this.relayer.events.on(fe.publish,A);const C=Tt(new Promise((T,j)=>{this.rpcPublish(m,n).then(T).catch(U=>{this.logger.warn(U,U==null?void 0:U.message),j(U)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${d}`);try{await C,this.events.removeListener(fe.publish,A)}catch(T){this.queue.set(p,{request:m,opts:n,attempt:1}),this.logger.warn(T,T==null?void 0:T.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:i,message:s,opts:n}}),await Tt(D,this.publishTimeout,x)}catch(D){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(D),(u=n==null?void 0:n.internal)!=null&&u.throwOnFailedPublish)throw D}finally{this.queue.delete(p)}}),at(this,"publishCustom",async i=>{var s,n,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:l,opts:u={}}=i,{attestation:h,tvf:f,publishMethod:d,prompt:p,tag:y,ttl:m=F.FIVE_MINUTES}=u,x=u.id||gr().toString(),D=ri(tn().protocol),b=d||D.publish,A={id:x,method:b,params:Zr(Su(Zr({},l),{ttl:m,prompt:p,tag:y,attestation:h}),f)},C=`Failed to publish custom payload, please try again. id:${x} tag:${y}`;try{ve((s=A.params)==null?void 0:s.prompt)&&((n=A.params)==null||delete n.prompt),ve((o=A.params)==null?void 0:o.tag)&&((a=A.params)==null||delete a.tag);const T=new Promise(async j=>{const U=({id:K})=>{var V;((V=A.id)==null?void 0:V.toString())===K.toString()&&(this.removeRequestFromQueue(K),this.relayer.events.removeListener(fe.publish,U),j())};this.relayer.events.on(fe.publish,U);const O=Tt(new Promise((K,V)=>{this.rpcPublish(A,u).then(K).catch(P=>{this.logger.warn(P,P==null?void 0:P.message),V(P)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${b} id:${x} tag:${y}`);try{await O,this.events.removeListener(fe.publish,U)}catch(K){this.queue.set(x,{request:A,opts:u,attempt:1}),this.logger.warn(K,K==null?void 0:K.message)}});this.logger.trace({type:"method",method:"publish",params:{id:x,payload:l,opts:u}}),await Tt(T,this.publishTimeout,C)}catch(T){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(T),(c=u==null?void 0:u.internal)!=null&&c.throwOnFailedPublish)throw T}finally{this.queue.delete(x)}}),at(this,"on",(i,s)=>{this.events.on(i,s)}),at(this,"once",(i,s)=>{this.events.once(i,s)}),at(this,"off",(i,s)=>{this.events.off(i,s)}),at(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=qe(r,this.name),this.registerEventListeners()}get context(){return Je(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(fe.publish,Zr(Zr({},e),r)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var i;const s=e.attempt+1;this.queue.set(r,Su(Zr({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Mr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(fe.connection_stalled);return}this.checkQueue()}),this.relayer.on(fe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var v8=Object.defineProperty,E8=(t,e,r)=>e in t?v8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jr=(t,e,r)=>E8(t,typeof e!="symbol"?e+"":e,r);class _8{constructor(){Jr(this,"map",new Map),Jr(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),Jr(this,"get",e=>this.map.get(e)||[]),Jr(this,"exists",(e,r)=>this.get(e).includes(r)),Jr(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(n=>n!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Jr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var x8=Object.defineProperty,I8=Object.defineProperties,S8=Object.getOwnPropertyDescriptors,$u=Object.getOwnPropertySymbols,$8=Object.prototype.hasOwnProperty,D8=Object.prototype.propertyIsEnumerable,ua=(t,e,r)=>e in t?x8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ti=(t,e)=>{for(var r in e||(e={}))$8.call(e,r)&&ua(t,r,e[r]);if($u)for(var r of $u(e))D8.call(e,r)&&ua(t,r,e[r]);return t},ho=(t,e)=>I8(t,S8(e)),ae=(t,e,r)=>ua(t,typeof e!="symbol"?e+"":e,r);class O8 extends Q3{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ae(this,"subscriptions",new Map),ae(this,"topicMap",new _8),ae(this,"events",new nt.EventEmitter),ae(this,"name",dI),ae(this,"version",pI),ae(this,"pending",new Map),ae(this,"cached",[]),ae(this,"initialized",!1),ae(this,"storagePrefix",Ut),ae(this,"subscribeTimeout",F.toMiliseconds(F.ONE_MINUTE)),ae(this,"initialSubscribeTimeout",F.toMiliseconds(F.ONE_SECOND*15)),ae(this,"clientId"),ae(this,"batchSubscribeTopicsLimit",500),ae(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ae(this,"subscribe",async(i,s)=>{var n;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=tn(s),a={topic:i,relay:o,transportType:s==null?void 0:s.transportType};(n=s==null?void 0:s.internal)!=null&&n.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ae(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),ae(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),ae(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),ae(this,"on",(i,s)=>{this.events.on(i,s)}),ae(this,"once",(i,s)=>{this.events.once(i,s)}),ae(this,"off",(i,s)=>{this.events.off(i,s)}),ae(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),ae(this,"start",async()=>{await this.onConnect()}),ae(this,"stop",async()=>{await this.onDisconnect()}),ae(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ae(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),ae(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Mr.pulse,async()=>{await this.checkPending()}),this.events.on(tt.created,async i=>{const s=tt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(tt.deleted,async i=>{const s=tt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=qe(r,this.name),this.clientId=""}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=tn(i);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const n=he("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,i){var s,n;const o=await this.getSubscriptionId(e);if((s=i==null?void 0:i.internal)!=null&&s.skipSubscribe)return o;(!i||(i==null?void 0:i.transportType)===ue.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:ri(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(n=i==null?void 0:i.internal)==null?void 0:n.throwOnFailedPublish;try{if((i==null?void 0:i.transportType)===ue.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},F.toMiliseconds(F.ONE_SECOND)),o;const l=new Promise(async h=>{const f=d=>{d.topic===e&&(this.events.removeListener(tt.created,f),h(d.id))};this.events.on(tt.created,f);try{const d=await Tt(new Promise((p,y)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m==null?void 0:m.message),y(m)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(tt.created,f),h(d)}catch{}}),u=await Tt(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(fe.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ri(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Tt(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(fe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:ri(r.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Tt(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(fe.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:ri(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,ho(Ti({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Ti({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Ti({},r)),this.topicMap.set(r.topic,e),this.events.emit(tt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(tt.deleted,ho(Ti({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(tt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(tt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var i;return r.topic===((i=this.subscriptions.get(r.id))==null?void 0:i.topic)})){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>ho(Ti({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await j1(F.toMiliseconds(F.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return ut(e+await this.getClientId())}}var A8=Object.defineProperty,Du=Object.getOwnPropertySymbols,P8=Object.prototype.hasOwnProperty,C8=Object.prototype.propertyIsEnumerable,ha=(t,e,r)=>e in t?A8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ou=(t,e)=>{for(var r in e||(e={}))P8.call(e,r)&&ha(t,r,e[r]);if(Du)for(var r of Du(e))C8.call(e,r)&&ha(t,r,e[r]);return t},te=(t,e,r)=>ha(t,typeof e!="symbol"?e+"":e,r);class T8 extends J3{constructor(e){super(e),te(this,"protocol","wc"),te(this,"version",2),te(this,"core"),te(this,"logger"),te(this,"events",new nt.EventEmitter),te(this,"provider"),te(this,"messages"),te(this,"subscriber"),te(this,"publisher"),te(this,"name",cI),te(this,"transportExplicitlyClosed",!1),te(this,"initialized",!1),te(this,"connectionAttemptInProgress",!1),te(this,"relayUrl"),te(this,"projectId"),te(this,"packageName"),te(this,"bundleId"),te(this,"hasExperiencedNetworkDisruption",!1),te(this,"pingTimeout"),te(this,"heartBeatTimeout",F.toMiliseconds(F.THIRTY_SECONDS+F.FIVE_SECONDS)),te(this,"reconnectTimeout"),te(this,"connectPromise"),te(this,"reconnectInProgress",!1),te(this,"requestsInFlight",[]),te(this,"connectTimeout",F.toMiliseconds(F.ONE_SECOND*15)),te(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");const n=r.id||gr().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),te(this,"resetPingTimeout",()=>{Ys()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),te(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),te(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(fe.connect)}),te(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),te(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(fe.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),te(this,"registerProviderListeners",()=>{this.provider.on(ot.payload,this.onPayloadHandler),this.provider.on(ot.connect,this.onConnectHandler),this.provider.on(ot.disconnect,this.onDisconnectHandler),this.provider.on(ot.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?qe(e.logger,this.name):us(Sn({level:e.logger||aI})),this.messages=new d8(this.logger,e.core),this.subscriber=new O8(this,this.logger),this.publisher=new b8(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||op,E1()?this.packageName=sl():_1()&&(this.bundleId=sl()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return Je(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ue.relay},Ms.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var i,s,n;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=r==null?void 0:r.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(tt.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(tt.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,Ou({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Tt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Zl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const s=ge(F.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(fe.message,e),await this.recordMessageEvent(e,Ms.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(ot.disconnect,n),await Tt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(ot.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ot.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ot.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,F.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,s,n;if(Ys())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Qa(new Yx(D1({sdkVersion:na,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:s}=e;await this.messages.set(i,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Xa(e)){if(!e.method.endsWith(lI))return;const r=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=r.data,a={topic:i,message:s,publishedAt:n,transportType:ue.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ou({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Dn(e)&&this.events.emit(fe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Ms.inbound),this.events.emit(fe.message,e))}async acknowledgePayload(e){const r=es(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ot.payload,this.onPayloadHandler),this.provider.off(ot.connect,this.onConnectHandler),this.provider.off(ot.disconnect,this.onDisconnectHandler),this.provider.off(ot.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Zl();v_(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Mr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&x_())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(fe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},F.toMiliseconds(uI)))))}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function R8(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Au(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Pu(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const B8="[object RegExp]",N8="[object String]",U8="[object Number]",j8="[object Boolean]",Cu="[object Arguments]",F8="[object Symbol]",k8="[object Date]",L8="[object Map]",M8="[object Set]",q8="[object Array]",z8="[object Function]",K8="[object ArrayBuffer]",fo="[object Object]",V8="[object Error]",H8="[object DataView]",W8="[object Uint8Array]",G8="[object Uint8ClampedArray]",Y8="[object Uint16Array]",Z8="[object Uint32Array]",J8="[object BigUint64Array]",X8="[object Int8Array]",Q8="[object Int16Array]",e$="[object Int32Array]",t$="[object BigInt64Array]",r$="[object Float32Array]",i$="[object Float64Array]";function s$(){}function Tu(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function n$(t,e,r){return ki(t,e,void 0,void 0,void 0,void 0,r)}function ki(t,e,r,i,s,n,o){const a=o(t,e,r,i,s,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Vi(t,e,n,o)}return Vi(t,e,n,o)}function Vi(t,e,r,i){if(Object.is(t,e))return!0;let s=Pu(t),n=Pu(e);if(s===Cu&&(s=fo),n===Cu&&(n=fo),s!==n)return!1;switch(s){case N8:return t.toString()===e.toString();case U8:{const c=t.valueOf(),l=e.valueOf();return R8(c,l)}case j8:case k8:case F8:return Object.is(t.valueOf(),e.valueOf());case B8:return t.source===e.source&&t.flags===e.flags;case z8:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case L8:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!ki(l,e.get(c),c,t,e,r,i))return!1;return!0}case M8:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(d=>ki(h,d,void 0,t,e,r,i));if(f===-1)return!1;l.splice(f,1)}return!0}case q8:case W8:case G8:case Y8:case Z8:case J8:case X8:case Q8:case e$:case t$:case r$:case i$:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!ki(t[c],e[c],c,t,e,r,i))return!1;return!0}case K8:return t.byteLength!==e.byteLength?!1:Vi(new Uint8Array(t),new Uint8Array(e),r,i);case H8:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Vi(new Uint8Array(t),new Uint8Array(e),r,i);case V8:return t.name===e.name&&t.message===e.message;case fo:{if(!(Vi(t.constructor,e.constructor,r,i)||Tu(t)&&Tu(e)))return!1;const c=[...Object.keys(t),...Au(t)],l=[...Object.keys(e),...Au(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=t[h];if(!Object.hasOwn(e,h))return!1;const d=e[h];if(!ki(f,d,h,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function o$(t,e){return n$(t,e,s$)}var a$=Object.defineProperty,Ru=Object.getOwnPropertySymbols,c$=Object.prototype.hasOwnProperty,l$=Object.prototype.propertyIsEnumerable,fa=(t,e,r)=>e in t?a$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bu=(t,e)=>{for(var r in e||(e={}))c$.call(e,r)&&fa(t,r,e[r]);if(Ru)for(var r of Ru(e))l$.call(e,r)&&fa(t,r,e[r]);return t},Ke=(t,e,r)=>fa(t,typeof e!="symbol"?e+"":e,r);class zr extends X3{constructor(e,r,i,s=Ut,n=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,Ke(this,"map",new Map),Ke(this,"version",hI),Ke(this,"cached",[]),Ke(this,"initialized",!1),Ke(this,"getKey"),Ke(this,"storagePrefix",Ut),Ke(this,"recentlyDeleted",[]),Ke(this,"recentlyDeletedLimit",200),Ke(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!ve(o)?this.map.set(this.getKey(o),o):JE(o)?this.map.set(o.id,o):XE(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ke(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ke(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ke(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>o$(a[c],o[c]))):this.values)),Ke(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Bu(Bu({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ke(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=qe(r,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=L("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var u$=Object.defineProperty,h$=(t,e,r)=>e in t?u$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,X=(t,e,r)=>h$(t,typeof e!="symbol"?e+"":e,r);class f${constructor(e,r){this.core=e,this.logger=r,X(this,"name",gI),X(this,"version",yI),X(this,"events",new xa),X(this,"pairings"),X(this,"initialized",!1),X(this,"storagePrefix",Ut),X(this,"ignoredPayloadTypes",[Yt]),X(this,"registeredMethods",[]),X(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),X(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),X(this,"create",async i=>{this.isInitialized();const s=Jo(),n=await this.core.crypto.setSymKey(s),o=ge(F.FIVE_MINUTES),a={protocol:np},c={topic:n,expiry:o,relay:a,active:!1,methods:i==null?void 0:i.methods},l=Ml({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i==null?void 0:i.methods});return this.events.emit(Dr.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i==null?void 0:i.transportType,internal:i==null?void 0:i.internal}),{topic:n,uri:l}}),X(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[Dt.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=Ll(i.uri);s.props.properties.topic=n,s.addTrace(Dt.pairing_uri_validation_success),s.addTrace(Dt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),s.addTrace(Dt.existing_pairing),u.active)throw s.setError(Vt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(Dt.pairing_not_expired)}const h=c||ge(F.FIVE_MINUTES),f={topic:n,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(n,h),await this.pairings.set(n,f),s.addTrace(Dt.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Dr.create,f),s.addTrace(Dt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(Dt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Vt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(d){throw s.setError(Vt.subscribe_pairing_topic_failure),d}return s.addTrace(Dt.subscribe_pairing_topic_success),f}),X(this,"activate",async({topic:i})=>{this.isInitialized();const s=ge(F.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),X(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Ir();this.events.once(se("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),X(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),X(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),X(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),X(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",he("USER_DISCONNECTED")),await this.deletePairing(s))}),X(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return Ml({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),X(this,"sendRequest",async(i,s,n)=>{const o=bt(s,n),a=await this.core.crypto.encode(i,o),c=Ai[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),X(this,"sendResult",async(i,s,n)=>{const o=es(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=Ai[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),X(this,"sendError",async(i,s,n)=>{const o=$n(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=Ai[c]?Ai[c].res:Ai.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),X(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,he("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),X(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>Ct(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),X(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),X(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),X(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(Dr.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),X(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{At(s)?this.events.emit(se("pairing_ping",n),{}):ht(s)&&this.events.emit(se("pairing_ping",n),{error:s.error})},500)}),X(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Dr.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),X(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=he("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),X(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(he("WC_METHOD_UNSUPPORTED",i))}),X(this,"isValidPair",(i,s)=>{var n;if(!He(i)){const{message:a}=L("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(Vt.malformed_pairing_uri),new Error(a)}if(!ZE(i.uri)){const{message:a}=L("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(Vt.malformed_pairing_uri),new Error(a)}const o=Ll(i==null?void 0:i.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=L("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Vt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=L("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Vt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&F.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){s.setError(Vt.pairing_expired);const{message:a}=L("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),X(this,"isValidPing",async i=>{if(!He(i)){const{message:n}=L("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),X(this,"isValidDisconnect",async i=>{if(!He(i)){const{message:n}=L("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),X(this,"isValidPairingTopic",async i=>{if(!ye(i,!1)){const{message:s}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Ct(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=L("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=qe(r,this.name),this.pairings=new zr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Je(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(fe.message,async e=>{const{topic:r,message:i,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==ue.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(r,i);Xa(n)?(this.core.history.set(r,n),await this.onRelayEventRequest({topic:r,payload:n})):Dn(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id)),await this.core.relayer.messages.ack(r,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(lt.expired,async e=>{const{topic:r}=Vf(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Dr.expire,{topic:r}))})}}var d$=Object.defineProperty,p$=(t,e,r)=>e in t?d$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,De=(t,e,r)=>p$(t,typeof e!="symbol"?e+"":e,r);class g$ extends G3{constructor(e,r){super(e,r),this.core=e,this.logger=r,De(this,"records",new Map),De(this,"events",new nt.EventEmitter),De(this,"name",wI),De(this,"version",mI),De(this,"cached",[]),De(this,"initialized",!1),De(this,"storagePrefix",Ut),De(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),De(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:ge(F.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(yt.created,o)}),De(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=ht(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(yt.updated,s))}),De(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),De(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(yt.deleted,n)}}),this.persist()}),De(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),De(this,"on",(i,s)=>{this.events.on(i,s)}),De(this,"once",(i,s)=>{this.events.once(i,s)}),De(this,"off",(i,s)=>{this.events.off(i,s)}),De(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=qe(r,this.name)}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:bt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(yt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(yt.created,e=>{const r=yt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(yt.updated,e=>{const r=yt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(yt.deleted,e=>{const r=yt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Mr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{F.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(yt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var y$=Object.defineProperty,w$=(t,e,r)=>e in t?y$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,je=(t,e,r)=>w$(t,typeof e!="symbol"?e+"":e,r);class m$ extends ex{constructor(e,r){super(e,r),this.core=e,this.logger=r,je(this,"expirations",new Map),je(this,"events",new nt.EventEmitter),je(this,"name",bI),je(this,"version",vI),je(this,"cached",[]),je(this,"initialized",!1),je(this,"storagePrefix",Ut),je(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),je(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),je(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(lt.created,{target:n,expiration:o})}),je(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),je(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(lt.deleted,{target:s,expiration:n})}}),je(this,"on",(i,s)=>{this.events.on(i,s)}),je(this,"once",(i,s)=>{this.events.once(i,s)}),je(this,"off",(i,s)=>{this.events.off(i,s)}),je(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=qe(r,this.name)}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return O1(e);if(typeof e=="number")return A1(e);const{message:r}=L("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(lt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;F.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(lt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Mr.pulse,()=>this.checkExpirations()),this.events.on(lt.created,e=>{const r=lt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(lt.expired,e=>{const r=lt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(lt.deleted,e=>{const r=lt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var b$=Object.defineProperty,v$=(t,e,r)=>e in t?b$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pe=(t,e,r)=>v$(t,typeof e!="symbol"?e+"":e,r);class E$ extends tx{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,pe(this,"name",EI),pe(this,"abortController"),pe(this,"isDevEnv"),pe(this,"verifyUrlV3",xI),pe(this,"storagePrefix",Ut),pe(this,"version",sp),pe(this,"publicKey"),pe(this,"fetchPromise"),pe(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&F.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),pe(this,"register",async s=>{if(!yi()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=Rr(),u=this.startAbortTimer(F.ONE_SECOND*5),h=await new Promise((f,d)=>{const p=()=>{window.removeEventListener("message",m),l.body.removeChild(y),d("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const y=l.createElement("iframe");y.src=c,y.style.display="none",y.addEventListener("error",p,{signal:this.abortController.signal});const m=x=>{if(x.data&&typeof x.data=="string")try{const D=JSON.parse(x.data);if(D.type==="verify_attestation"){if(jo(D.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(y),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",m),f(D.attestation===null?"":D.attestation)}}catch(D){this.logger.warn(D)}};l.body.appendChild(y),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),pe(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(jo(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(o,c)}),pe(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(F.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),pe(this,"getVerifyUrl",s=>{let n=s||Ki;return II.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Ki}`),n=Ki),n}),pe(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(F.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),pe(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),pe(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),pe(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),pe(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),pe(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),pe(this,"validateAttestation",(s,n)=>{const o=xE(s,n.publicKey),a={hasExpired:F.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=qe(r,this.name),this.abortController=new AbortController,this.isDevEnv=Fa(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Je(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),F.toMiliseconds(e))}}var _$=Object.defineProperty,x$=(t,e,r)=>e in t?_$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nu=(t,e,r)=>x$(t,typeof e!="symbol"?e+"":e,r);class I$ extends rx{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Nu(this,"context",SI),Nu(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${$I}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=qe(r,this.context)}}var S$=Object.defineProperty,Uu=Object.getOwnPropertySymbols,$$=Object.prototype.hasOwnProperty,D$=Object.prototype.propertyIsEnumerable,da=(t,e,r)=>e in t?S$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ri=(t,e)=>{for(var r in e||(e={}))$$.call(e,r)&&da(t,r,e[r]);if(Uu)for(var r of Uu(e))D$.call(e,r)&&da(t,r,e[r]);return t},Ee=(t,e,r)=>da(t,typeof e!="symbol"?e+"":e,r);class O$ extends ix{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,Ee(this,"context",OI),Ee(this,"storagePrefix",Ut),Ee(this,"storageVersion",DI),Ee(this,"events",new Map),Ee(this,"shouldPersist",!1),Ee(this,"init",async()=>{if(!Fa())try{const s={eventId:ol(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:zf(this.core.relayer.protocol,this.core.relayer.version,na)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Ee(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=ol(),u=this.core.projectId||"",h=Date.now(),f=Ri({eventId:l,timestamp:h,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),Ee(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ri(Ri({},a),this.setMethods(a.eventId))}),Ee(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),Ee(this,"setEventListeners",()=>{this.core.heartbeat.on(Mr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{F.fromMiliseconds(Date.now())-F.fromMiliseconds(s.timestamp)>AI&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Ee(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),Ee(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),Ee(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Ee(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ee(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,Ri(Ri({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),Ee(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),Ee(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${PI}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${na}${n}`,{method:"POST",body:JSON.stringify(s)})}),Ee(this,"getAppDomain",()=>qf().url),this.logger=qe(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var A$=Object.defineProperty,ju=Object.getOwnPropertySymbols,P$=Object.prototype.hasOwnProperty,C$=Object.prototype.propertyIsEnumerable,pa=(t,e,r)=>e in t?A$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fu=(t,e)=>{for(var r in e||(e={}))P$.call(e,r)&&pa(t,r,e[r]);if(ju)for(var r of ju(e))C$.call(e,r)&&pa(t,r,e[r]);return t},ce=(t,e,r)=>pa(t,typeof e!="symbol"?e+"":e,r);let T$=class bp extends K3{constructor(e){var r;super(e),ce(this,"protocol",ip),ce(this,"version",sp),ce(this,"name",sa),ce(this,"relayUrl"),ce(this,"projectId"),ce(this,"customStoragePrefix"),ce(this,"events",new nt.EventEmitter),ce(this,"logger"),ce(this,"heartbeat"),ce(this,"relayer"),ce(this,"crypto"),ce(this,"storage"),ce(this,"history"),ce(this,"expirer"),ce(this,"pairing"),ce(this,"verify"),ce(this,"echoClient"),ce(this,"linkModeSupportedApps"),ce(this,"eventClient"),ce(this,"initialized",!1),ce(this,"logChunkController"),ce(this,"on",(a,c)=>this.events.on(a,c)),ce(this,"once",(a,c)=>this.events.once(a,c)),ce(this,"off",(a,c)=>this.events.off(a,c)),ce(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ce(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ue.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const i=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||op,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=Sn({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:Jx.logger,name:sa}),{logger:n,chunkLoggerController:o}=M3({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=qe(n,this.name),this.heartbeat=new R_,this.crypto=new n8(this,this.logger,e==null?void 0:e.keychain),this.history=new g$(this,this.logger),this.expirer=new m$(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new d3(Fu(Fu({},Xx),e==null?void 0:e.storageOptions)),this.relayer=new T8({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new f$(this,this.logger),this.verify=new E$(this,this.logger,this.storage),this.echoClient=new I$(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new O$(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new bp(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(fI,i),r}get context(){return Je(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(yu,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(yu)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&Zx.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const R$=T$,vp="wc",Ep=2,_p="client",ec=`${vp}@${Ep}:${_p}:`,po={name:_p,logger:"error"},ku="WALLETCONNECT_DEEPLINK_CHOICE",B$="proposal",Lu="Proposal expired",N$="session",Xr=F.SEVEN_DAYS,U$="engine",Oe={wc_sessionPropose:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1104},res:{ttl:F.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1106},res:{ttl:F.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1112},res:{ttl:F.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1114},res:{ttl:F.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:F.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:F.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1119}}},go={min:F.FIVE_MINUTES,max:F.SEVEN_DAYS},$t={idle:"IDLE",active:"ACTIVE"},j$={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},F$="request",k$=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],L$="wc",M$="auth",q$="authKeys",z$="pairingTopics",K$="requests",An=`${L$}@${1.5}:${M$}:`,qs=`${An}:PUB_KEY`;var V$=Object.defineProperty,H$=Object.defineProperties,W$=Object.getOwnPropertyDescriptors,Mu=Object.getOwnPropertySymbols,G$=Object.prototype.hasOwnProperty,Y$=Object.prototype.propertyIsEnumerable,ga=(t,e,r)=>e in t?V$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ne=(t,e)=>{for(var r in e||(e={}))G$.call(e,r)&&ga(t,r,e[r]);if(Mu)for(var r of Mu(e))Y$.call(e,r)&&ga(t,r,e[r]);return t},Fe=(t,e)=>H$(t,W$(e)),B=(t,e,r)=>ga(t,typeof e!="symbol"?e+"":e,r);class Z$ extends ax{constructor(e){super(e),B(this,"name",U$),B(this,"events",new xa),B(this,"initialized",!1),B(this,"requestQueue",{state:$t.idle,queue:[]}),B(this,"sessionRequestQueue",{state:$t.idle,queue:[]}),B(this,"emittedSessionRequests",new F1({limit:500})),B(this,"requestQueueDelay",F.ONE_SECOND),B(this,"expectedPairingMethodMap",new Map),B(this,"recentlyDeletedMap",new Map),B(this,"recentlyDeletedLimit",200),B(this,"relayMessageCache",[]),B(this,"pendingSessions",new Map),B(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Oe)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},F.toMiliseconds(this.requestQueueDelay)))}),B(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Fe(ne({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=VE(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=i;let u=s,h,f=!1;try{if(u){const T=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=T.active}}catch(T){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),T}if(!u||!f){const{topic:T,uri:j}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=T,h=j}if(!u){const{message:T}=L("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(T)}const d=await this.client.core.crypto.generateKeyPair(),p=Oe.wc_sessionPropose.req.ttl||F.FIVE_MINUTES,y=ge(p),m=Fe(ne(ne({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:np}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:y,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Ot()}),x=se("session_connect",m.id),{reject:D,resolve:b,done:A}=Ir(p,Lu),C=({id:T})=>{T===m.id&&(this.client.events.off("proposal_expire",C),this.pendingSessions.delete(m.id),this.events.emit(x,{error:{message:Lu,code:0}}))};return this.client.events.on("proposal_expire",C),this.events.once(x,({error:T,session:j})=>{this.client.events.off("proposal_expire",C),T?D(T):j&&b(j)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:h,approval:A}}),B(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),B(this,"approve",async r=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r==null?void 0:r.id)==null?void 0:i.toString(),trace:[lr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(O){throw o.setError(Pi.no_internet_connection),O}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(O){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(Pi.proposal_not_found),O}try{await this.isValidApprove(r)}catch(O){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Pi.session_approve_namespace_validation_failure),O}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f}=r,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:y,requiredNamespaces:m,optionalNamespaces:x}=d;let D=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:p});D||(D=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:lr.session_approve_started,properties:{topic:p,trace:[lr.session_approve_started,lr.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),A=y.publicKey,C=await this.client.core.crypto.generateSharedKey(b,A),T=ne(ne(ne({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:b,metadata:this.client.metadata},expiry:ge(Xr)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),j=ue.relay;D.addTrace(lr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(C,{transportType:j,internal:{skipSubscribe:!0}})}catch(O){throw D.setError(Pi.subscribe_session_topic_failure),O}D.addTrace(lr.subscribe_session_topic_success);const U=Fe(ne({},T),{topic:C,requiredNamespaces:m,optionalNamespaces:x,pairingTopic:p,acknowledged:!1,self:T.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:b,transportType:ue.relay});await this.client.session.set(C,U),D.addTrace(lr.store_session);try{await this.sendApproveSession({sessionTopic:C,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:T,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),D.addTrace(lr.session_approve_publish_success)}catch(O){throw this.client.logger.error(O),this.client.session.delete(C,he("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(C),O}return this.client.core.eventClient.deleteEvent({eventId:D.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:y.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(C,ge(Xr)),{topic:C,acknowledged:()=>Promise.resolve(this.client.session.get(C))}}),B(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=r;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&await this.sendError({id:i,topic:n,error:s,rpcOpts:Oe.wc_sessionPropose.reject}),await this.deleteProposal(i)}),B(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:s}=r,{done:n,resolve:o,reject:a}=Ir(),c=Ot(),l=gr().toString(),u=this.client.session.get(i).namespaces;return this.events.once(se("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:u}),a(h)}),{acknowledged:n}}),B(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,s=Ot(),{done:n,resolve:o,reject:a}=Ir();return this.events.once(se("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,ge(Xr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),B(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:i,request:s,topic:n,expiry:o=Oe.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(n);(a==null?void 0:a.transportType)===ue.relay&&await this.confirmOnlineStateOrThrow();const c=Ot(),l=gr().toString(),{done:u,resolve:h,reject:f}=Ir(o,"Request expired. Please try again.");this.events.once(se("session_request",c),({error:m,result:x})=>{m?f(m):h(x)});const d="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:d,params:{request:Fe(ne({},s),{expiryTimestamp:ge(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await u();const y={request:Fe(ne({},s),{expiryTimestamp:ge(o)}),chainId:i};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:d,params:y,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,y)}).catch(x=>f(x)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),m()}),new Promise(async m=>{var x;if(!((x=a.sessionConfig)!=null&&x.disableDeepLink)){const D=await R1(this.client.core.storage,ku);await P1({id:c,topic:n,wcDeepLink:D})}m()}),u()]).then(m=>m[2])}),B(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:n}=s,o=this.client.session.get(i);o.transportType===ue.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);At(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:a}):ht(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:a}),this.cleanupAfterResponse(r)}),B(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=Ot(),n=gr().toString(),{done:o,resolve:a,reject:c}=Ir();this.events.once(se("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),B(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:s,chainId:n}=r,o=gr().toString(),a=Ot();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),B(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:he("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=L("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),B(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>GE(i,r)))),B(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),B(this,"authenticate",async(r,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ue.link_mode:ue.relay;o===ue.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:d,nbf:p,methods:y=[],expiry:m}=r,x=[...r.resources||[]],{topic:D,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:D,uri:b}});const A=await this.client.core.crypto.generateKeyPair(),C=Fs(A);if(await Promise.all([this.client.auth.authKeys.set(qs,{responseTopic:C,publicKey:A}),this.client.auth.pairingTopics.set(C,{topic:C,pairingTopic:D})]),await this.client.core.relayer.subscribe(C,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${D}`),y.length>0){const{namespace:v}=Gt(a[0]);let _=Yv(v,"request",y);js(x)&&(_=Jv(_,x.pop())),x.push(_)}const T=m&&m>Oe.wc_sessionAuthenticate.req.ttl?m:Oe.wc_sessionAuthenticate.req.ttl,j={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:d,nbf:p,resources:x},requester:{publicKey:A,metadata:this.client.metadata},expiryTimestamp:ge(T)},U={eip155:{chains:a,methods:[...new Set(["personal_sign",...y])],events:["chainChanged","accountsChanged"]}},O={requiredNamespaces:{},optionalNamespaces:U,relays:[{protocol:"irn"}],pairingTopic:D,proposer:{publicKey:A,metadata:this.client.metadata},expiryTimestamp:ge(Oe.wc_sessionPropose.req.ttl),id:Ot()},{done:K,resolve:V,reject:P}=Ir(T,"Request expired"),S=Ot(),$=se("session_connect",O.id),g=se("session_request",S),w=async({error:v,session:_})=>{this.events.off(g,E),v?P(v):_&&V({session:_})},E=async v=>{var _,R,N;if(await this.deletePendingAuthRequest(S,{message:"fulfilled",code:0}),v.error){const W=he("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return v.error.code===W.code?void 0:(this.events.off($,w),P(v.error.message))}await this.deleteProposal(O.id),this.events.off($,w);const{cacaos:z,responder:k}=v.result,M=[],H=[];for(const W of z){await wl({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),P(he("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:ie}=W,we=js(ie.resources),Xe=[Mo(ie.iss)],_t=Js(ie.iss);if(we){const jt=ml(we),Pn=bl(we);M.push(...jt),Xe.push(...Pn)}for(const jt of Xe)H.push(`${jt}:${_t}`)}const G=await this.client.core.crypto.generateSharedKey(A,k.publicKey);let J;M.length>0&&(J={topic:G,acknowledged:!0,self:{publicKey:A,metadata:this.client.metadata},peer:k,controller:k.publicKey,expiry:ge(Xr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:D,namespaces:Vl([...new Set(M)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,J),D&&await this.client.core.pairing.updateMetadata({topic:D,metadata:k.metadata}),J=this.client.session.get(G)),(_=this.client.metadata.redirect)!=null&&_.linkMode&&(R=k.metadata.redirect)!=null&&R.linkMode&&(N=k.metadata.redirect)!=null&&N.universal&&i&&(this.client.core.addLinkModeSupportedApp(k.metadata.redirect.universal),this.client.session.update(G,{transportType:ue.link_mode})),V({auths:z,session:J})};this.events.once($,w),this.events.once(g,E);let I;try{if(n){const v=bt("wc_sessionAuthenticate",j,S);this.client.core.history.set(D,v);const _=await this.client.core.crypto.encode("",v,{type:cs,encoding:pr});I=Ss(i,D,_)}else await Promise.all([this.sendRequest({topic:D,method:"wc_sessionAuthenticate",params:j,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:S}),this.sendRequest({topic:D,method:"wc_sessionPropose",params:O,expiry:Oe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:O.id})])}catch(v){throw this.events.off($,w),this.events.off(g,E),v}return await this.setProposal(O.id,O),await this.setAuthRequest(S,{request:Fe(ne({},j),{verifyContext:{}}),pairingTopic:D,transportType:o}),{uri:I??b,response:K}}),B(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:s}=r,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[_r.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw n.setError(Ci.no_internet_connection),m}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(Ci.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ue.relay;a===ue.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=Fs(c),h={type:Yt,receiverPublicKey:c,senderPublicKey:l},f=[],d=[];for(const m of s){if(!await wl({cacao:m,projectId:this.client.core.projectId})){n.setError(Ci.invalid_cacao);const C=he("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:C,encodeOpts:h}),new Error(C.message)}n.addTrace(_r.cacaos_verified);const{p:x}=m,D=js(x.resources),b=[Mo(x.iss)],A=Js(x.iss);if(D){const C=ml(D),T=bl(D);f.push(...C),b.push(...T)}for(const C of b)d.push(`${C}:${A}`)}const p=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(_r.create_authenticated_session_topic);let y;if((f==null?void 0:f.length)>0){y={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:ge(Xr),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Vl([...new Set(f)],[...new Set(d)]),transportType:a},n.addTrace(_r.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(m){throw n.setError(Ci.subscribe_authenticated_session_topic_failure),m}n.addTrace(_r.subscribe_authenticated_session_topic_success),await this.client.session.set(p,y),n.addTrace(_r.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(_r.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw n.setError(Ci.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:y}}),B(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:s}=r,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ue.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Fs(o),l={type:Yt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:l,rpcOpts:Oe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),B(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:s}=r;return ad(i,s)}),B(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),B(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),B(this,"deleteSession",async r=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,he("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(ku).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,he("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=$t.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),B(this,"deleteProposal",async(r,i)=>{if(i)try{const s=this.client.proposal.get(r),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(Pi.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,he("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),B(this,"deletePendingSessionRequest",async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==r),s&&(this.sessionRequestQueue.state=$t.idle,this.client.events.emit("session_request_expire",{id:r}))}),B(this,"deletePendingAuthRequest",async(r,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])}),B(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),B(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,ge(Oe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),B(this,"setAuthRequest",async(r,i)=>{const{request:s,pairingTopic:n,transportType:o=ue.relay}=i;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),B(this,"setPendingSessionRequest",async r=>{const{id:i,topic:s,params:n,verifyContext:o}=r,a=n.request.expiryTimestamp||ge(Oe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),B(this,"sendRequest",async r=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=r,d=bt(s,n,c);let p;const y=!!u;try{const D=y?pr:Ge;p=await this.client.core.crypto.encode(i,d,{encoding:D})}catch(D){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),D}let m;if(k$.includes(s)){const D=ut(JSON.stringify(d)),b=ut(p);m=await this.client.core.verify.register({id:b,decryptedId:D})}const x=ne(ne({},Oe[s].req),f);if(x.attestation=m,o&&(x.ttl=o),a&&(x.id=a),this.client.core.history.set(i,d),y){const D=Ss(u,i,p);await global.Linking.openURL(D,this.client.name)}else x.tvf=Fe(ne({},h),{correlationId:d.id}),l?(x.internal=Fe(ne({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,p,x)):this.client.core.relayer.publish(i,p,x).catch(D=>this.client.logger.error(D));return d.id}),B(this,"sendProposeSession",async r=>{const{proposal:i,publishOpts:s}=r,n=bt("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,n);const o=await this.client.core.crypto.encode(i.pairingTopic,n,{encoding:Ge}),a=ut(JSON.stringify(n)),c=ut(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:Fe(ne({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),B(this,"sendApproveSession",async r=>{const{sessionTopic:i,pairingProposalResponse:s,proposal:n,sessionSettleRequest:o,publishOpts:a}=r,c=es(n.id,s),l=await this.client.core.crypto.encode(n.pairingTopic,c,{encoding:Ge}),u=bt("wc_sessionSettle",o,a==null?void 0:a.id),h=await this.client.core.crypto.encode(i,u,{encoding:Ge});this.client.core.history.set(i,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:n.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Fe(ne({},a),{publishMethod:"wc_approveSession"})})}),B(this,"sendResult",async r=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=es(i,n);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?pr:Ge;u=await this.client.core.crypto.encode(s,l,Fe(ne({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let f,d;try{f=await this.client.core.history.get(s,i);const p=f.request;try{d=this.getTVFParams(i,p.params,n)}catch(y){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${y==null?void 0:y.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),p}if(h){const p=Ss(c,s,u);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,y=Oe[p].res;y.tvf=Fe(ne({},d),{correlationId:i}),o?(y.internal=Fe(ne({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,y)):this.client.core.relayer.publish(s,u,y).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),B(this,"sendError",async r=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=$n(i,n);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?pr:Ge;u=await this.client.core.crypto.encode(s,l,Fe(ne({},o||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let f;try{f=await this.client.core.history.get(s,i)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),d}if(h){const d=Ss(c,s,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,p=a||Oe[d].res;this.client.core.relayer.publish(s,u,p)}await this.client.core.history.resolve(l)}),B(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;Ct(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ct(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),B(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),B(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),B(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===$t.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=$t.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=$t.idle}),B(this,"processRequest",async r=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),B(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s,transportType:n}=r,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),B(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:s}=L("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),B(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:s}=r,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),B(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=r,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(Vt.proposal_listener_not_found)),this.isValidConnect(ne({},s.params));const u=a.expiryTimestamp||ge(Oe.wc_sessionPropose.req.ttl),h=ne({id:c,pairingTopic:i,expiryTimestamp:u,attestation:n,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:n,hash:ut(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(Dt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:Oe.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),B(this,"onSessionProposeResponse",async(r,i,s)=>{const{id:n}=i;if(At(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:r,proposalId:n,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(ht(i)){await this.deleteProposal(n);const o=se("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),B(this,"onSessionSettleRequest",async(r,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f}=i.params,d=[...this.pendingSessions.values()].find(m=>m.sessionTopic===r);if(!d)return this.client.logger.error(`Pending session not found for topic ${r}`);const p=this.client.proposal.get(d.proposalId),y=Fe(ne(ne(ne({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:ue.relay});await this.client.session.set(y.topic,y),await this.setExpiry(y.topic,y.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:y.peer.metadata}),this.client.events.emit("session_connect",{session:y}),this.events.emit(se("session_connect",d.proposalId),{session:y}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(y),await this.sendResult({id:i.id,topic:r,result:!0})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),B(this,"onSessionSettleResponse",async(r,i)=>{const{id:s}=i;At(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(se("session_approve",s),{})):ht(i)&&(await this.client.session.delete(r,he("USER_DISCONNECTED")),this.events.emit(se("session_approve",s),{error:i.error}))}),B(this,"onSessionUpdateRequest",async(r,i)=>{const{params:s,id:n}=i;try{const o=`${r}_session_update`,a=Oi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:r,error:he("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ne({topic:r},s));try{Oi.set(o,n),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:r,result:!0})}catch(c){throw Oi.delete(o),c}this.client.events.emit("session_update",{id:n,topic:r,params:s})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),B(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),B(this,"onSessionUpdateResponse",(r,i)=>{const{id:s}=i,n=se("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);At(i)?this.events.emit(se("session_update",s),{}):ht(i)&&this.events.emit(se("session_update",s),{error:i.error})}),B(this,"onSessionExtendRequest",async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,ge(Xr)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),B(this,"onSessionExtendResponse",(r,i)=>{const{id:s}=i,n=se("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);At(i)?this.events.emit(se("session_extend",s),{}):ht(i)&&this.events.emit(se("session_extend",s),{error:i.error})}),B(this,"onSessionPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),B(this,"onSessionPingResponse",(r,i)=>{const{id:s}=i,n=se("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);At(i)?this.events.emit(se("session_ping",s),{}):ht(i)&&this.events.emit(se("session_ping",s),{error:i.error})},500)}),B(this,"onSessionDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(fe.publish,async()=>{n(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:he("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),B(this,"onSessionRequest",async r=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:f}=a;try{await this.isValidRequest(ne({topic:o},f));const d=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:ut(JSON.stringify(bt("wc_sessionRequest",f,h))),encryptedId:l,metadata:d.peer.metadata,transportType:u}),y={id:h,topic:o,params:f,verifyContext:p};await this.setPendingSessionRequest(y),u===ue.link_mode&&(i=d.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=d.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(y):(this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:o,error:d}),this.client.logger.error(d)}}),B(this,"onSessionRequestResponse",(r,i)=>{const{id:s}=i,n=se("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);At(i)?this.events.emit(se("session_request",s),{result:i.result}):ht(i)&&this.events.emit(se("session_request",s),{error:i.error})}),B(this,"onSessionEventRequest",async(r,i)=>{const{id:s,params:n}=i;try{const o=`${r}_session_event_${n.event.name}`,a=Oi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ne({topic:r},n)),this.client.events.emit("session_event",{id:s,topic:r,params:n}),Oi.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),B(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),At(i)?this.events.emit(se("session_request",s),{result:i.result}):ht(i)&&this.events.emit(se("session_request",s),{error:i.error})}),B(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=n.params,f=await this.getVerifyContext({attestationId:o,hash:ut(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),d={requester:l,pairingTopic:s,id:n.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(n.id,{request:d,pairingTopic:s,transportType:c}),c===ue.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=n.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(n.params.requester.metadata,c),d={type:Yt,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:n.id,topic:s,error:l,encodeOpts:d,rpcOpts:Oe.wc_sessionAuthenticate.autoReject,appLink:f})}}),B(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),B(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=$t.idle,this.processSessionRequestQueue()},F.toMiliseconds(this.requestQueueDelay))}),B(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===r&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=se("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(se("session_request",n.request.id),{error:i})})}),B(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===$t.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),B(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=$t.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),B(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:bt("wc_sessionPropose",Fe(ne({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),B(this,"isValidConnect",async r=>{if(!He(r)){const{message:l}=L("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=r;if(ve(i)||await this.isValidPairingTopic(i),!o_(c)){const{message:l}=L("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!ve(s)&&Bt(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!ve(n)&&Bt(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),ve(o)||this.validateSessionProps(o,"sessionProperties"),!ve(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),B(this,"validateNamespaces",(r,i)=>{const s=n_(r,"connect()",i);if(s)throw new Error(s.message)}),B(this,"isValidApprove",async r=>{if(!He(r))throw new Error(L("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=no(s,"approve()");if(l)throw new Error(l.message);const u=Gl(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!ye(n,!0)){const{message:h}=L("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}if(ve(o)||this.validateSessionProps(o,"sessionProperties"),!ve(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),B(this,"isValidReject",async r=>{if(!He(r)){const{message:n}=L("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(n)}const{id:i,reason:s}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!c_(s)){const{message:n}=L("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),B(this,"isValidSessionSettleRequest",r=>{if(!He(r)){const{message:l}=L("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:s,namespaces:n,expiry:o}=r;if(!Kd(i)){const{message:l}=L("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=QE(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=no(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Ct(o)){const{message:l}=L("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),B(this,"isValidUpdate",async r=>{if(!He(r)){const{message:c}=L("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:s}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=no(s,"update()");if(o)throw new Error(o.message);const a=Gl(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),B(this,"isValidExtend",async r=>{if(!He(r)){const{message:s}=L("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),B(this,"isValidRequest",async r=>{if(!He(r)){const{message:c}=L("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Wl(a,n)){const{message:c}=L("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!l_(s)){const{message:c}=L("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!f_(a,n,s.method)){const{message:c}=L("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!y_(o,go)){const{message:c}=L("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${go.min} and ${go.max}`);throw new Error(c)}}),B(this,"isValidRespond",async r=>{var i;if(!He(r)){const{message:o}=L("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:s,response:n}=r;try{await this.isValidSessionTopic(s)}catch(o){throw(i=r==null?void 0:r.response)!=null&&i.id&&this.cleanupAfterResponse(r),o}if(!u_(n)){const{message:o}=L("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),B(this,"isValidPing",async r=>{if(!He(r)){const{message:s}=L("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),B(this,"isValidEmit",async r=>{if(!He(r)){const{message:a}=L("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Wl(o,n)){const{message:a}=L("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!h_(s)){const{message:a}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!d_(o,n,s.name)){const{message:a}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),B(this,"isValidDisconnect",async r=>{if(!He(r)){const{message:s}=L("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),B(this,"isValidAuthenticate",r=>{const{chains:i,uri:s,domain:n,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!ye(s,!1))throw new Error("uri is required parameter");if(!ye(n,!1))throw new Error("domain is required parameter");if(!ye(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Gt(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Gt(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),B(this,"getVerifyContext",async r=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Ki,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ue.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),B(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((s,n)=>{if(s==null){const{message:o}=L("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[n]}`);throw new Error(o)}})}),B(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),B(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),B(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:s}=L("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(s)}}),B(this,"isLinkModeEnabled",(r,i)=>{var s,n,o,a,c,l,u,h,f;return!r||i!==ue.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r==null?void 0:r.redirect)==null?void 0:u.universal)!==void 0&&((h=r==null?void 0:r.redirect)==null?void 0:h.universal)!==""&&((f=r==null?void 0:r.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),B(this,"getAppLinkIfEnabled",(r,i)=>{var s;return this.isLinkModeEnabled(r,i)?(s=r==null?void 0:r.redirect)==null?void 0:s.universal:void 0}),B(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=nl(r,"topic")||"",s=decodeURIComponent(nl(r,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ue.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),B(this,"registerLinkModeListeners",async()=>{var r;if(Fa()||mr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),B(this,"getTVFParams",(r,i,s)=>{var n,o,a;if(!((n=i.request)!=null&&n.method))return{};const c={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const l=this.extractTxHashesFromResult(i.request,s);c.txHashes=l,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return c}),B(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const s=(r==null?void 0:r.data)||((i=r==null?void 0:r[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),B(this,"extractTxHashesFromResult",(r,i)=>{var s;try{if(!i)return[];const n=r.method,o=j$[n];if(n==="sui_signTransaction")return[Tv(i.transactionBytes)];if(n==="near_signTransaction")return[dl(i)];if(n==="near_signTransactions")return i.map(c=>dl(c));if(n==="xrpl_signTransactionFor"||n==="xrpl_signTransaction")return[(s=i.tx_json)==null?void 0:s.hash];if(n==="polkadot_signTransaction")return[C_({transaction:r.params.transactionPayload,signature:i.signature})];if(n==="algo_signTxn")return dt(i)?i.map(c=>pl(c)):[pl(i)];if(n==="cosmos_signDirect")return[Bv(i)];if(n==="wallet_sendCalls")return Nv(i);if(typeof i=="string")return[i];const a=i[o.key];if(dt(a))return n==="solana_signAllTransactions"?a.map(c=>Cv(c)):a;if(typeof a=="string")return[a]}catch(n){this.client.logger.warn("Error extracting tx hashes from result",n)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(r))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(fe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(qs)?this.client.auth.authKeys.get(qs):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:n===ue.link_mode?pr:Ge});Xa(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:n,encryptedId:ut(i)})):Dn(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:n}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(lt.expired,async e=>{const{topic:r,id:i}=Vf(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,L("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,L("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Dr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Dr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ye(e,!1)){const{message:r}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ct(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=L("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!ye(e,!1)){const{message:r}=L("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=L("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ct(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=L("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=L("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ye(e,!1)){const{message:r}=L("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=L("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!a_(e)){const{message:r}=L("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=L("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ct(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=L("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class J$ extends zr{constructor(e,r){super(e,r,B$,ec),this.core=e,this.logger=r}}let X$=class extends zr{constructor(e,r){super(e,r,N$,ec),this.core=e,this.logger=r}};class Q$ extends zr{constructor(e,r){super(e,r,F$,ec,i=>i.id),this.core=e,this.logger=r}}class eD extends zr{constructor(e,r){super(e,r,q$,An,()=>qs),this.core=e,this.logger=r}}class tD extends zr{constructor(e,r){super(e,r,z$,An),this.core=e,this.logger=r}}class rD extends zr{constructor(e,r){super(e,r,K$,An,i=>i.id),this.core=e,this.logger=r}}var iD=Object.defineProperty,sD=(t,e,r)=>e in t?iD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yo=(t,e,r)=>sD(t,typeof e!="symbol"?e+"":e,r);class nD{constructor(e,r){this.core=e,this.logger=r,yo(this,"authKeys"),yo(this,"pairingTopics"),yo(this,"requests"),this.authKeys=new eD(this.core,this.logger),this.pairingTopics=new tD(this.core,this.logger),this.requests=new rD(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var oD=Object.defineProperty,aD=(t,e,r)=>e in t?oD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Q=(t,e,r)=>aD(t,typeof e!="symbol"?e+"":e,r);let cD=class xp extends ox{constructor(e){super(e),Q(this,"protocol",vp),Q(this,"version",Ep),Q(this,"name",po.name),Q(this,"metadata"),Q(this,"core"),Q(this,"logger"),Q(this,"events",new nt.EventEmitter),Q(this,"engine"),Q(this,"session"),Q(this,"proposal"),Q(this,"pendingRequest"),Q(this,"auth"),Q(this,"signConfig"),Q(this,"on",(i,s)=>this.events.on(i,s)),Q(this,"once",(i,s)=>this.events.once(i,s)),Q(this,"off",(i,s)=>this.events.off(i,s)),Q(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),Q(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),Q(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),Q(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||po.name,this.metadata=I1(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:us(Sn({level:(e==null?void 0:e.logger)||po.logger}));this.core=(e==null?void 0:e.core)||new R$(e),this.logger=qe(r,this.name),this.session=new X$(this.core,this.logger),this.proposal=new J$(this.core,this.logger),this.pendingRequest=new Q$(this.core,this.logger),this.engine=new Z$(this),this.auth=new nD(this.core,this.logger)}static async init(e){const r=new xp(e);return await r.initialize(),r}get context(){return Je(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var ya={exports:{}};(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Pt<"u"&&Pt,i=function(){function n(){this.fetch=!1,this.DOMException=r.DOMException}return n.prototype=r,new n}();(function(n){(function(o){var a=typeof n<"u"&&n||typeof self<"u"&&self||typeof Pt<"u"&&Pt||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(g){return g&&DataView.prototype.isPrototypeOf(g)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(g){return g&&u.indexOf(Object.prototype.toString.call(g))>-1};function f(g){if(typeof g!="string"&&(g=String(g)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(g)||g==="")throw new TypeError('Invalid character in header field name: "'+g+'"');return g.toLowerCase()}function d(g){return typeof g!="string"&&(g=String(g)),g}function p(g){var w={next:function(){var E=g.shift();return{done:E===void 0,value:E}}};return c.iterable&&(w[Symbol.iterator]=function(){return w}),w}function y(g){this.map={},g instanceof y?g.forEach(function(w,E){this.append(E,w)},this):Array.isArray(g)?g.forEach(function(w){if(w.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+w.length);this.append(w[0],w[1])},this):g&&Object.getOwnPropertyNames(g).forEach(function(w){this.append(w,g[w])},this)}y.prototype.append=function(g,w){g=f(g),w=d(w);var E=this.map[g];this.map[g]=E?E+", "+w:w},y.prototype.delete=function(g){delete this.map[f(g)]},y.prototype.get=function(g){return g=f(g),this.has(g)?this.map[g]:null},y.prototype.has=function(g){return this.map.hasOwnProperty(f(g))},y.prototype.set=function(g,w){this.map[f(g)]=d(w)},y.prototype.forEach=function(g,w){for(var E in this.map)this.map.hasOwnProperty(E)&&g.call(w,this.map[E],E,this)},y.prototype.keys=function(){var g=[];return this.forEach(function(w,E){g.push(E)}),p(g)},y.prototype.values=function(){var g=[];return this.forEach(function(w){g.push(w)}),p(g)},y.prototype.entries=function(){var g=[];return this.forEach(function(w,E){g.push([E,w])}),p(g)},c.iterable&&(y.prototype[Symbol.iterator]=y.prototype.entries);function m(g){if(!g._noBody){if(g.bodyUsed)return Promise.reject(new TypeError("Already read"));g.bodyUsed=!0}}function x(g){return new Promise(function(w,E){g.onload=function(){w(g.result)},g.onerror=function(){E(g.error)}})}function D(g){var w=new FileReader,E=x(w);return w.readAsArrayBuffer(g),E}function b(g){var w=new FileReader,E=x(w),I=/charset=([A-Za-z0-9_-]+)/.exec(g.type),v=I?I[1]:"utf-8";return w.readAsText(g,v),E}function A(g){for(var w=new Uint8Array(g),E=new Array(w.length),I=0;I<w.length;I++)E[I]=String.fromCharCode(w[I]);return E.join("")}function C(g){if(g.slice)return g.slice(0);var w=new Uint8Array(g.byteLength);return w.set(new Uint8Array(g)),w.buffer}function T(){return this.bodyUsed=!1,this._initBody=function(g){this.bodyUsed=this.bodyUsed,this._bodyInit=g,g?typeof g=="string"?this._bodyText=g:c.blob&&Blob.prototype.isPrototypeOf(g)?this._bodyBlob=g:c.formData&&FormData.prototype.isPrototypeOf(g)?this._bodyFormData=g:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)?this._bodyText=g.toString():c.arrayBuffer&&c.blob&&l(g)?(this._bodyArrayBuffer=C(g.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(g)||h(g))?this._bodyArrayBuffer=C(g):this._bodyText=g=Object.prototype.toString.call(g):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof g=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var g=m(this);if(g)return g;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var g=m(this);return g||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(D);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var g=m(this);if(g)return g;if(this._bodyBlob)return b(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(A(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(K)}),this.json=function(){return this.text().then(JSON.parse)},this}var j=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function U(g){var w=g.toUpperCase();return j.indexOf(w)>-1?w:g}function O(g,w){if(!(this instanceof O))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w=w||{};var E=w.body;if(g instanceof O){if(g.bodyUsed)throw new TypeError("Already read");this.url=g.url,this.credentials=g.credentials,w.headers||(this.headers=new y(g.headers)),this.method=g.method,this.mode=g.mode,this.signal=g.signal,!E&&g._bodyInit!=null&&(E=g._bodyInit,g.bodyUsed=!0)}else this.url=String(g);if(this.credentials=w.credentials||this.credentials||"same-origin",(w.headers||!this.headers)&&(this.headers=new y(w.headers)),this.method=U(w.method||this.method||"GET"),this.mode=w.mode||this.mode||null,this.signal=w.signal||this.signal||function(){if("AbortController"in a){var _=new AbortController;return _.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&E)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(E),(this.method==="GET"||this.method==="HEAD")&&(w.cache==="no-store"||w.cache==="no-cache")){var I=/([?&])_=[^&]*/;if(I.test(this.url))this.url=this.url.replace(I,"$1_="+new Date().getTime());else{var v=/\?/;this.url+=(v.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}O.prototype.clone=function(){return new O(this,{body:this._bodyInit})};function K(g){var w=new FormData;return g.trim().split("&").forEach(function(E){if(E){var I=E.split("="),v=I.shift().replace(/\+/g," "),_=I.join("=").replace(/\+/g," ");w.append(decodeURIComponent(v),decodeURIComponent(_))}}),w}function V(g){var w=new y,E=g.replace(/\r?\n[\t ]+/g," ");return E.split("\r").map(function(I){return I.indexOf(`
`)===0?I.substr(1,I.length):I}).forEach(function(I){var v=I.split(":"),_=v.shift().trim();if(_){var R=v.join(":").trim();try{w.append(_,R)}catch(N){console.warn("Response "+N.message)}}}),w}T.call(O.prototype);function P(g,w){if(!(this instanceof P))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(w||(w={}),this.type="default",this.status=w.status===void 0?200:w.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=w.statusText===void 0?"":""+w.statusText,this.headers=new y(w.headers),this.url=w.url||"",this._initBody(g)}T.call(P.prototype),P.prototype.clone=function(){return new P(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},P.error=function(){var g=new P(null,{status:200,statusText:""});return g.ok=!1,g.status=0,g.type="error",g};var S=[301,302,303,307,308];P.redirect=function(g,w){if(S.indexOf(w)===-1)throw new RangeError("Invalid status code");return new P(null,{status:w,headers:{location:g}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(w,E){this.message=w,this.name=E;var I=Error(w);this.stack=I.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function $(g,w){return new Promise(function(E,I){var v=new O(g,w);if(v.signal&&v.signal.aborted)return I(new o.DOMException("Aborted","AbortError"));var _=new XMLHttpRequest;function R(){_.abort()}_.onload=function(){var k={statusText:_.statusText,headers:V(_.getAllResponseHeaders()||"")};v.url.indexOf("file://")===0&&(_.status<200||_.status>599)?k.status=200:k.status=_.status,k.url="responseURL"in _?_.responseURL:k.headers.get("X-Request-URL");var M="response"in _?_.response:_.responseText;setTimeout(function(){E(new P(M,k))},0)},_.onerror=function(){setTimeout(function(){I(new TypeError("Network request failed"))},0)},_.ontimeout=function(){setTimeout(function(){I(new TypeError("Network request timed out"))},0)},_.onabort=function(){setTimeout(function(){I(new o.DOMException("Aborted","AbortError"))},0)};function N(k){try{return k===""&&a.location.href?a.location.href:k}catch{return k}}if(_.open(v.method,N(v.url),!0),v.credentials==="include"?_.withCredentials=!0:v.credentials==="omit"&&(_.withCredentials=!1),"responseType"in _&&(c.blob?_.responseType="blob":c.arrayBuffer&&(_.responseType="arraybuffer")),w&&typeof w.headers=="object"&&!(w.headers instanceof y||a.Headers&&w.headers instanceof a.Headers)){var z=[];Object.getOwnPropertyNames(w.headers).forEach(function(k){z.push(f(k)),_.setRequestHeader(k,d(w.headers[k]))}),v.headers.forEach(function(k,M){z.indexOf(M)===-1&&_.setRequestHeader(M,k)})}else v.headers.forEach(function(k,M){_.setRequestHeader(M,k)});v.signal&&(v.signal.addEventListener("abort",R),_.onreadystatechange=function(){_.readyState===4&&v.signal.removeEventListener("abort",R)}),_.send(typeof v._bodyInit>"u"?null:v._bodyInit)})}return $.polyfill=!0,a.fetch||(a.fetch=$,a.Headers=y,a.Request=O,a.Response=P),o.Headers=y,o.Request=O,o.Response=P,o.fetch=$,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=r.fetch?r:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,t.exports=e})(ya,ya.exports);var lD=ya.exports;const qu=Ea(lD);var uD=Object.defineProperty,hD=Object.defineProperties,fD=Object.getOwnPropertyDescriptors,zu=Object.getOwnPropertySymbols,dD=Object.prototype.hasOwnProperty,pD=Object.prototype.propertyIsEnumerable,Ku=(t,e,r)=>e in t?uD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vu=(t,e)=>{for(var r in e||(e={}))dD.call(e,r)&&Ku(t,r,e[r]);if(zu)for(var r of zu(e))pD.call(e,r)&&Ku(t,r,e[r]);return t},Hu=(t,e)=>hD(t,fD(e));const gD={Accept:"application/json","Content-Type":"application/json"},yD="POST",Wu={headers:gD,method:yD},Gu=10;let Ip=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new nt.EventEmitter,this.isAvailable=!1,this.registering=!1,!hu(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=Zt(e),i=await(await qu(this.url,Hu(Vu({},Wu),{body:r}))).json();this.onPayload({data:i})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!hu(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=Zt({id:1,jsonrpc:"2.0",method:"test",params:[]});await qu(e,Hu(Vu({},Wu),{body:r}))}this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Nr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=$n(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return Xd(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Gu&&this.events.setMaxListeners(Gu)}};const Yu="error",wD="wss://relay.walletconnect.org",mD="wc",bD="universal_provider",As=`${mD}@2:${bD}:`,Sp="https://rpc.walletconnect.org/v1/",$p="generic",vD=`${Sp}bundler`,ci="call_status",ED=86400,tc={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function rc(t){return t==null||typeof t!="object"&&typeof t!="function"}function Dp(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Op(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const _D="[object RegExp]",Ap="[object String]",Pp="[object Number]",Cp="[object Boolean]",Tp="[object Arguments]",xD="[object Symbol]",ID="[object Date]",SD="[object Map]",$D="[object Set]",DD="[object Array]",OD="[object ArrayBuffer]",AD="[object Object]",PD="[object DataView]",CD="[object Uint8Array]",TD="[object Uint8ClampedArray]",RD="[object Uint16Array]",BD="[object Uint32Array]",ND="[object Int8Array]",UD="[object Int16Array]",jD="[object Int32Array]",FD="[object Float32Array]",kD="[object Float64Array]";function ic(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function LD(t,e){return si(t,void 0,t,new Map,e)}function si(t,e,r,i=new Map,s=void 0){const n=s==null?void 0:s(t,e,r,i);if(n!=null)return n;if(rc(t))return t;if(i.has(t))return i.get(t);if(Array.isArray(t)){const o=new Array(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=si(t[a],a,r,i,s);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;i.set(t,o);for(const[a,c]of t)o.set(a,si(c,a,r,i,s));return o}if(t instanceof Set){const o=new Set;i.set(t,o);for(const a of t)o.add(si(a,void 0,r,i,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(ic(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=si(t[a],a,r,i,s);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return i.set(t,o),Or(o,t,r,i,s),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return i.set(t,o),Or(o,t,r,i,s),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return i.set(t,o),Or(o,t,r,i,s),o}if(t instanceof Error){const o=new t.constructor;return i.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Or(o,t,r,i,s),o}if(typeof t=="object"&&MD(t)){const o=Object.create(Object.getPrototypeOf(t));return i.set(t,o),Or(o,t,r,i,s),o}return t}function Or(t,e,r=t,i,s){const n=[...Object.keys(e),...Dp(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=si(e[a],a,r,i,s))}}function MD(t){switch(Op(t)){case Tp:case DD:case OD:case PD:case Cp:case ID:case FD:case kD:case ND:case UD:case jD:case SD:case Pp:case AD:case _D:case $D:case Ap:case xD:case CD:case TD:case RD:case BD:return!0;default:return!1}}function qD(t,e){return LD(t,(r,i,s,n)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case Pp:case Ap:case Cp:{const o=new t.constructor(t==null?void 0:t.valueOf());return Or(o,t),o}case Tp:{const o={};return Or(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function Zu(t){return qD(t)}function Ju(t){return t!==null&&typeof t=="object"&&Op(t)==="[object Arguments]"}function Xu(t){return typeof t=="object"&&t!==null}function zD(){}function KD(t){return ic(t)}function VD(t){var r;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const i=t[Symbol.toStringTag];return i==null||!((r=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&r.writable)?!1:t.toString()===`[object ${i}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function HD(t){if(rc(t))return t;if(Array.isArray(t)||ic(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const i=new r(t);return i.lastIndex=t.lastIndex,i}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const i=new r(t.message);return i.stack=t.stack,i.name=t.name,i.cause=t.cause,i}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const i=Object.create(e);return Object.assign(i,t)}return t}function WD(t,...e){const r=e.slice(0,-1),i=e[e.length-1];let s=t;for(let n=0;n<r.length;n++){const o=r[n];s=wa(s,o,i,new Map)}return s}function wa(t,e,r,i){if(rc(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(i.has(e))return HD(i.get(e));if(i.set(e,t),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const s=[...Object.keys(e),...Dp(e)];for(let n=0;n<s.length;n++){const o=s[n];let a=e[o],c=t[o];if(Ju(a)&&(a={...a}),Ju(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=Zu(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],h=Reflect.ownKeys(c);for(let f=0;f<h.length;f++){const d=h[f];u[d]=c[d]}c=u}else c=[];const l=r(c,a,o,t,e,i);l!=null?t[o]=l:Array.isArray(a)||Xu(c)&&Xu(a)?t[o]=wa(c,a,r,i):c==null&&VD(a)?t[o]=wa({},a,r,i):c==null&&KD(a)?t[o]=Zu(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function GD(t,...e){return WD(t,...e,zD)}var YD=Object.defineProperty,ZD=Object.defineProperties,JD=Object.getOwnPropertyDescriptors,Qu=Object.getOwnPropertySymbols,XD=Object.prototype.hasOwnProperty,QD=Object.prototype.propertyIsEnumerable,eh=(t,e,r)=>e in t?YD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ps=(t,e)=>{for(var r in e||(e={}))XD.call(e,r)&&eh(t,r,e[r]);if(Qu)for(var r of Qu(e))QD.call(e,r)&&eh(t,r,e[r]);return t},eO=(t,e)=>ZD(t,JD(e));function Rp(t,e,r){var i;const s=Gt(t);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${Sp}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function tO(t){return t.includes(":")?t.split(":")[1]:t}function Bp(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function rO(t,e){const r=Object.keys(e.namespaces).filter(s=>s.includes(t));if(!r.length)return[];const i=[];return r.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function th(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var i,s;return((i=r==null?void 0:r.chains)==null?void 0:i.length)&&((s=r==null?void 0:r.chains)==null?void 0:s.length)>0}))}function Cs(t={},e={}){const r=th(rh(t)),i=th(rh(e));return GD(r,i)}function rh(t){var e,r,i,s,n;const o={};if(!Bt(t))return o;for(const[a,c]of Object.entries(t)){const l=xn(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],f=c.rpcMap||{},d=ii(a);o[d]=eO(Ps(Ps({},o[d]),c),{chains:Rt(l,(e=o[d])==null?void 0:e.chains),methods:Rt(u,(r=o[d])==null?void 0:r.methods),events:Rt(h,(i=o[d])==null?void 0:i.events)}),(Bt(f)||Bt(((s=o[d])==null?void 0:s.rpcMap)||{}))&&(o[d].rpcMap=Ps(Ps({},f),(n=o[d])==null?void 0:n.rpcMap))}return o}function ih(t){return t.includes(":")?t.split(":")[2]:t}function sh(t){const e={};for(const[r,i]of Object.entries(t)){const s=i.methods||[],n=i.events||[],o=i.accounts||[],a=xn(r)?[r]:i.chains?i.chains:Bp(i.accounts);e[r]={chains:a,methods:s,events:n,accounts:o}}return e}function wo(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function iO(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const Np={},li=t=>Np[t],mo=(t,e)=>{Np[t]=e};var sO=Object.defineProperty,nh=Object.getOwnPropertySymbols,nO=Object.prototype.hasOwnProperty,oO=Object.prototype.propertyIsEnumerable,oh=(t,e,r)=>e in t?sO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ah=(t,e)=>{for(var r in e||(e={}))nO.call(e,r)&&oh(t,r,e[r]);if(nh)for(var r of nh(e))oO.call(e,r)&&oh(t,r,e[r]);return t};const ch="eip155",aO=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],cO=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,bo=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,lh=t=>Object.keys(t).filter(e=>aO.includes(e)).reduce((e,r)=>(e[r]=lO(t[r]),e),{}),lO=t=>typeof t=="string"&&iO(t)?JSON.parse(t):t,uO=(t,e,r)=>{const{sessionProperties:i={},scopedProperties:s={}}=t,n={};if(!Bt(s)&&!Bt(i))return;const o=lh(i);for(const a of r){const c=cO(a);if(!c)continue;n[bo(c)]=o;const l=s==null?void 0:s[`${ch}:${c}`];if(l){const u=l==null?void 0:l[`${ch}:${c}:${e}`];n[bo(c)]=ah(ah({},n[bo(c)]),lh(u||l))}}for(const[a,c]of Object.entries(n))Object.keys(c).length===0&&delete n[a];return Object.keys(n).length>0?n:void 0};var hO=Object.defineProperty,fO=(t,e,r)=>e in t?hO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dO=(t,e,r)=>fO(t,e+"",r);let vo,pO=class Up{constructor(e){dO(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return vo||(vo=new Up(e)),vo}};var gO=Object.defineProperty,yO=Object.defineProperties,wO=Object.getOwnPropertyDescriptors,uh=Object.getOwnPropertySymbols,mO=Object.prototype.hasOwnProperty,bO=Object.prototype.propertyIsEnumerable,hh=(t,e,r)=>e in t?gO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vO=(t,e)=>{for(var r in e||(e={}))mO.call(e,r)&&hh(t,r,e[r]);if(uh)for(var r of uh(e))bO.call(e,r)&&hh(t,r,e[r]);return t},EO=(t,e)=>yO(t,wO(e));async function _O(t,e){const r=Gt(t.result.capabilities.caip345.caip2),i=t.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(i.map(h=>xO(r.reference,h,e))),n=s.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);s.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!n.length||n.some(h=>!h),a=n.every(h=>(h==null?void 0:h.status)==="0x1"),c=n.every(h=>(h==null?void 0:h.status)==="0x0"),l=n.some(h=>(h==null?void 0:h.status)==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:n,status:u}}async function xO(t,e,r){return await r(parseInt(t)).request(bt("eth_getTransactionReceipt",[e]))}async function IO({sendCalls:t,storage:e}){const r=await e.getItem(ci);await e.setItem(ci,EO(vO({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:ge(ED)}}))}async function SO({resultId:t,storage:e}){const r=await e.getItem(ci);if(r){delete r[t],await e.setItem(ci,r);for(const i in r)Ct(r[i].expiry)&&delete r[i];await e.setItem(ci,r)}}async function $O({resultId:t,storage:e}){const r=await e.getItem(ci),i=r==null?void 0:r[t];if(i&&!Ct(i.expiry))return i;await SO({resultId:t,storage:e})}var DO=Object.defineProperty,OO=Object.defineProperties,AO=Object.getOwnPropertyDescriptors,fh=Object.getOwnPropertySymbols,PO=Object.prototype.hasOwnProperty,CO=Object.prototype.propertyIsEnumerable,ma=(t,e,r)=>e in t?DO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eo=(t,e)=>{for(var r in e||(e={}))PO.call(e,r)&&ma(t,r,e[r]);if(fh)for(var r of fh(e))CO.call(e,r)&&ma(t,r,e[r]);return t},_o=(t,e)=>OO(t,AO(e)),xr=(t,e,r)=>ma(t,typeof e!="symbol"?e+"":e,r);class TO{constructor(e){xr(this,"name","eip155"),xr(this,"client"),xr(this,"chainId"),xr(this,"namespace"),xr(this,"httpProviders"),xr(this,"events"),xr(this,"storage"),this.namespace=e.namespace,this.events=li("events"),this.client=li("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=pO.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const i=this.chainId;this.chainId=parseInt(e),this.events.emit(tc.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||Rp(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Qa(new Ip(i,li("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=parseInt(tO(r));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=_o(Eo({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,i;let s=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,i,s,n,o;const a=(i=(r=e.request)==null?void 0:r.params)==null?void 0:i[0],c=((n=(s=e.request)==null?void 0:s.params)==null?void 0:n[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l==null?void 0:l.sessionProperties)==null?void 0:o.capabilities)||{},h=`${a}${c.join(",")}`,f=u==null?void 0:u[h];if(f)return f;let d;try{d=uO(l,a,c)}catch(y){console.warn("Failed to extract capabilities from session",y)}if(d)return d;const p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:_o(Eo({},l.sessionProperties||{}),{capabilities:_o(Eo({},u||{}),{[h]:p})})})}catch(y){console.warn("Failed to update session with capabilities",y)}return p}async getCallStatus(e){var r,i,s;const n=this.client.session.get(e.topic),o=(r=n.sessionProperties)==null?void 0:r.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(i=n.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await $O({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await _O(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(bt("eth_getUserOperationReceipt",[(i=r.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,r){return`${vD}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,i,s;const n=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=n==null?void 0:n.id,c=(n==null?void 0:n.capabilities)||{},l=(i=c==null?void 0:c.caip345)==null?void 0:i.caip2,u=(s=c==null?void 0:c.caip345)==null?void 0:s.transactionHashes;return!a||!l||!(u!=null&&u.length)||await IO({sendCalls:{request:o,result:n},storage:this.storage}),n}}var RO=Object.defineProperty,BO=(t,e,r)=>e in t?RO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qr=(t,e,r)=>BO(t,typeof e!="symbol"?e+"":e,r);class NO{constructor(e){Qr(this,"name",$p),Qr(this,"client"),Qr(this,"httpProviders"),Qr(this,"events"),Qr(this,"namespace"),Qr(this,"chainId"),this.namespace=e.namespace,this.events=li("events"),this.client=li("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const i=this.chainId;this.chainId=e,this.events.emit(tc.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return Gt(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const i={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(s=>{var n,o;const a=Gt(s),c=(o=(n=this.namespace)==null?void 0:n.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];i[a.reference]=this.createHttpProvider(s,c)}),i}getHttpProvider(e){const r=Gt(e).reference,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Rp(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Qa(new Ip(i,li("disableProviderPing")))}}var UO=Object.defineProperty,jO=Object.defineProperties,FO=Object.getOwnPropertyDescriptors,dh=Object.getOwnPropertySymbols,kO=Object.prototype.hasOwnProperty,LO=Object.prototype.propertyIsEnumerable,ba=(t,e,r)=>e in t?UO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bi=(t,e)=>{for(var r in e||(e={}))kO.call(e,r)&&ba(t,r,e[r]);if(dh)for(var r of dh(e))LO.call(e,r)&&ba(t,r,e[r]);return t},Ts=(t,e)=>jO(t,FO(e)),ct=(t,e,r)=>ba(t,typeof e!="symbol"?e+"":e,r);class sc{constructor(e){ct(this,"client"),ct(this,"namespaces"),ct(this,"optionalNamespaces"),ct(this,"sessionProperties"),ct(this,"scopedProperties"),ct(this,"events",new xa),ct(this,"rpcProviders",{}),ct(this,"session"),ct(this,"providerOpts"),ct(this,"logger"),ct(this,"uri"),ct(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:us(Sn({level:(e==null?void 0:e.logger)||Yu})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new sc(e);return await r.initialize(),r}async request(e,r,i){const[s,n]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Bi({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,r,i,s){const n=new Date().getTime();this.request(e,i,s).then(o=>r(null,es(n,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:he("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,r);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const o=sh(this.session.namespaces);this.namespaces=Cs(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const s=await i();this.session=s;const n=sh(s.namespaces);return this.namespaces=Cs(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!dt(r))return;for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn("Failed to cleanup pending pairings",r)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await cD.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Yu,relayUrl:this.providerOpts.relayUrl||wD,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>ii(r)))];mo("client",this.client),mo("events",this.events),mo("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=rO(r,this.session);if((i==null?void 0:i.length)===0)return;const s=Bp(i),n=Cs(this.namespaces,this.optionalNamespaces),o=Ts(Bi({},n[r]),{accounts:i,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new TO({namespace:o});break;default:this.rpcProviders[r]=new NO({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:i}=e;i===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:i,topic:s}=e;if(s!==((r=this.session)==null?void 0:r.topic))return;const{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&dt(o)&&this.events.emit("accountsChanged",o.map(ih))}else if(n.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=ii(o),l=wo(o)!==wo(a)?`${c}:${wo(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i,s;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:n}=r,o=(s=this.client)==null?void 0:s.session.get(e);this.session=Ts(Bi({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ts(Bi({},he("USER_DISCONNECTED")),{data:e.topic})))}),this.on(tc.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(Ts(Bi({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[$p]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:i={},sessionProperties:s,scopedProperties:n}=e;this.optionalNamespaces=Cs(r,i),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(o=>ii(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const s=ii(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:i=!1}){if(!this.namespaces)return;const[s,n]=this.validateChain(e);n&&(this.updateNamespaceChain(s,n),i?(this.events.emit("chainChanged",n),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:r})):this.getProvider(s).setDefaultChain(n),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:i}){var s,n;try{if(i===r)return;const o=(n=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(ih);if(!dt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,r){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${r}`,s={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=r):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var i;const s=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${As}/${e}${s}`,r)}async getFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${As}/${e}${i}`)}async deleteFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${As}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const i of r)i.startsWith(As)&&await this.client.core.storage.removeItem(i)}catch(r){this.logger.warn("Failed to cleanup storage",r)}}}const MO=sc,qO="wc",zO="ethereum_provider",KO=`${qO}@2:${zO}:`,VO="https://rpc.walletconnect.org/v1/",on=["eth_sendTransaction","personal_sign"],jp=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],an=["chainChanged","accountsChanged"],Fp=["chainChanged","accountsChanged","message","disconnect","connect"],HO=async()=>{const{createAppKit:t}=await wh(()=>import("./CKhFwjwF.js").then(e=>e.$),__vite__mapDeps([7,4,1,2,3,5,6]),import.meta.url);return t};var WO=Object.defineProperty,GO=Object.defineProperties,YO=Object.getOwnPropertyDescriptors,ph=Object.getOwnPropertySymbols,ZO=Object.prototype.hasOwnProperty,JO=Object.prototype.propertyIsEnumerable,va=(t,e,r)=>e in t?WO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sr=(t,e)=>{for(var r in e||(e={}))ZO.call(e,r)&&va(t,r,e[r]);if(ph)for(var r of ph(e))JO.call(e,r)&&va(t,r,e[r]);return t},Ni=(t,e)=>GO(t,YO(e)),et=(t,e,r)=>va(t,typeof e!="symbol"?e+"":e,r);function cn(t){return Number(t[0].split(":")[1])}function Rs(t){return`0x${t.toString(16)}`}function XO(t){const{chains:e,optionalChains:r,methods:i,optionalMethods:s,events:n,optionalEvents:o,rpcMap:a}=t;if(!dt(e))throw new Error("Invalid chains");const c={chains:e,methods:i||on,events:n||an,rpcMap:Sr({},e.length?{[cn(e)]:a[cn(e)]}:{})},l=n==null?void 0:n.filter(d=>!an.includes(d)),u=i==null?void 0:i.filter(d=>!on.includes(d));if(!r&&!o&&!s&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const h=(l==null?void 0:l.length)&&(u==null?void 0:u.length)||!r,f={chains:[...new Set(h?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:jp))],events:[...new Set(c.events.concat(o!=null&&o.length?o:Fp))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?f:void 0}}class nc{constructor(){et(this,"events",new nt.EventEmitter),et(this,"namespace","eip155"),et(this,"accounts",[]),et(this,"signer"),et(this,"chainId",1),et(this,"modal"),et(this,"rpc"),et(this,"STORAGE_KEY",KO),et(this,"on",(e,r)=>(this.events.on(e,r),this)),et(this,"once",(e,r)=>(this.events.once(e,r),this)),et(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),et(this,"off",(e,r)=>(this.events.off(e,r),this)),et(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new nc;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,i){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:s}=XO(this.rpc);try{const n=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(f=>{!f.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(Ni(Sr({namespaces:Sr({},i&&{[this.namespace]:i})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:h})).then(f=>{a(f)}).catch(f=>{var d;(d=this.modal)==null||d.showErrorMessage("Unable to connect"),c(new Error(f.message))})});if(!n)return;const o=el(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:Rs(this.chainId)})}catch(n){throw this.signer.logger.error(n),n}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var i;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const s=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Ni(Sr({},e),{chains:this.rpc.chains}),r).then(u=>{o(u)}).catch(u=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),n=s.session;if(n){const o=el(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:Rs(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(i=this.modal)==null||i.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",Rs(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ni(Sr({},he("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Rs(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,s]=e.split(":");return{chainId:`${r}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const s=(r=e==null?void 0:e.chains)!=null?r:[],n=(i=e==null?void 0:e.optionalChains)!=null?i:[],o=s.concat(n);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?(e==null?void 0:e.methods)||on:[],c=s.length?(e==null?void 0:e.events)||an:[],l=(e==null?void 0:e.optionalMethods)||[],u=(e==null?void 0:e.optionalEvents)||[],h=(e==null?void 0:e.rpcMap)||this.buildRpcMap(o,e.projectId),f=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(d=>this.formatChainId(d)),optionalChains:n.map(d=>this.formatChainId(d)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:f,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,r)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?cn(this.rpc.chains):cn(this.rpc.optionalChains),this.signer=await MO.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const i=await HO(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return cA}),n=s(Ni(Sr({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!n.networks.length)throw new Error("No networks found for WalletConnect");r=i(Ni(Sr({},n),{universalProvider:this.signer,manualWCControl:!0}))}catch(i){throw console.warn(i),new Error("To use QR modal, please install @reown/appkit package")}if(r)try{this.modal=r}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:s}=e;r&&dt(r)&&(this.rpc.chains=r.map(n=>this.formatChainId(n)),r.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)})),i&&dt(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${VO}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}var QO=Object.defineProperty,eA=Object.defineProperties,tA=Object.getOwnPropertyDescriptors,gh=Object.getOwnPropertySymbols,rA=Object.prototype.hasOwnProperty,iA=Object.prototype.propertyIsEnumerable,yh=(t,e,r)=>e in t?QO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kp=(t,e)=>{for(var r in e||(e={}))rA.call(e,r)&&yh(t,r,e[r]);if(gh)for(var r of gh(e))iA.call(e,r)&&yh(t,r,e[r]);return t},sA=(t,e)=>eA(t,tA(e));function nA(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const oA=t=>{const[e,r]=t.split(":");return Lp({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function aA(t){var e,r,i,s,n,o,a;const c=(e=t.chains)==null?void 0:e.map(oA).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(h=>{var f;return h.id===((f=t.defaultChain)==null?void 0:f.id)}),u={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:nA(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:l,metadata:sA(kp({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((i=t.metadata)==null?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:((s=t.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((n=t.metadata)==null?void 0:n.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const h=[...(t.mobileWallets||[]).map(p=>({id:p.id,name:p.name,links:p.links})),...(t.desktopWallets||[]).map(p=>({id:p.id,name:p.name,links:{native:p.links.native,universal:p.links.universal}}))],f=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],d=h.filter(p=>!f.includes(p.id));d.length&&(u.customWallets=d)}return u}function Lp(t){return kp({formatters:void 0,fees:void 0,serializers:void 0},t)}var cA=Object.freeze({__proto__:null,convertWCMToAppKitOptions:aA,defineChain:Lp});const JA=Object.freeze(Object.defineProperty({__proto__:null,OPTIONAL_EVENTS:Fp,OPTIONAL_METHODS:jp,REQUIRED_EVENTS:an,REQUIRED_METHODS:on,default:nc},Symbol.toStringTag,{value:"Module"}));export{M3 as A,Dn as B,Xb as C,es as D,qe as E,xa as F,tb as G,Zt as H,Lr as I,Nr as J,gr as K,$n as L,At as M,ht as N,Ot as O,Zc as P,_f as Q,Ip as R,JA as S,Rr as a,Ia as b,F as c,lg as d,Ah as e,ft as f,Ph as g,Mi as h,ts as i,tw as j,Hy as k,lw as l,u1 as m,nt as n,Sn as o,R_ as p,d3 as q,bt as r,jo as s,Ze as t,Mr as u,us as v,Qa as w,Yx as x,Je as y,Xa as z};
