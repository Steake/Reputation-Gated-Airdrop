const s="shadowgraph-circuits-v1",r="shadowgraph-ezkl-v1",n=["/circuits/ebsl_16/_compiled.wasm","/circuits/ebsl_16/settings.json","/circuits/ebsl_16/vk.key","/circuits/ebsl_32/_compiled.wasm","/circuits/ebsl_32/settings.json","/circuits/ebsl_32/vk.key"],h=["/node_modules/@ezkljs/engine/ezkl_bg.wasm"];self.addEventListener("install",e=>{console.log("[ServiceWorker] Installing..."),e.waitUntil((async()=>{try{await(await caches.open(s)).addAll(n),console.log("[ServiceWorker] Circuits pre-cached"),await(await caches.open(r)).addAll(h),console.log("[ServiceWorker] EZKL WASM pre-cached"),await self.skipWaiting()}catch(c){console.error("[ServiceWorker] Pre-cache failed:",c)}})())});self.addEventListener("activate",e=>{console.log("[ServiceWorker] Activating..."),e.waitUntil((async()=>{await self.clients.claim();const c=await caches.keys();await Promise.all(c.filter(a=>a!==s&&a!==r&&(a.startsWith("shadowgraph-")||a.startsWith("ezkl-"))).map(a=>caches.delete(a))),console.log("[ServiceWorker] Activated")})())});self.addEventListener("fetch",e=>{const c=new URL(e.request.url);!c.pathname.startsWith("/circuits/")&&!c.pathname.includes("ezkl")||e.respondWith((async()=>{const a=c.pathname.includes("ezkl")?r:s,i=await caches.open(a),o=await i.match(e.request);if(o)return console.log(`[ServiceWorker] Cache hit: ${c.pathname}`),o;console.log(`[ServiceWorker] Cache miss: ${c.pathname}`);try{const t=await fetch(e.request);return t.ok&&i.put(e.request,t.clone()),t}catch(t){console.error(`[ServiceWorker] Fetch failed: ${c.pathname}`,t);const l=await i.match(e.request);if(l)return console.log(`[ServiceWorker] Returning stale cache: ${c.pathname}`),l;throw t}})())});self.addEventListener("message",e=>{e.data&&e.data.type==="CLEAR_CACHE"&&e.waitUntil((async()=>{await caches.delete(s),await caches.delete(r),console.log("[ServiceWorker] Caches cleared")})())});
